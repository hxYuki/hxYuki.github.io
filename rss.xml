<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>ç¶ºè·¡</title>
    <link>https://blog.yukx.io/</link>
    
    <atom:link href="https://blog.yukx.io/rss.xml" rel="self" type="application/rss+xml"/>
    
    <description>å¯’èŒ«ç‹¬èº…å¤„ï¼Œå¿½å¦‚æœ‰äººè¡Œ</description>
    <pubDate>Sat, 29 Apr 2023 08:00:35 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶2ğ’¾)ï¼šæ‘„åƒæœºç¥ç§˜æŠ–åŠ¨äº‹ä»¶</title>
      <link>https://blog.yukx.io/2023/04/game-dev-journal-2i-camera-mystery-trembling/</link>
      <guid>https://blog.yukx.io/2023/04/game-dev-journal-2i-camera-mystery-trembling/</guid>
      <pubDate>Fri, 28 Apr 2023 02:13:22 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;çªç„¶å‘ç°è¿˜æ²¡æœ‰å…³äºæœ€å¼€å§‹å°±å®Œæˆçš„ ã€Œåˆ‡å±ã€ éƒ¨åˆ†çš„å†…å®¹ï¼Œä¹Ÿæ˜¯çªç„¶å‘ç°è¿™ä¸œè¥¿è¿˜æœ‰å¿…è¦æ‹‰å‡ºæ¥è¯´ä¸€å˜´çš„ä»·å€¼ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸€åˆ‡çš„èµ·å› &quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#ä¸€åˆ‡çš„èµ·å› &quot;&gt;#&lt;/a&gt; ä¸€åˆ‡çš„èµ·å› &lt;/h2&gt;
&lt;p&gt;è™½ç„¶åœ¨ RTS ç±»æ¸¸æˆé‡Œå¤§éƒ¨</description>
        
      
      
      
      <content:encoded><![CDATA[<p>çªç„¶å‘ç°è¿˜æ²¡æœ‰å…³äºæœ€å¼€å§‹å°±å®Œæˆçš„ ã€Œåˆ‡å±ã€ éƒ¨åˆ†çš„å†…å®¹ï¼Œä¹Ÿæ˜¯çªç„¶å‘ç°è¿™ä¸œè¥¿è¿˜æœ‰å¿…è¦æ‹‰å‡ºæ¥è¯´ä¸€å˜´çš„ä»·å€¼ã€‚</p><h2 id="ä¸€åˆ‡çš„èµ·å› "><a class="anchor" href="#ä¸€åˆ‡çš„èµ·å› ">#</a> ä¸€åˆ‡çš„èµ·å› </h2><p>è™½ç„¶åœ¨ RTS ç±»æ¸¸æˆé‡Œå¤§éƒ¨åˆ†äººçš„æµè§ˆä¿¡æ¯çš„æ–¹å¼éƒ½æ˜¯é¼ æ ‡ç§»åˆ°å±å¹•è¾¹ç¼˜ ã€Œæ‹–æ‹½ã€ è¿‡å»ï¼Œä¸è¿‡è¿™æ›´åƒæ˜¯è¡¨è¾¾ä¸€ç§ â€œæˆ‘è¦æ“ä½œé‚£è¾¹çš„å•ä½ï¼Œç»™æˆ‘è¿‡å»â€ çš„æƒ³æ³•ï¼Œè€Œè¿™æ ·ä¹ŸæŒºéº»çƒ¦çš„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åªæ˜¯æƒ³ç¨å¾®å¾€é‚£è¾¹çœ‹çœ‹ã€‚<br />åœ¨æˆ‘æ¸¸æˆçš„è¿‡ç¨‹ä¸­å‘ç°äº†ä¸€ç§æ›´ä¸ºèˆ’é€‚çš„ç§»åŠ¨å±å¹•çš„æ–¹å¼ ã€Œä¸­é”®æ‹–å±ã€ (ä»€ä¹ˆé”®éƒ½å¯ä»¥å•¦)ï¼ŒæŒ‰ä¸‹é‚£ä¸ªé”®ï¼Œå±å¹• (æˆ–è€…è¯´åœ°å›¾ï¼Œæˆ–è€…è¯´æ‘„åƒæœº) å°±ä¼šè·Ÿéšé¼ æ ‡å¼€å§‹ç§»åŠ¨ã€‚</p><h3 id="éšæ„çš„å®ç°-ç²¾ç¡®çš„è®¡ç®—"><a class="anchor" href="#éšæ„çš„å®ç°-ç²¾ç¡®çš„è®¡ç®—">#</a> éšæ„çš„å®ç° ç²¾ç¡®çš„è®¡ç®—</h3><p>åœ¨æœ€åˆçš„ç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡è®°å½•æŒ‰ä¸‹ ã€Œé‚£ä¸ªé”®ã€ æ—¶çš„é¼ æ ‡ä½ç½®å’Œæ‘„åƒæœºä½ç½®ï¼Œåœ¨é¼ æ ‡ç§»åŠ¨æ—¶é€šè¿‡ç³»æ•°æ”¾å¤§ <code>Input.mousePosition</code>  çš„å˜åŒ–é‡å°†å…¶æ–½åŠ ç»™æ‘„åƒæœºã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> camPos <span class="token operator">-</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>orthographicSize <span class="token operator">/</span> <span class="token number">20</span> <span class="token operator">*</span> CameraSpeed <span class="token operator">*</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span>mousePosition <span class="token operator">-</span> initialPos<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>é€šè¿‡ç²¾å¿ƒè°ƒæ•´ CameraSpeed å’Œé…åˆ orthographicSize çš„é™¤æ•°ï¼Œç”šè‡³åœ¨æ”¯æŒæ‘„åƒæœºç¼©æ”¾çš„æƒ…å†µä¸‹æ‹–åŠ¨å¯ä»¥å®Œç¾è·Ÿæ‰‹ï¼Œå¯å–œå¯è´ºï¼</p><p>ä¸è¿‡è¿™æ˜¾ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ <code>Input.mousePosition</code>  åˆ°ä¸–ç•Œåæ ‡æ˜¯æ˜¾ç¤ºç›¸å…³çš„ï¼Œä¸€èˆ¬æ¥è®²ç”¨é¼ æ ‡æ“ä½œæ¸¸æˆç‰©ä½“æ—¶éƒ½æ˜¯è¦è½¬æ¢çš„ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td data-command="ä»£ç é‡Œç”šè‡³ç•™ç€è¿™æ ·ä¸€ä¸ªæ³¨é‡Š"></td><td><pre><span class="token comment">//var mousePosition = Camera.main.ScreenToWorldPoint(Input.mousePosition);</span></pre></td></tr></table></figure><h3 id="èƒ½å‡ºé—®é¢˜çš„åœ°æ–¹å°±ä¸€å®šä¼šå‡ºé—®é¢˜"><a class="anchor" href="#èƒ½å‡ºé—®é¢˜çš„åœ°æ–¹å°±ä¸€å®šä¼šå‡ºé—®é¢˜">#</a> èƒ½å‡ºé—®é¢˜çš„åœ°æ–¹å°±ä¸€å®šä¼šå‡ºé—®é¢˜</h3><p>å› ä¸ºæˆ‘æœ‰ä¸¤å—ä¸åŒåˆ†è¾¨ç‡çš„å±å¹•ï¼ŒæŠŠ Unity çª—å£æ‹–è¿‡æ¥å°±å‘ç° ã€Œæ‹–åŠ¨ã€ ä¸è·Ÿæ‰‹äº†ã€‚</p><h2 id="ç®€å•çš„ä¿®å¤"><a class="anchor" href="#ç®€å•çš„ä¿®å¤">#</a> ç®€å•çš„ä¿®å¤</h2><p>ä¸å¾—ä¸è¯´è¿™å°±æ˜¯å…ˆäººçš„æ™ºæ…§ï¼Œä½ çœ‹æ³¨é‡Šéƒ½ç•™å¥½äº†ï¼Œåªéœ€è¦å°å°çš„ä¿®æ”¹â€¦â€¦</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token keyword">var</span></span> mousePosition <span class="token operator">=</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenToWorldPoint</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span>mousePosition<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> camPos <span class="token operator">-</span> <span class="token punctuation">(</span>mousePosition <span class="token operator">-</span> initialPos<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>äºæ˜¯å°±ç‚¸äº†ï¼Œæ‹–åŠ¨è·ç¦»ä¸€è¿œæ‘„åƒæœºå°±å¼€å§‹ç‹‚æŠ–ã€‚</p><p>è€Œæ® Log æ˜¾ç¤º <code>Camera.main.transform.position</code>  å¹¶ä¸åƒåœ¨ Inspector é‡Œä¸€æ ·ä¸åœæ¥å›å˜åŒ–ã€‚</p><p>æŠŠè®¾ç½®æ‘„åƒæœºä½ç½®çš„ä»£ç ç§»åˆ° LateUpdate ä¸­æœ‰æ•ˆæœå—ï¼Œå¹¶æ²¡æœ‰ã€‚</p><h3 id="çœŸå…ˆäººçš„æ™ºæ…§"><a class="anchor" href="#çœŸå…ˆäººçš„æ™ºæ…§">#</a> çœŸãƒ»å…ˆäººçš„æ™ºæ…§</h3><p>æ‰€å¹¸ï¼Œåœ¨æˆ‘æ— æ•°ä¸ªæ—©å¤­çš„é¡¹ç›®é‡Œå‘ç°äº†è¿™æ ·ä¸€æ®µä»£ç ï¼š</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Vector3</span> m <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetAxisRaw</span><span class="token punctuation">(</span><span class="token string">"Mouse X"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Input<span class="token punctuation">.</span><span class="token function">GetAxisRaw</span><span class="token punctuation">(</span><span class="token string">"Mouse Y"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">-=</span> m <span class="token operator">*</span> mainPlay<span class="token punctuation">.</span>MouseSensitivity<span class="token punctuation">;</span></pre></td></tr></table></figure><p>è™½ç„¶æ²¡èƒ½é¿å…ç”¨ç³»æ•°æ¥è¿‘çœŸå®çš„ç§»åŠ¨ï¼Œä¸è¿‡æŠŠä» ã€ŒThe Keyã€ æŒ‰ä¸‹åˆ°æŠ¬èµ·è¿‡ç¨‹çš„å¤§ Delta åˆ†æ•£åˆ°äº†æ¯ä¸€å¸§ï¼Œè¿™æˆ–è®¸æœ‰å¸®åŠ©ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Vector3</span> mousePos <span class="token operator">=</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenToWorldPoint</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span>mousePosition<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse2<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Vector3</span> mouseDelta <span class="token operator">=</span> mousePos <span class="token operator">-</span> lastMousePos<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    </pre></td></tr><tr><td data-num="6"></td><td><pre>    Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">-=</span> mouseDelta<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>lastMousePos <span class="token operator">=</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenToWorldPoint</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span>mousePosition<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>å®Œç¾ï¼Œä»»ä½•åˆ†è¾¨ç‡ï¼Œä»»ä½•ç¼©æ”¾éƒ½å®Œç¾ã€‚</p><h2 id="ç›´åˆ°æœ€åä»ç„¶æœªè§£çš„çƒ‚ç‰‡"><a class="anchor" href="#ç›´åˆ°æœ€åä»ç„¶æœªè§£çš„çƒ‚ç‰‡">#</a> ç›´åˆ°æœ€å<s>ä»ç„¶æœªè§£</s>çš„çƒ‚ç‰‡</h2><p>å…¶å®è¿™ä¸ªä»£ç å¹¶ä¸å¤ªç¬¦åˆæˆ‘çš„é£æ ¼ï¼Œåœ¨åŒä¸€ä¸ª Update é‡Œå‡ºç°äº†ä¸¤ä¸ªç†åº”æ˜¯ç›¸åŒçš„å˜é‡è¿›è¡Œäº†ä¸¤æ¬¡ä¸€æ ·çš„è½¬æ¢</p><p>â€”â€” æˆ‘æœ¬æ¥æ˜¯æƒ³è¿™ä¹ˆè¯´çš„ï¼Œæˆ‘æƒ³äº†ä¸€å¤©ä¸€å¤œï¼Œåœ¨ä¸€ä¸ªæ²¡æœ‰åˆä¼‘çš„ä¸­åˆè¿‡åï¼Œå†™åˆ°äº†è¿™é‡Œ</p><p>â€”â€” äºæ˜¯çªç„¶æˆ‘æ„è¯†åˆ°è¿™ä¸¤ä¸ªçœ‹ä¼¼ç›¸åŒçš„ä¸œè¥¿å®åˆ™ä¸åŒ</p><p>â€”â€” æ‘„åƒæœºç§»åŠ¨äº†ï¼Œäºæ˜¯è½¬æ¢çš„åæ ‡ä¹Ÿæ”¹å˜äº†</p><p>è€Œ lastMousePos ä¸å˜åˆ™æ˜¯åº”è¯¥çš„ï¼Œæˆ‘ä»¬è¦çš„æ­£æ˜¯ ã€Œåœ°å›¾è·Ÿéšé¼ æ ‡ã€ ã€‚</p><p>æ‰€ä»¥ä¸€åˆ‡çš„æŠ–åŠ¨å¤§æŠµéƒ½å‡ºè‡ªæ‘„åƒæœºç§»åŠ¨åï¼ŒlastMousePos å‘ç”Ÿæ¼‚ç§»ï¼Œè€Œæ­¤å‰çš„æ€è·¯æ ¹æœ¬ä¸Šå°±æœ‰é—®é¢˜ â€”â€” è·Ÿæ‰‹çš„æ‹–åŠ¨ï¼ŒinitialPos ä¸ lastPos æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡ Update ä¸­è®¡ç®—å‡ºçš„å·®å€¼å¹¶éé¼ æ ‡å…¨è¿‡ç¨‹çš„<ruby>ä½ç§»<rp> (</rp><rt>delta</rt><rp>)</rp></ruby>ï¼Œè€Œæ˜¯æ®Šé€”åŒå½’çš„å°å°å¢é‡ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Unity/">Unity</category>
      
      <category domain="https://blog.yukx.io/tags/%E6%91%84%E5%83%8F%E6%9C%BA%E7%A7%BB%E5%8A%A8/">æ‘„åƒæœºç§»åŠ¨</category>
      
      <category domain="https://blog.yukx.io/tags/%E6%91%84%E5%83%8F%E6%9C%BA%E6%8A%96%E5%8A%A8/">æ‘„åƒæœºæŠ–åŠ¨</category>
      
      
      <comments>https://blog.yukx.io/2023/04/game-dev-journal-2i-camera-mystery-trembling/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶å…­)ï¼šæ­¦å™¨ã€æŠ•å°„ç‰©</title>
      <link>https://blog.yukx.io/2023/04/game-dev-journal-6-weapons-projectiles/</link>
      <guid>https://blog.yukx.io/2023/04/game-dev-journal-6-weapons-projectiles/</guid>
      <pubDate>Tue, 18 Apr 2023 06:09:16 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªç³»ç»Ÿæ¥æŠŠè¾“å…¥æŒ‡ä»¤ä¼ é€’ç»™æˆ‘ä»¬çš„èˆ°é˜Ÿäº†ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬çš„èˆ°é˜Ÿåˆå°†å¦‚ä½•æ‰§è¡Œå‘½ä»¤å‘¢ï¼Ÿ&lt;br /&gt;
æ›´å…·ä½“ä¸€ç‚¹ï¼Œè¿›è¡Œæ”»å‡»ï¼Ÿ&lt;br /&gt;
&lt;s&gt;æ˜¯ä»¥è±ªè¿ˆçš„æ°”é­„å‘æ•Œäººå‘èµ·å†²é”‹ï¼Œèƒ†æ€¯çš„äººå°†è¿æ¥ç²‰èº«ç¢éª¨çš„å‘½è¿ï¼&lt;/s&gt;&lt;br /&gt;
æ—¢ç„¶æˆ‘ä»¬éƒ½å·²ç»ç™»ä¸Šå¤ªç©ºäº†ï¼Œå½“ç„¶è¦é¿å…è¿™ç§åŸ</description>
        
      
      
      
      <content:encoded><![CDATA[<p>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªç³»ç»Ÿæ¥æŠŠè¾“å…¥æŒ‡ä»¤ä¼ é€’ç»™æˆ‘ä»¬çš„èˆ°é˜Ÿäº†ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬çš„èˆ°é˜Ÿåˆå°†å¦‚ä½•æ‰§è¡Œå‘½ä»¤å‘¢ï¼Ÿ<br />æ›´å…·ä½“ä¸€ç‚¹ï¼Œè¿›è¡Œæ”»å‡»ï¼Ÿ<br /><s>æ˜¯ä»¥è±ªè¿ˆçš„æ°”é­„å‘æ•Œäººå‘èµ·å†²é”‹ï¼Œèƒ†æ€¯çš„äººå°†è¿æ¥ç²‰èº«ç¢éª¨çš„å‘½è¿ï¼</s><br />æ—¢ç„¶æˆ‘ä»¬éƒ½å·²ç»ç™»ä¸Šå¤ªç©ºäº†ï¼Œå½“ç„¶è¦é¿å…è¿™ç§åŸå§‹ä½æ•ˆçš„æ€æˆ®æ–¹å¼ã€‚çœŸç†éƒ¨çš„å·¥ç¨‹å¸ˆä»¬ç»™æˆ‘ä»¬å¸¦æ¥äº†æ›´å¥½çš„é€‰æ‹©ã€‚</p><h2 id="ä¸‡ç‰©çš†å¯å‘å°„çš„ç»ˆæç«ç‚®"><a class="anchor" href="#ä¸‡ç‰©çš†å¯å‘å°„çš„ç»ˆæç«ç‚®">#</a> ä¸‡ç‰©çš†å¯å‘å°„çš„ç»ˆæ â€œç«ç‚®â€</h2><h3 id="æª"><a class="anchor" href="#æª">#</a> æª</h3><p>å…ˆè€ƒè™‘ä¸€äº›åŸºæœ¬å‚æ•°</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Weapon</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">float</span></span> BaseDamage <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">float</span></span> BaseRange <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// æ”»å‡»é—´éš”ï¼Œé˜²æ­¢è¿‡çƒ­ï¼Œéœ€è¦å†·å´æ‰èƒ½è¿›è¡Œä¸‹æ¬¡æ”»å‡»</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">float</span></span> BaseCooldown <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// â€œçƒ­èº«â€ è¿‡ç¨‹ï¼Œè€Œå½“æˆ‘ä»¬åœæ­¢æ”»å‡»ï¼Œåˆé€æ¸å˜å¾—éœ€è¦é‡æ–°è¿›è¡Œé¢„çƒ­</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">float</span></span> BasePrepareTime <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><s>æ”¹æ”¹å‚æ•°å°±å¯ä»¥è¯´è‡ªå·±æ¨å‡ºäº†ä¸€æ¬¾æ–°æ­¦å™¨</s></p><p>ä¸ºäº†ä¿æŠ¤æ­¦å™¨å»¶é•¿ä½¿ç”¨å¯¿å‘½ï¼Œä¸ºå…¶åŠ ä¸Šé™åˆ¶</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Weapon</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> <span class="token function">IsCoolingDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> cooldown<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">float</span></span> <span class="token function">Cooldown</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> cooldown <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>cooldown <span class="token operator">-</span> Time<span class="token punctuation">.</span>dltaTime<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> BaseCooldown<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token class-name"><span class="token keyword">float</span></span> cooldown <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Prepared</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        prepared <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        prepareTime <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>prepareTime <span class="token operator">+</span> Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> BasePrepareTime<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> prepareTime <span class="token operator">>=</span> BasePrepareTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token class-name"><span class="token keyword">bool</span></span> prepared <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token class-name"><span class="token keyword">float</span></span> prepareTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token function">Cooldown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LateUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>prepared<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            prepared <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">IsCoolingDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                prepareTime <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>prepareTime <span class="token operator">-</span> Time<span class="token punctuation">.</span>deltaTime<span class="token operator">*</span><span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> BasePrepareTime<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ â€œå¼€ç«ï¼â€ æ—¶æ£€æµ‹ Prepare å’Œ Cooldown (é¡ºä¾¿è¿›è¡Œäº† Prepare)ï¼Œå½“å¯ä»¥å‘å°„åå°±å‘å°„å¹¶è®¾ç½® Cooldownã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Fire</span><span class="token punctuation">(</span><span class="token class-name">Fleet</span> self<span class="token punctuation">,</span> <span class="token class-name">Fleet</span> target<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Prepared</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">IsCoolingDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">LaunchProjectile</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    cooldown <span class="token operator">=</span> BaseCooldown<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LaunchProjectile</span><span class="token punctuation">(</span><span class="token class-name">Fleet</span> self<span class="token punctuation">,</span> <span class="token class-name">Fleet</span> target<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="å¼¹"><a class="anchor" href="#å¼¹">#</a> å¼¹</h3><p>æªå·²ç»å‡†å¤‡å¥½äº†ï¼Œåªéœ€è¦å­å¼¹äº†ï¼Œé‚£è¿™å°±ç®€å•äº†ï¼Œæˆ‘ä»¬å®é™…ä¸Šåªéœ€è¦ä¸¤ä¸ªè¦ç´ ï¼š</p><ol><li>ç§»åŠ¨è·¯å¾„</li><li>å‘½ä¸­åˆ¤å®š</li></ol><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LaserProjectile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Projectile</span></span> <span class="token comment">// ç»§æ‰¿è‡ª MonoBehaviour</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Vector2</span> from<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Vector2</span> to<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Action<span class="token punctuation">&lt;</span>Fleet<span class="token punctuation">></span></span> OnHit<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// Update is called once per frame</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LateUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> collider <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Collider2D<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> hitList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Collider2D</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>collider<span class="token punctuation">.</span><span class="token function">OverlapCollider</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> layerMask <span class="token operator">=</span> LayerMask<span class="token punctuation">.</span><span class="token function">GetMask</span><span class="token punctuation">(</span><span class="token string">"PlayerControls"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> hitList<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>hitList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Fleet<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token class-name">Fleet</span> fleet <span class="token operator">&amp;&amp;</span> fleet <span class="token operator">!=</span> self <span class="token operator">&amp;&amp;</span> fleet<span class="token punctuation">.</span>Team <span class="token operator">!=</span> self<span class="token punctuation">.</span>Team<span class="token comment">/*friendly fire*/</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                OnHit<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>fleet<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token function">Destroy</span><span class="token punctuation">(</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        transform<span class="token punctuation">.</span>position <span class="token operator">=</span> Vector2<span class="token punctuation">.</span><span class="token function">MoveTowards</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> to<span class="token punctuation">,</span> speed <span class="token operator">*</span> Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">LaserProjectile</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token class-name">Fleet</span> self<span class="token punctuation">,</span> <span class="token class-name">Fleet</span> target<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>Fleet<span class="token punctuation">></span></span> onHit<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> r <span class="token operator">=</span> Quaternion<span class="token punctuation">.</span><span class="token function">LookRotation</span><span class="token punctuation">(</span>Vector3<span class="token punctuation">.</span>forward<span class="token punctuation">,</span> target<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">-</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> projectile <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>LaserProjectilePrefab<span class="token punctuation">,</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LaserProjectile<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>        projectile<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        projectile<span class="token punctuation">.</span>self <span class="token operator">=</span> self<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>        projectile<span class="token punctuation">.</span>from <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        projectile<span class="token punctuation">.</span>to <span class="token operator">=</span> target<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        projectile<span class="token punctuation">.</span>OnHit <span class="token operator">=</span> onHit<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token keyword">return</span> projectile<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œç®€å•åˆ¶ä½œäº†ä¸€æšå¼¹è¯ï¼šç›´çº¿è¿åŠ¨ï¼Œä¸èƒ½è¿½è¸ªç›®æ ‡<br />åœ¨ Update ä¸­è¿›è¡Œç§»åŠ¨ï¼Œåœ¨ LateUpdate ä¸­è¿›è¡Œå‘½ä¸­åˆ¤å®šï¼Œåœ¨åˆ›å»ºæ—¶è®¾ç½®ç›®æ ‡ç­‰ä¸€ç³»åˆ—å‚æ•°ã€‚<br />å‘½ä¸­æ—¶è§¦å‘å‘½ä¸­äº‹ä»¶è¿›è¡Œè¯¸å¦‚é€ æˆä¼¤å®³ä¹‹ç±»çš„è¡Œä¸ºã€‚</p><h4 id="å¤–é¢˜"><a class="anchor" href="#å¤–é¢˜">#</a> å¤–é¢˜</h4><p>è¿‘æ¥æœ‰å¯¹ Shader è¿›è¡Œä¸€å®šäº†è§£ï¼Œå°†æŠ•å°„ç‰©æ•´ä½“è¿åŠ¨ä¹Ÿäº¤ç»™ Shader ä¸çŸ¥é“æ˜¯å¦å¯è¡Œï¼Ÿ<br />ä½¿ç”¨ä¸€å¼ è¦†ç›–æ•´ä¸ªåœ°å›¾çš„æè´¨ï¼Œåœ¨ä¸Šé¢ç»˜åˆ¶å¼¹é“ï¼Œå¯¹å¤§é‡çš„ï¼Œè§„åˆ™è¿åŠ¨çš„ ã€Œå¼¹å¹•ã€ åº”è¯¥æ˜¯ä¸ªå¾ˆå¥½çš„ä¼˜åŒ–åŠæ³•ã€‚</p><p>â€”â€” ç”±æ­¤å»¶ç”³ï¼Œæˆ˜äº‰è¿·é›¾ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ Shader ä¸­è®¡ç®—èŒƒå›´ï¼Œè€Œéæ˜¯åŸºäºç½‘æ ¼çš„å¾ªç¯éå†ï¼Œä¸è¿‡é®æŒ¡çš„å¤„ç†æˆ–è®¸ç•¥æœ‰å¤æ‚ã€‚<br />è¿™å¤§æ¦‚èƒ½æŒ½å›æˆ‘ä¸¢å¤±çš„ 200 å¤šå¸§å§ï¼Œæ˜¯çš„ï¼Œä¹‹å‰çš„å®ç°è¦æ¶ˆè€—æ‰ 200 å¤šå¸§ï¼Œç”šè‡³ç•¥æœ‰å¡é¡¿ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Weapon/">Weapon</category>
      
      <category domain="https://blog.yukx.io/tags/Projectile/">Projectile</category>
      
      
      <comments>https://blog.yukx.io/2023/04/game-dev-journal-6-weapons-projectiles/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶â„‚(5,2))ï¼šè¾“å…¥ã€é€‰ä¸­</title>
      <link>https://blog.yukx.io/2023/04/game-dev-journal-5-2i-input-selection/</link>
      <guid>https://blog.yukx.io/2023/04/game-dev-journal-5-2i-input-selection/</guid>
      <pubDate>Fri, 07 Apr 2023 02:53:41 GMT</pubDate>
      
        
        
      <description>&lt;div class=&quot;note default no-icon&quot;&gt;
&lt;p&gt;ä¸€é‡åˆ°é¼ æ ‡ï¼Œäº‹æƒ…å°±ä¼šå˜çš„å¤æ‚èµ·æ¥&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;åœ¨æ›¾ç»çš„&lt;a href=&quot;/2022/06/game-dev-journal-2-unit-selection-and-minimap-mor</description>
        
      
      
      
      <content:encoded><![CDATA[<div class="note default no-icon"><p>ä¸€é‡åˆ°é¼ æ ‡ï¼Œäº‹æƒ…å°±ä¼šå˜çš„å¤æ‚èµ·æ¥</p></div><p>åœ¨æ›¾ç»çš„<a href="/2022/06/game-dev-journal-2-unit-selection-and-minimap-more/">æ–‡ç« </a>é‡Œå·²ç»åšäº†ä¸€ä¸ªé€‰æ‹©åŠŸèƒ½çš„é›å½¢ï¼Œåˆ°äº†ç°åœ¨ï¼Œå¯ä»¥å‘ç°ï¼Œè¿™ä¹Ÿåªèƒ½ç®—æ˜¯ä¸€ä¸ªåŸå‹ã€‚<s>ä»€ä¹ˆï¼Œè¿™ä¹ˆé•¿æ—¶é—´è¿‡å»äº†è¿˜æ²¡å¼ƒå‘ï¼</s></p><p>ç¡®å®æ˜¯èµ°äº†ä¸€æ®µå¾ˆéš¾è¯´æ˜¯ä¸æ˜¯æ­§é€”çš„å¼¯è·¯ã€‚</p><p>ç®€å•çš„è¯´ï¼Œä½œä¸ºä¸€ä¸ª RTS ç±»å‹ä¸ºæºå¤´çš„æ¸¸æˆï¼Œé¼ æ ‡çš„é‡è¦æ€§ä¸å¿…å†è¯´ï¼ˆä»€ä¹ˆä½ æ˜¯è§¦æ‘¸å±ï¼Ÿï¼‰ï¼ŒæŒ‡æŒ‡ç‚¹ç‚¹ã€æ¡†æ¡† A ä¸Šå»ï¼›è€Œä¸å·§ï¼Œæˆ‘ä»¬è¦åšçš„ä¸œè¥¿æœ‰å‡ å¥—ä¸åŒçš„é€»è¾‘éƒ½è¦ç”¨è¿™ä¸€å¥—äº¤äº’ï¼Œè¿˜è¦åœ¨å½¼æ­¤é—´åˆ‡æ¢ã€‚å½¢è±¡ç‚¹è¯´ï¼Œç±»ä¼¼å»ºç­‘è§„åˆ’ä¸å•ä½æ“ä½œä¹‹é—´çš„å…³ç³»ã€‚</p><h2 id="çŠ¶æ€æœº"><a class="anchor" href="#çŠ¶æ€æœº">#</a> çŠ¶æ€æœº</h2><p>èªæ˜å¦‚ä½ æœªå¿…æƒ³ä¸åˆ°è¿™ä¸ªåŠæ³•ï¼Œæ¥åˆ†å‰²ä¸åŒçš„é€»è¾‘ã€‚<br />æƒ³ä¸åˆ°ä¹Ÿæ²¡å…³ç³»ï¼Œ<a href="https://gpp.tkchu.me/state.html">å¿«æ¥å­¦</a>ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">internal</span> <span class="token class-name">InputState</span> inputState <span class="token operator">=</span> InputState<span class="token punctuation">.</span>DefaultInputState<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name"><span class="token keyword">var</span></span> next <span class="token operator">=</span> inputState<span class="token punctuation">.</span><span class="token function">GetNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> inputState<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        inputState<span class="token punctuation">.</span><span class="token function">OnLeave</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        next<span class="token punctuation">.</span><span class="token function">OnEnter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        inputState <span class="token operator">=</span> next<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿™ä¸‹çœ¼ä¸è§å¿ƒä¸çƒ¦äº†ï¼æˆ‘ä»¬è¿˜å¯ä»¥åƒé‚£äº›ç‰›é€¼å“„å“„çš„é¡¹ç›®ä¸€æ ·ï¼Œ<ruby>ä¸€ä¸ª State å°±å†™ä¸€ä¸ª æ–‡ä»¶<rp> (</rp><rt>ä¸€ä¸ª æ–‡ä»¶  å°±å†™ä¸€ä¸ª State</rt><rp>)</rp></ruby> äº†ï¼<ruby>å¯å–œå¯è´º<rp> (</rp><rt>ãŠã‚ã§ã¨</rt><rp>)</rp></ruby>ï¼Œ<ruby>å¯å–œå¯è´º<rp> (</rp><rt>ãŠã‚ã§ã¨</rt><rp>)</rp></ruby>ï¼<br />åŒæ—¶æˆ‘ä»¬è¿˜èƒ½è½»æ˜“æ”¯æŒçŠ¶æ€æ‰“æ–­ <code>.SetNext()</code> ã€ <code>.GetNext()</code>  å’Œä¼˜é›…çš„çŠ¶æ€è¿›å…¥ã€ç¦»å¼€çš„å¤„ç†ã€‚</p><p>è¿™æ ·å°±æŠŠä¸€ä¸ªéšè—çš„é—®é¢˜æ‘†åˆ°äº†æˆ‘ä»¬çš„é¢å‰ï¼šæ˜¯å¦æœ‰å¿…è¦æ¯ä¸ªçŠ¶æ€éƒ½è‡ªå·±å®ç°ä¸€éå¯¹è¾“å…¥çš„å¤„ç†ï¼Ÿ</p><h2 id="è¾“å…¥ç³»ç»Ÿ-é€‰æ‹©"><a class="anchor" href="#è¾“å…¥ç³»ç»Ÿ-é€‰æ‹©">#</a> è¾“å…¥ç³»ç»Ÿ - é€‰æ‹©</h2><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæƒ³è¦ä¸€ä¸ªä¸“é—¨çš„ç³»ç»Ÿæ¥å¤„ç†ä¸€åˆ‡ç”¨æˆ·çš„è¾“å…¥å’Œè¾“å…¥å¸¦æ¥çš„ç»“æœï¼Œè€Œåªéœ€è¦ç»™æŒ‡å®šäº‹ä»¶æä¾›å…¶å¯¹åº”çš„åŠŸèƒ½ã€‚<br />åœ¨èƒ½å¤Ÿæ”¹é”®çš„æ¸¸æˆé‡Œåº”è¯¥å¾ˆå¸¸è§ï¼Œä¸å¦‚è¯´ä½œä¸ºæ¸¸æˆå¼•æ“åº”è¯¥æ˜¯ä¼šæœ‰è¿™æ ·çš„æ’ä»¶çš„å§ï¼Ÿ</p><p>ä½†æ˜¯å¾ˆä¸å¹¸ï¼Œæœ¬ä½œ â€”â€” å¦‚æœå®Œæˆå‘å¸ƒçš„è¯ï¼Œæœ‰å¾ˆå¤šä¸åŒçš„æ¡†é€‰ / é€‰æ‹©æ“ä½œï¼›å§‘ä¸”é€éœ²ä¸‹ï¼Œå¦‚æœæœ‰è¿‡ RTS æ¸¸æˆç»éªŒçš„äººï¼Œå¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ° â€œé€‰æ‹©å•ä½ -&gt; ä¸‹è¾¾å‘½ä»¤â€ è¿™ä¸ªæµç¨‹ï¼Œè€Œæˆ‘åè¦åŠ å…¥ä¸€ä¸ª â€œä¸‹è¾¾å‘½ä»¤ -&gt; é€‰æ‹©å•ä½æ‰§è¡Œâ€ æµç¨‹ã€‚<br />è€Œå³ä¾¿ä¸æåŒæ ·çš„è¡Œä¸ºä¸åŒçš„åŠŸèƒ½ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç¼–é˜Ÿé¢æ¿ï¼Œæˆ‘æƒ³è®©è¿™ä¸ªé¢æ¿ä¹Ÿæ”¯æŒ â€œé€‰æ‹©å•ä½æ‰§è¡Œâ€ï¼Œé‚£ä¹ˆç»™é¢æ¿å†™ä¸€ä¸ªé€»è¾‘å†æ‰‹åŠ¨æ‰“æ–­ â€œé€‰æ‹©å•ä½â€ çš„çŠ¶æ€æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚<br />æˆ‘ä»¬é¢å¯¹çš„ä¸œè¥¿è¦æ›´è¿«åˆ‡ä¸€äº›ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">InputSystem</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name">GameObject<span class="token punctuation">[</span><span class="token punctuation">]</span></span> SelectedGameObjects <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Event</span> OnSelectionChanged<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetSelection</span><span class="token punctuation">(</span><span class="token class-name">GameObject<span class="token punctuation">[</span><span class="token punctuation">]</span></span> selections<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">//... HandleSelction()</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿™æ ·çš„ä¸€ä¸ªä¸œè¥¿å¤§æ¦‚å°±èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦äº†ï¼Œæ ¹æ®éœ€è¦å¯èƒ½è¦åŠ å…¥ Predication æ¥æ¸…é™¤ä¸éœ€è¦çš„é€‰æ‹©ï¼Œæˆ–è€…æ˜¯å¹²è„†ä¸€ç‚¹ç”¨ LayerMask ç­›é€‰ï¼›ä»¥åŠ â€”â€”<br /><em> å…³é—­è¿™å¥—åŠŸèƒ½çš„å¼€å…³</em><br />æ€»æœ‰äº›æ—¶å€™ä¼šè€ƒè™‘ä¸å‘¨<s>æ¥é…’å§é‡Œç‚¹ç‚’é¥­</s>å˜›æ˜¯ä¸æ˜¯ã€‚</p><h2 id="è¾“å…¥ç³»ç»Ÿ-å‘½ä»¤"><a class="anchor" href="#è¾“å…¥ç³»ç»Ÿ-å‘½ä»¤">#</a> è¾“å…¥ç³»ç»Ÿ - å‘½ä»¤</h2><p>å¦‚ä¸Šæ‰€è¯´ï¼Œè¿™æ ·ä¸€ä¸ª InputSystem å¦‚æœåªæ˜¯å¤„ç†ä¸‹é¼ æ ‡é€‰æ‹©ï¼Œé‚£ä¹ˆä¹Ÿç¨æ˜¾è´«å¼±äº†ã€‚<br />é‚£ä¹ˆä¾¿æ¥è€ƒè™‘ä¸‹ â€œå¸¸è§„â€ çš„å‘½ä»¤ã€æ”¹é”®ç›¸å…³çš„ä¸œè¥¿ï¼Œä¸è¿‡ç›´æ¥åšä¸€ä¸ªå‘½ä»¤è¡¨é”®ä½æ˜ å°„ä»€ä¹ˆçš„è·Ÿæˆ‘ä»¬çš„é¡¹ç›®ä¸æ˜¯å¾ˆæ­ â€”â€” ä¸åŒçš„è¾“å…¥çŠ¶æ€åˆ†å‰²äº†ä¸åŒçš„è¾“å…¥å‘½ä»¤ã€‚</p><p>ç”±æ­¤æš‚ä¸”æ„æƒ³è¿™æ ·ä¸€ä¸ªä¸œè¥¿</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>InputSystem<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">commandName</span><span class="token punctuation">:</span> <span class="token string">"attack-intent"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">defaultKey</span><span class="token punctuation">:</span> KeyCode<span class="token punctuation">.</span>A<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>è€Œæ˜¾ç„¶æ˜¯å…è®¸ä¸€ä¸ª commandName å…·æœ‰å¤šä¸ª handler éšçŠ¶æ€è¿›è¡Œåˆ‡æ¢çš„ï¼Œé‚£ä¹ˆè€ƒè™‘å¤šå¤„çš„é‡å¤ commandNameï¼Œä¹Ÿè®¸å¯ä»¥ç”¨å…¶é¦–å­—æ¯ä½œä¸ºé»˜è®¤é”®ã€‚<span class="spoiler" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">War3 çš„å…ˆè¿›ç»éªŒ</span><br />éšåå°±åœ¨è¿è¡Œæ—¶æŠŠä¸å­˜åœ¨çš„ ã€Œå‘½ä»¤ - é”®ä½ æ˜ å°„ã€ è¾“å‡ºä¿å­˜åˆ°ä»€ä¹ˆæ–‡ä»¶ï¼Œæ­¤åå¯é«˜æ•è€Œæ— å¿§ä¹Ÿï¼</p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/%E9%BC%A0%E6%A0%87%E6%A1%86%E9%80%89%E5%8D%95%E4%BD%8D/">é¼ æ ‡æ¡†é€‰å•ä½</category>
      
      <category domain="https://blog.yukx.io/tags/Selection/">Selection</category>
      
      <category domain="https://blog.yukx.io/tags/Input-System/">Input System</category>
      
      
      <comments>https://blog.yukx.io/2023/04/game-dev-journal-5-2i-input-selection/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>C# çš„ä¸€äº›é—®é¢˜æ“ä½œ â…¡</title>
      <link>https://blog.yukx.io/2023/02/csharp-questionable-techs/</link>
      <guid>https://blog.yukx.io/2023/02/csharp-questionable-techs/</guid>
      <pubDate>Sun, 12 Feb 2023 13:41:53 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;çœæµï¼šåœ¨ C# ä¸­é™æ€æˆå‘˜æ˜¯ç›¸åŒç±»å‹å…±æœ‰çš„ï¼Œå³ï¼Œæ´¾ç”Ÿç±»å‹ä¸åŸºç±»å‹å…¬ç”¨åŒä¸€ä¸ªé™æ€æˆå‘˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;figure class=&quot;highlight csharp&quot;&gt;&lt;figcaption data-lang=&quot;C#&quot;&gt;&lt;/figcaption&gt;&lt;table&gt;</description>
        
      
      
      
      <content:encoded><![CDATA[<p>çœæµï¼šåœ¨ C# ä¸­é™æ€æˆå‘˜æ˜¯ç›¸åŒç±»å‹å…±æœ‰çš„ï¼Œå³ï¼Œæ´¾ç”Ÿç±»å‹ä¸åŸºç±»å‹å…¬ç”¨åŒä¸€ä¸ªé™æ€æˆå‘˜ã€‚</p><p>ä¾‹å¦‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Base</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Base</span></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>Base.data</code>  åï¼Œè®¿é—® <code>A.data</code>  ä¹Ÿä¼šè·å¾—ä¿®æ”¹åçš„å€¼ã€‚<br />å¾ˆ trivial å¯¹ä¸å¯¹ï¼Ÿ</p><h2 id="the-non-trivials"><a class="anchor" href="#the-non-trivials">#</a> The Non-trivials</h2><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td data-command=""></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Base<span class="token punctuation">&lt;</span>K<span class="token punctuation">,</span> V<span class="token punctuation">></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td data-command=""></td><td><pre>    <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span>K<span class="token punctuation">,</span> V<span class="token punctuation">></span></span> data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre>    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre>        <span class="token comment">// ... save data to somewhere</span></pre></td></tr><tr><td data-num="6"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td data-command=""></td><td><pre>    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td data-command=""></td><td><pre>        <span class="token comment">// ... load data from somewhere</span></pre></td></tr><tr><td data-num="9"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td data-command=""></td><td><pre><span class="token keyword">class</span> <span class="token class-name">SomeDataType</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Base<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> SomeDataType<span class="token punctuation">></span></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td data-command=""></td><td><pre>    <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">></span></span> otherNewData<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td data-command=""></td><td><pre>    <span class="token keyword">new</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td data-command=""></td><td><pre>        Base<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> SomeDataType<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td data-command=""></td><td><pre>        <span class="token comment">// ... save new data to somewhere</span></pre></td></tr><tr><td data-num="19"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td data-command=""></td><td><pre>    <span class="token keyword">new</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td data-command=""></td><td><pre>        Base<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> SomeDataType<span class="token operator">></span><span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td data-command=""></td><td><pre>        <span class="token comment">// ... load new data from somewhere</span></pre></td></tr><tr><td data-num="24"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¾—ä»¥æ­£å¸¸è¿ä½œã€‚<br />è™½ç„¶ç»†æƒ³ä¸€ä¸‹å°±å¯ä»¥æ˜ç™½ï¼Œä¸è¿‡åˆæ¬¡é‡è§è¿˜æ˜¯æœ‰äº›è¢«è¿·æƒ‘ä½ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      
      <category domain="https://blog.yukx.io/tags/%E8%A8%80%E5%B0%BD%E4%BA%8E%E8%A1%8C/">è¨€å°½äºè¡Œ</category>
      
      <category domain="https://blog.yukx.io/tags/C/">C#</category>
      
      <category domain="https://blog.yukx.io/tags/Static-method-hiding/">Static method hiding</category>
      
      <category domain="https://blog.yukx.io/tags/Inheritance/">Inheritance</category>
      
      
      <comments>https://blog.yukx.io/2023/02/csharp-questionable-techs/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Bevyã€è´ªåƒè›‡ï¼Œä¸ä¸€äº›è®°å½•</title>
      <link>https://blog.yukx.io/2023/02/bevy-the-snake-and-notes/</link>
      <guid>https://blog.yukx.io/2023/02/bevy-the-snake-and-notes/</guid>
      <pubDate>Mon, 06 Feb 2023 09:02:25 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;æœ¬æ–‡åŸºäº &lt;a href=&quot;https://mbuffett.com/posts/bevy-snake-tutorial/&quot;&gt;Creating a Snake Clone in Rust, with Bevy&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä»“åº“åœ°å€ &lt;a href=&quot;https:/</description>
        
      
      
      
      <content:encoded><![CDATA[<p>æœ¬æ–‡åŸºäº <a href="https://mbuffett.com/posts/bevy-snake-tutorial/">Creating a Snake Clone in Rust, with Bevy</a></p><p>ä»“åº“åœ°å€ <a href="https://github.com/hxYuki/a_snake">a_snake</a></p><iframe src="/nested/bevy-snake" title="sample" height="500" width="500"></iframe><div class="note default"><p>ä»£ç ç°å·²æ›´æ–°åˆ° 0.10</p><p>Window ç°å·²æˆä¸º Entityï¼Œä¸åœ¨å­˜åœ¨æ›¾ç»çš„<a href="#%E5%B0%9A%E5%AD%98%E5%9C%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E9%97%AE%E9%A2%98">é—®é¢˜</a></p></div><h2 id="ä¸æºæ–‡ä¸­çš„ä¸€äº›åŒºåˆ«"><a class="anchor" href="#ä¸æºæ–‡ä¸­çš„ä¸€äº›åŒºåˆ«">#</a> ä¸æºæ–‡ä¸­çš„ä¸€äº›åŒºåˆ«</h2><p>é™¤äº†ä½¿ç”¨æ›´é«˜ç‰ˆæœ¬çš„ Bevy ä»¥å¤–<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>ï¼Œä¸»è¦æ”¹åŠ¨åœ¨äºæ²¡æœ‰ä½¿ç”¨ Resource ä¿å­˜ <code>SnakeSegments</code> ã€ <code>LastTailPosition</code> ï¼Œè€Œæ˜¯ä¿å­˜åœ¨äº† <code>SnakeHead</code>  ä¸­ã€‚<br />ä¸ªäººè®¤ä¸ºè¿™ä¸¤ä¸ªæ•°æ®ä¸æ˜¯å¾ˆé€‚åˆä½œä¸º Resourceï¼Œè›‡èº«çš„å®ä½“ ID ä¸ä¹‹å‰çš„å°¾éƒ¨ä½ç½®éƒ½æ˜¯ä¸è›‡å…³è”ç€çš„æ•°æ®ï¼Œ <s>å¦‚æœæœ‰å¤šæ¡è›‡å­˜åœ¨çš„è¯</s> æ•…å­˜å‚¨åˆ°è›‡å¤´çš„ç»„ä»¶ä¸­ã€‚</p><h2 id="å¯¹äºæºæ–‡çš„ä½œä¸š"><a class="anchor" href="#å¯¹äºæºæ–‡çš„ä½œä¸š">#</a> å¯¹äºæºæ–‡çš„ â€œä½œä¸šâ€</h2><ol><li>è›‡çš„ 180Â° è½¬å‘<br />æ€è·¯æœ‰äºŒï¼Œå…¶ä¸€æ˜¯ä½¿ç”¨ Eventsï¼Œ <code>snake_movement_input</code>  ä¸­ä¸å†ç›´æ¥ä¿®æ”¹ <code>head.direction</code>  è€Œæ”¹ä¸ºå‘é€äº‹ä»¶ï¼Œå‘é€å‰æ¸…ç©ºæœªå¤„ç†çš„äº‹ä»¶ï¼Œåœ¨ <code>snake_movement</code>  ä¸­æ¥æ”¶äº‹ä»¶ä¿®æ”¹ <code>direction</code> ï¼›å…¶äºŒä¹Ÿé›·åŒï¼Œä¸ä½¿ç”¨ Eventsï¼Œå¦å¤–å­˜å‚¨ <code>next_direction</code>  å³å¯ã€‚</li><li>é£Ÿç‰©å¯ä»¥ç”Ÿæˆåœ¨è›‡èº«ä¸Š<br />éå†æ‰€æœ‰ <code>SnakeSegment</code> ï¼ˆå…¶å®ä¹Ÿåº”è¯¥åŒ…å« <code>Food</code> ï¼‰çš„ä½ç½®ï¼Œé‡å¤åˆ™é‡æ–°ç”Ÿæˆéšæœºä½ç½®ï¼ˆæˆ–è€…ç›´æ¥ returnï¼‰ã€‚<br />ä¸è¿‡é£Ÿç‰©æœ€å¥½åº”å½“åœ¨ä¸Šä¸€ä¸ªè¢«åƒæ‰åå†ç”Ÿæˆï¼Œå±å¹•å¡«æ»¡ä¸çŸ¥é“æ˜¯å¦ä¼šå¡ä½å‘¢ï¼Ÿ<br />å…¶å®æ›´å¥½çš„æ–¹æ³•ä¼¼ä¹æœ‰ä¸¤ä¸ªï¼Œç¢°æ’æ£€æµ‹ï¼Œä¸è¿‡åœ¨å½“å‰ç‰ˆæœ¬çš„ Bevy ä¸­å°šä¸æ”¯æŒ Physicsï¼›æˆ–æ˜¯å­˜å‚¨ç½‘æ ¼çŸ©é˜µï¼Œæ£€æµ‹ <code>grid[i][j]</code>  ä¸­æ˜¯å¦æœ‰ç‰©ä½“ï¼Œå¦‚æœä¸ç”¨å¼•æ“å®ç°æ¸¸æˆçš„è¯ï¼Œè¯¥æ–¹æ³•æ˜¯å¾ˆè‡ªç„¶çš„é€‰æ‹©ã€‚</li></ol><h2 id="å°šå­˜åœ¨çš„ä¸€äº›å°é—®é¢˜"><a class="anchor" href="#å°šå­˜åœ¨çš„ä¸€äº›å°é—®é¢˜">#</a> å°šå­˜åœ¨çš„ä¸€äº›å°é—®é¢˜</h2><p>å…³é—­çª—å£æ—¶ä¼šç”±äºä½¿ç”¨äº† <code>Res&lt;Windows&gt;</code> -&gt; <code>get_primary().unwrap()</code>  unwrap å…ˆæŠ›å‡ºå¯¼è‡´æ•´ä¸ªçª—å£å¡ä½ã€‚ï¼ˆå¶å°”å¯ä»¥æ­£å¸¸é€€å‡ºï¼‰</p><hr class="footnotes-sep" /><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>WindowDescripter ä¸å†ç›´æ¥å¯ç”¨äº Resource <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      
      <category domain="https://blog.yukx.io/tags/Bevy/">Bevy</category>
      
      <category domain="https://blog.yukx.io/tags/Rust/">Rust</category>
      
      
      <comments>https://blog.yukx.io/2023/02/bevy-the-snake-and-notes/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ObservableCollection ä¹‹æ‰¹æ¬¡æ›´æ–°</title>
      <link>https://blog.yukx.io/2022/12/bulk-update-ObservableCollection/</link>
      <guid>https://blog.yukx.io/2022/12/bulk-update-ObservableCollection/</guid>
      <pubDate>Mon, 12 Dec 2022 14:13:14 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;ä½¿ç”¨ç¤ºä¾‹&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#ä½¿ç”¨ç¤ºä¾‹&quot;&gt;#&lt;/a&gt; ä½¿ç”¨ç¤ºä¾‹&lt;/h2&gt;
&lt;figure class=&quot;highlight csharp&quot;&gt;&lt;figcaption data-lang=&quot;C#&quot;&gt;&lt;/figcaption&gt;&lt;table</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="ä½¿ç”¨ç¤ºä¾‹"><a class="anchor" href="#ä½¿ç”¨ç¤ºä¾‹">#</a> ä½¿ç”¨ç¤ºä¾‹</h2><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">BatchUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    collection<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token comment">// Some Addition</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    collection<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token comment">// Some Removal</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// And then only one time OnCollectionChanged trigged.</span></pre></td></tr></table></figure><h2 id="å®ç°ä»£ç "><a class="anchor" href="#å®ç°ä»£ç ">#</a> å®ç°ä»£ç </h2><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BulkObservableCollection<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ObservableCollection<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">bool</span></span> _suppressNotification <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollectionChanged</span><span class="token punctuation">(</span><span class="token class-name">NotifyCollectionChangedEventArgs</span> e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_suppressNotification<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnCollectionChanged</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name">IDisposable</span> <span class="token function">BatchUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        _suppressNotification <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UpdateToken</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">UpdateToken</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDisposable</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">private</span> <span class="token class-name">BulkObservableCollection<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> oc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">public</span> <span class="token function">UpdateToken</span><span class="token punctuation">(</span><span class="token class-name">BulkObservableCollection<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> cl<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            oc <span class="token operator">=</span> cl <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            oc<span class="token punctuation">.</span>_suppressNotification <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            oc<span class="token punctuation">.</span><span class="token function">OnCollectionChanged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">NotifyCollectionChangedEventArgs</span><span class="token punctuation">(</span>NotifyCollectionChangedAction<span class="token punctuation">.</span>Reset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      
      <category domain="https://blog.yukx.io/tags/C/">C#</category>
      
      <category domain="https://blog.yukx.io/tags/ObservableCollection/">ObservableCollection</category>
      
      
      <comments>https://blog.yukx.io/2022/12/bulk-update-ObservableCollection/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>é­”æ³•ä¸Šç½‘ç¢ç¢å¿µ</title>
      <link>https://blog.yukx.io/2022/11/noise-about-magic-surfing/</link>
      <guid>https://blog.yukx.io/2022/11/noise-about-magic-surfing/</guid>
      <pubDate>Thu, 17 Nov 2022 20:17:16 GMT</pubDate>
      
        
        
      <description>&lt;div class=&quot;note warning&quot;&gt;
&lt;p&gt;LONG may the empire.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;VMessTCPTLS è·‘äº†å¥½ä¹…äº†ï¼Œæœ€è¿‘ç»ˆäºåœ¨ IPv4 ä¸ŠæŒ‚äº†ï¼Œè™½ç„¶ä¹Ÿä¸ç¡®å®šã€‚&lt;br /&gt;
æ¯•ç«Ÿæœ¬åœ°çš„è¿è¥å•†æ€è·¯éå¸¸å¹¿ï¼Œéªšæ“ä½œä¹Ÿéå¸¸å¤šï¼ŒDNS å‘è„¾</description>
        
      
      
      
      <content:encoded><![CDATA[<div class="note warning"><p>LONG may the empire.</p></div><p>VMessTCPTLS è·‘äº†å¥½ä¹…äº†ï¼Œæœ€è¿‘ç»ˆäºåœ¨ IPv4 ä¸ŠæŒ‚äº†ï¼Œè™½ç„¶ä¹Ÿä¸ç¡®å®šã€‚<br />æ¯•ç«Ÿæœ¬åœ°çš„è¿è¥å•†æ€è·¯éå¸¸å¹¿ï¼Œéªšæ“ä½œä¹Ÿéå¸¸å¤šï¼ŒDNS å‘è„¾æ°”ä¸è§£æå¤–éƒ¨åŸŸåæ˜¯å¸¸æœ‰çš„äº‹ï¼Œå›ºå®šå®½å¸¦å°šä¸”å¦‚æ­¤ï¼ŒåŸºç«™çš„ç©æ³•æ›´æ˜¯èŠ±æ ·é¢‘å‡ºï¼Œç»™ä½ åˆ†é…ä¸€äº›ç”³å¿…åœ°å€<br /><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20221118123415.png" alt="?" title="***" /><br /> çœŸæ˜¯è®©äººå—å® è‹¥æƒŠã€‚<br />ç”±äºæœ€è¿‘çš„ç½‘ç»œç¯å¢ƒå·²ç»ä¸å†å‚é’äºæˆ‘ï¼Œç»ˆäºè¢«è¿«è¶ç€æ˜Ÿå…‰å°šèƒ½äº®èµ·çš„æ—¶å€™è¿ç§»åˆ°äº†æ–°å®¶ã€‚</p><p>IPv4 çš„åœ°å€å·²ç»æš´éœ²ï¼Œç½‘é¡µå°šèƒ½æµè§ˆï¼Œè€Œä¼ ç»Ÿé­”æ³•ç»“æ„å·²ç»ä¸èƒ½ç»´æŒäº†ã€‚</p><ul><li>CDN å¤§æ³•å¥½ï¼</li><li>ä»…æœ‰ WebSocket å¯ä»¥é€šè¿‡ CDN</li></ul><p>ç»è¿‡ä¸€äº›è¯•é”™ï¼Œå¦‚æœæ„ç­‘æ³•æœ¯æ—¶ä¿ç•™äº† TLS çš„è¯ï¼ŒCDN ä¹Ÿè¦è‡³å°‘å°†ç­‰çº§æå‡åˆ°â€™Fullâ€™ã€‚<span class="spoiler blur" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">ä¸ä¼šæœ‰äººä¸ç”¨ Cloudflare å§</span></p><p>ç½‘é¡µå¯ä»¥è®¿é—®çš„è¯ï¼Œä¸å¦‚åšæˆåšä¸ªå…¨å¥—ï¼Œä¸ºæµé‡è®¾ç½®ä¸€ä¸ª Fallbackã€‚</p><ul><li>Fallback ä»…æ”¯æŒ TCP æ–¹å¼</li></ul><p>Fallback åé¢éƒ½æ˜¯æœ¬æœºäº†ï¼Œæ‰€ä»¥ TLS çš„ä¿éšœä¹Ÿå¯ä»¥åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¦ä¸€ç‚¹â€™alpnâ€™ã€‚<br />HTTP/2 çš„æµé‡ Fallback ä¸‹å»ä¹Ÿä¼šæ˜¯ HTTP/2ï¼Œç¡®ä¿åº•å±‚å¯ä»¥æ¥ä½ h2 æµé‡ä»¥å…ç½‘é¡µæ— æ³•è®¿é—®ã€‚æˆ–è€…å¹²è„†ä¸è¦åœ¨å‰é¢æ·»åŠ  h2 çš„ alpnã€‚</p><h2 id="æ³¨æ„"><a class="anchor" href="#æ³¨æ„">#</a> æ³¨æ„</h2><p>æœ¬æ–‡ä¸»è¦è¿˜æ˜¯å‘å‘ç‰¢éªšï¼Œä¸€é€šæš´å­¦ç»ˆäºæ„Ÿè§‰æŒæ¡äº†é­”æ³•çš„é…ç½®åŸç†ï¼Œè®°å½•ä¸€äº›ä¸æ‰è½ä¸‹çš„ç‚¹ï¼Œå¯èƒ½ä¸é€‚åˆä½œä¸ºå‚è€ƒã€‚</p><h2 id="å‚è€ƒ"><a class="anchor" href="#å‚è€ƒ">#</a> å‚è€ƒ</h2><ol><li><p><a href="https://itlanyan.com/vless-fallback-object/#bnp_i_3">VLESS åè®®çš„ fallback å‚æ•°ä»‹ç»</a></p></li><li><p><a href="https://v2xtls.org/v2ray%E4%BD%BF%E7%94%A8cloudflare%E4%B8%AD%E8%BD%AC%E6%B5%81%E9%87%8F%EF%BC%8C%E6%8B%AF%E6%95%91%E8%A2%AB%E5%A2%99ip/">ä½¿ç”¨ cloudflare ä¸­è½¬æµé‡ï¼Œæ‹¯æ•‘è¢«å¢™ ip</a></p></li></ol>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E7%94%9F%E5%91%BD%E5%9C%A8%E4%BA%8E%E6%8A%98%E8%85%BE/">ç”Ÿå‘½åœ¨äºæŠ˜è…¾</category>
      
      
      <category domain="https://blog.yukx.io/tags/%E9%AD%94%E6%B3%95%E4%B8%8A%E7%BD%91/">é­”æ³•ä¸Šç½‘</category>
      
      <category domain="https://blog.yukx.io/tags/WS%E3%80%81TLS%E3%80%81CDN/">WSã€TLSã€CDN</category>
      
      
      <comments>https://blog.yukx.io/2022/11/noise-about-magic-surfing/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ç±»å‹ç³»ç»Ÿæ¼«å·¡</title>
      <link>https://blog.yukx.io/2022/10/type-system-explorition/</link>
      <guid>https://blog.yukx.io/2022/10/type-system-explorition/</guid>
      <pubDate>Sat, 08 Oct 2022 21:15:24 GMT</pubDate>
      
        
        
      <description>&lt;div class=&quot;note default no-icon&quot;&gt;
&lt;p&gt;æ°”æ¸©éª¤é™ï¼Œå¤©å†·çš„ä¼¼ä¹è¦æŠŠè„‘å­éƒ½å†»åƒµï¼Œä¸ç¦æ„Ÿå¹å½“åˆä¸ºä»€ä¹ˆé€‰äº†ä¸€ä¸ªç½‘é¢çš„æ¤…å­ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;ç±»å‹ç±»å‹&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#ç±»å‹ç±»å‹&quot;&gt;#&lt;/a&gt; ç±»å‹</description>
        
      
      
      
      <content:encoded><![CDATA[<div class="note default no-icon"><p>æ°”æ¸©éª¤é™ï¼Œå¤©å†·çš„ä¼¼ä¹è¦æŠŠè„‘å­éƒ½å†»åƒµï¼Œä¸ç¦æ„Ÿå¹å½“åˆä¸ºä»€ä¹ˆé€‰äº†ä¸€ä¸ªç½‘é¢çš„æ¤…å­ã€‚</p></div><h2 id="ç±»å‹ç±»å‹"><a class="anchor" href="#ç±»å‹ç±»å‹">#</a> ç±»å‹ï¼Œç±»å‹</h2><p>åœ¨åŠ¨æ€è¯­è¨€ä¸­æ‰‘è…¾ä¹…äº†ï¼Œä½œä¸ºä¸€ä¸ªçŸ­æ—¶è®°å¿†å€¾å‘çš„äººç±»ï¼Œå°±ä¼šä¸ç”±å¾—æ€€å¿µèµ·ç¡®å®šçš„ç±»å‹ç»™äººå¸¦æ¥çš„æ¸©æš–çš„å®‰å¿ƒæ„Ÿï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼ŒåŠ¨æ€çš„ç±»å‹ï¼Œå…¶å¼ºä¹Ÿå¥½å¼±ä¹Ÿå¥½ï¼Œéƒ½å¾ˆéš¾è¯´æ˜¯â€™æœ‰ä¸€ä¸ªç±»å‹â€™â€”â€” æ—¢ä¸èƒ½åœ¨æŒ‰ä¸‹<span class="kbd">.</span> æ—¶æä¾›å¯ç”¨çš„æˆå‘˜ï¼Œä¹Ÿä¸èƒ½åœ¨è¿è¡Œå‰ç¡®å®šè¿™ä¸ªâ€™ä¸œè¥¿â€™åˆ°åº•ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚</p><p>åœ¨é™æ€è¯­è¨€é‡Œæ‰‘è…¾ä¹…äº†ï¼Œå°±æœ‰ç‚¹çƒ¦ï¼Œå±å¤§ç‚¹äº‹ä¹Ÿè¦é‡æ–°å£°æ˜ä¸€ä¸ªç±»å‹ã€‚</p><p>æ™®é€šçš„æ¥è¯´ï¼Œä¹Ÿå¾ˆéš¾è¯´ç°æœ‰ç±»å‹ç³»ç»Ÿçš„æé™æ™®éè¿«åˆ‡çš„éœ€è¦çªç ´ï¼Œå¤§éƒ¨åˆ†çš„éœ€æ±‚éƒ½å¯ä»¥è¢« <code>&lt;T, U, ...&gt;</code>  è¿™æ ·çš„ç±»å‹å‚æ•°è§£å†³ï¼Œç”šè‡³è¯´è¿™äº›å‚æ•°å¯ä»¥æœ‰æä¾›çš„å®å‚è‡ªåŠ¨æ¨å¯¼å‡ºæ¥ä¸éœ€è¦å†æ˜¾å¼å¡«å†™ã€‚<br />ä½†æ˜¯å½“ä½ æœ‰äº†ä¸€äº›ç¨€å¥‡å¤æ€ªçš„æŠ½è±¡ï¼Œä½ æƒ³å†™æœ€å°‘çš„ä»£ç ï¼Œä½ æƒ³æŠŠå†™è¿‡çš„ä¸œè¥¿éšæ„ç»„åˆä¸€ä¸‹å½¢æˆæ–°çš„ä¸œè¥¿ï¼Œä½ å°±ä¼šå‘ç°è¿™ç©æ„æ—¢ä¸ç›´è§‚ä¹Ÿä¸æ–¹ä¾¿ï¼Œå¾ˆå¿«å°±ç›´çº¿æ’ä¸Šäº†è¾¹ç•Œ â€”â€” å½“ç„¶ä½ æ€»æœ‰åŠæ³•ç»•è¿‡å»ï¼Œä½†é‚£å°±æ˜¯å¦å¤–çš„ä¸œè¥¿äº†ã€‚</p><h2 id="å¿«ç»™æˆ‘å˜"><a class="anchor" href="#å¿«ç»™æˆ‘å˜">#</a> å¿«ç»™æˆ‘å˜</h2><p>æœ€è¿‘æ˜¯æœ‰äº›æƒ³æ³•ï¼Œæ¯”å¦‚æŠ½è±¡å‡ºä¸€ä¸ªå…è®¸æ–½åŠ  / æ’¤é”€ä¿®æ”¹çš„æ•°å€¼ç±»å‹ï¼Œ<br />é€šè¿‡ä¾æ¬¡è®¡ç®—ä¿®æ”¹æ¥å¾—å‡ºæœ€ç»ˆçš„å€¼</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifiable</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name"><span class="token keyword">object</span></span> Value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Modifiers<span class="token punctuation">[</span><span class="token punctuation">]</span></span> Modifiers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifier</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Calculate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ä½†åœ¨å¼ºç±»å‹è¯­è¨€é‡Œç›´æ¥å¡ä¸€ä¸ª object è¿›å»æ˜¾ç„¶ä¸æ˜¯ä»€ä¹ˆå¥½æƒ³æ³•ã€‚<br />å¾ˆå®¹æ˜“æƒ³åˆ°çš„ï¼Œç»™ Value åŠ ä¸€ä¸ªç±»å‹</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">T</span> Value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Modifiers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token return-type class-name">T</span> <span class="token function">Calculate</span><span class="token punctuation">(</span><span class="token class-name">T</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ä½†æ˜¯è¿˜ä¸å¤ªå¤Ÿçš„æ„Ÿè§‰ï¼ŒModifier æ˜¾ç„¶æ˜¯é’ˆå¯¹ç‰¹å®š Modifiableï¼Œå³ä¾¿æ˜¯ value çš„ç±»å‹ç›¸åŒï¼Œä¹Ÿæœªå¿…ä¼šæƒ³è¦ <code>ValueA: Modifiable&lt;int&gt;</code>  èƒ½å¤Ÿä½¿ç”¨å¯¹ <code>ValueB: Modifiable&lt;int&gt;</code>  ç¼–å†™çš„ <code>Modifier&lt;int&gt;</code> ã€‚</p><p>åŸºäºæ­¤ï¼Œæˆ‘ç†è§£äº† <code>T: SomeInterface&lt;T&gt;</code>  çš„æ„ä¹‰ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ValueA</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>ValueA<span class="token punctuation">></span></span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">ValueA</span> Value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>ValueA<span class="token punctuation">></span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Modifiers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">AMod</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Modifier<span class="token punctuation">&lt;</span>ValueA<span class="token punctuation">></span></span></span><span class="token punctuation">&#123;</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·ä»ç„¶æ’é™¤ä¸äº†ä¹‹å‰çš„ç”¨æ³•ï¼Œæ‰€ä»¥åœ¨æ¥å£ä¸Šæ·»åŠ å¦‚æ˜¯çº¦æŸ</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">T</span> Value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Modifiers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token return-type class-name">T</span> <span class="token function">Calculate</span><span class="token punctuation">(</span><span class="token class-name">T</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="note default"><p>åæœŸä¿®è®¢ï¼š<br />ç°åœ¨å›è¿‡å¤´æ¥æƒ³æƒ³è¿™ä¸ª Value å…¶å®å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œè€Œè¦æ·»åŠ ä¸€ä¸ªç±»å‹æ³›å‹åˆå¾ˆéº»çƒ¦åœ°éœ€è¦æ¯æ¬¡å¤šæ ‡æ³¨ä¸€ä¸ªç±»å‹ï¼Œè¿˜æ˜¯å¾—é åŸºç¡€è®¾æ–½ã€‚</p></div><p>è‹¥æ˜¯æœ‰å¿ƒç»§ç»­æ·±æŒ–è¿˜å¯ä»¥è¿›ä¸€æ­¥ç»†åŒ–çº¦æŸå†…éƒ¨æ•°æ®çš„ç±»å‹</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>TSelf<span class="token punctuation">,</span> TData<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">where</span> <span class="token class-name">TSelf</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>TSelf<span class="token punctuation">,</span> TData<span class="token punctuation">></span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">TData</span> Value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>TSelf<span class="token punctuation">,</span> TData<span class="token punctuation">></span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Mods<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>TModifiable<span class="token punctuation">,</span> TData<span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">where</span> <span class="token class-name">TModifiable</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Modifiable<span class="token punctuation">&lt;</span>TModifiable<span class="token punctuation">,</span>TData<span class="token punctuation">></span></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token return-type class-name">TData</span> <span class="token function">Calculate</span><span class="token punctuation">(</span><span class="token class-name">TData</span> lastCalculated<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œå¯¹äº Modifier çš„å…·ä½“å®ç°ï¼Œåº”å½“ä» TModifiable ä¸­è·å– TDataï¼Œè€Œç°æœ‰å·¥å…·å·²ç»è¦†ç›–ä¸åˆ°è¿™ç§éœ€æ±‚äº†ï¼Œå†µä¸”åœ¨æœ¬ä¾‹æ¥è®²ï¼Œåˆ†å‡ºè¿™ä¸ª TData çš„æ„ä¹‰ä¸å¤§ã€‚</p><h2 id="å¹»æƒ³æ—¶é—´"><a class="anchor" href="#å¹»æƒ³æ—¶é—´">#</a> å¹»æƒ³æ—¶é—´</h2><p>æ¯”å¦‚è¿™ç§æ··ä¹±çš„å†™æ³•</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">interface</span> <span class="token class-name">Modifier<span class="token punctuation">&lt;</span>TModifiable<span class="token punctuation">&lt;</span>TModifiable<span class="token punctuation">,</span> TData<span class="token punctuation">></span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>ä¼¼ä¹æ˜¯å«é«˜é˜¶ç±»å‹æ¥ç€ï¼Œä¸è¿‡é€šå¸¸ä¸¾å‡ºçš„ä¾‹å­é€šå¸¸å…³å¿ƒ <code>&lt;T&lt;_&gt;&gt;</code>  é«˜é˜¶çš„ç±»å‹æœ¬èº«ï¼Œä¸è¿‡ç†åº”é¡ºå¸¦å¯ä»¥æå–å‡ºå†…å±‚çš„ç±»å‹ã€‚</p><p>ä¹Ÿç½¢ï¼Œæˆ‘è¿™åŠåŠå­å‡½æ•°å¼çˆ±å¥½è€…è¿˜æ˜¯è¦å­¦ä¹ ä¸€ä¸ªã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E4%BF%97%E4%B8%96%E4%BB%A5%E5%A4%96%E7%9A%84%E6%B6%88%E9%81%A3/">ä¿—ä¸–ä»¥å¤–çš„æ¶ˆé£</category>
      
      
      <category domain="https://blog.yukx.io/tags/%E8%A8%80%E5%B0%BD%E4%BA%8E%E8%A1%8C/">è¨€å°½äºè¡Œ</category>
      
      <category domain="https://blog.yukx.io/tags/%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F/">ç±»å‹ç³»ç»Ÿ</category>
      
      
      <comments>https://blog.yukx.io/2022/10/type-system-explorition/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>MiniValine ä½¿ç”¨ Cloudflare Workers åä»£LeanCloud API</title>
      <link>https://blog.yukx.io/2022/07/reverse-proxy-on-cloudflare-workers-access-leancloud-api/</link>
      <guid>https://blog.yukx.io/2022/07/reverse-proxy-on-cloudflare-workers-access-leancloud-api/</guid>
      <pubDate>Wed, 27 Jul 2022 00:02:39 GMT</pubDate>
      
        
        
      <description>&lt;div class=&quot;note info&quot;&gt;
&lt;p&gt;é€šè¿‡ä¸¥è°¨çš„é˜…è¯»å…¬å‘Šï¼Œæ›´æ·±åˆ»çš„ç†è§£äº†ä¸‹å†…å®¹ï¼Œä»…ä»…æ˜¯ä¸æä¾›å…±äº«åŸŸåï¼Œä½ å¯ä»¥é€šè¿‡ç»‘å®šè‡ªå·±çš„åŸŸåæ¥ç»§ç»­ä½¿ç”¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æœ¬æ–‡çš„åŠªåŠ›ä¹Ÿæ²¡æœ‰å…¨éƒ¨ç™½è´¹ï¼Œä½¿ç”¨ Workers å¯ä»¥éšè—è‡ªå·±çš„ Keyï¼Œé˜²æ­¢è¢«å¥‡å¥‡æ€ªæ€ªçš„ä½¿ç”¨ï¼Œç”šè‡³å¯ä»¥</description>
        
      
      
      
      <content:encoded><![CDATA[<div class="note info"><p>é€šè¿‡ä¸¥è°¨çš„é˜…è¯»å…¬å‘Šï¼Œæ›´æ·±åˆ»çš„ç†è§£äº†ä¸‹å†…å®¹ï¼Œä»…ä»…æ˜¯ä¸æä¾›å…±äº«åŸŸåï¼Œä½ å¯ä»¥é€šè¿‡ç»‘å®šè‡ªå·±çš„åŸŸåæ¥ç»§ç»­ä½¿ç”¨æœåŠ¡ã€‚</p><p>ä¸è¿‡æœ¬æ–‡çš„åŠªåŠ›ä¹Ÿæ²¡æœ‰å…¨éƒ¨ç™½è´¹ï¼Œä½¿ç”¨ Workers å¯ä»¥éšè—è‡ªå·±çš„ Keyï¼Œé˜²æ­¢è¢«å¥‡å¥‡æ€ªæ€ªçš„ä½¿ç”¨ï¼Œç”šè‡³å¯ä»¥è‡ªå·±åŠ ç‚¹ä½æ–™ï¼Œå°±è¿™ä¹ˆå®‰æ…°ä¸‹è‡ªå·±å§ã€‚</p></div><p>é¦–å…ˆï¼Œ<a href="https://leancloudblog.com/2022-07-19-international-service-restrictions/">8 æœˆ 1 æ—¥èµ·ï¼Œå›½é™…ç‰ˆå…±äº«åŸŸåä¸å†å‘ä¸­å›½å¤§é™†æä¾›æœåŠ¡</a></p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220727160750.png" alt="å®˜ç½‘å…¬å‘Š" title="å®˜ç½‘å…¬å‘Š" /></p><p>è™½ç„¶é“¾æ¥ 404ï¼Œä½†æ˜¯å…¬å‘Šå¯æ²¡æœ‰ç§»é™¤ã€‚</p><p>ä¸ºäº†ç»§ç»­å¿«ä¹ç™½å«–ï¼ŒæŠ˜è…¾äº†ä¸€æ•´å¤©ï¼Œç»ˆäºæ‰¾åˆ°äº†<a href="https://github.com/MHuiG/MiniValine/tree/5/CF-LC">è§£å†³æ–¹æ¡ˆ</a><span class="spoiler" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">å¹¶è§£å†³äº†è§£å†³æ–¹æ¡ˆé‡Œçš„é—®é¢˜æˆåŠŸä¸Šçº¿</span></p><p>åŸæœ¬çš„ä»£ç å†™çš„ä¸€è¨€éš¾å°½ä¹‹ä½™ï¼Œè·¨åŸŸçš„è®¿é—®ä¸€æ—¦å‡ºé”™å°±æ˜¯ CORS errorï¼Œä¹ŸçœŸæ˜¯å¤©æ‰èˆ¬çš„è®¾è®¡ã€‚åˆ«äººçš„é—®é¢˜åœ¨äºç»™ä¸æ”¯æŒè·¨åŸŸçš„ API åŒ…è£…è·¨åŸŸï¼Œä¹Ÿè®¸æœ¬æ–¹æ¡ˆä¸éœ€è¦å¤„ç†è·¨åŸŸä¹Ÿè¯´ä¸å®šâ€¦</p><p>éœ€è¦æ ¼å¤–æ³¨æ„çš„æ˜¯ä¿®æ”¹è®¿é—®äººæ•°æ˜¯ <code>PUT</code>  è¯·æ±‚ï¼Œå¤åˆ¶ request çš„æ—¶å€™è¦å¯¹ body ç‰¹æ®Šå¤„ç†ã€‚</p><p>åŒæ—¶ç”±äº Cloudflare Workers è‡ªå¸¦åŸŸå <code>*.workers.dev</code>  ä¹Ÿæ˜¯åœ¨æˆ‘æœä¸å¯ç”¨çš„çŠ¶æ€ï¼Œéœ€è¦é…ç½®è‡ªå®šä¹‰åŸŸåã€‚Cloudflare Workers çš„è®¾ç½®ä¸­å·²ç»æä¾›äº†åŠŸèƒ½ã€‚<br />ç»å°è¯•ä¼¼ä¹è¦æ·»åŠ  <code>redirect: &quot;follow&quot;</code>  æ‰èƒ½æ­£å¸¸è®¿é—®ã€‚</p><div class="note info"><p>è‡ªå®šä¹‰åŸŸåéœ€è¦åŸŸåæ‰˜ç®¡äº Cloudflare DNS ä¸‹ï¼Œå¹¶ä¸”ç¡®è®¤ä½ çš„ SSL è®¾ç½®ä¸ä¸º <code>Off</code>  ä»¥æä¾› HTTPS è®¿é—®ï¼Œé¿å… <code>mixed content</code> ã€‚</p></div><p>éšåä¿®æ”¹ <code>serverURLs</code>  ä¸ºä½ çš„ Workersï¼ŒæŒ‰ä½ çš„å¿ƒæƒ…å†³å®šæ˜¯å¦éšè— AppKeyã€‚</p><p><span class="spoiler blur" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">å„ç§é”™è¯¯è½®ç•ªå‡ºç°å·²ç»äººæ™•äº†ï¼Œæ¯æ¬¡æ”¹ä¸€ç‚¹å„¿å†æ’¤é”€éƒ½å›ä¸åˆ°ä¸€ä¸ªåœ°æ–¹</span><br /><span class="spoiler blur" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">æ—¢ç„¶ç°åœ¨èƒ½ç”¨äº†æˆ‘ä¹Ÿæ‡’å¾—å†æ”¹ä»€ä¹ˆäº†ï¼Œæœ‰äººèƒ½æä¾›ä¼˜åŒ–çš„è¯ä¹Ÿæ¬¢è¿ç•™è¨€</span><br /><span class="spoiler blur" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">æœ€å¼€å§‹è¿˜æƒ³åœ¨ MiniValine åŸºç¡€ä¸ŠåŠ ä¸ªåç«¯ï¼Œç»“æœ clone ä¸‹æ¥ä¸€çœ‹</span><br /><span class="spoiler blur" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">ä»£ç åƒä¸ªéº»èŠ±æ‰­åœ¨ä¸€èµ·ï¼Œæ³¨å…¥è°ƒç”¨ä¹±é£ï¼Œå‘Šè¾ï¼Œæˆ‘è·ŸåŠ¨æ€è¯­è¨€æ°´ç«ä¸å®¹</span></p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td data-command=""></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td data-command=""></td><td><pre><span class="token keyword">var</span> <span class="token maybe-class-name">AppId</span> <span class="token operator">=</span> <span class="token string">"--------------"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre><span class="token keyword">var</span> <span class="token maybe-class-name">AppKey</span> <span class="token operator">=</span> <span class="token string">"--------------"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre><span class="token keyword">var</span> <span class="token constant">ORIGINS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre>  <span class="token string-property property">"---------------"</span><span class="token operator">:</span> <span class="token string">"----------------"</span></pre></td></tr><tr><td data-num="6"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td data-command=""></td><td><pre><span class="token keyword">var</span> corsHeaders <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td data-command=""></td><td><pre>  <span class="token string-property property">"Access-Control-Allow-Origin"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td data-command=""></td><td><pre>  <span class="token string-property property">"Access-Control-Allow-Methods"</span><span class="token operator">:</span> <span class="token string">"GET,PUT,DELETE,HEAD,POST,OPTIONS"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td data-command=""></td><td><pre>  <span class="token string-property property">"Access-Control-Max-Age"</span><span class="token operator">:</span> <span class="token string">"86400"</span></pre></td></tr><tr><td data-num="11"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td data-command=""></td><td><pre><span class="token keyword">var</span> src_default <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td data-command=""></td><td><pre>  <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td data-command="è‡ªå®šä¹‰åŸŸå"></td><td><pre>    <span class="token keyword">let</span> rq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">"follow"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">return</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>rq<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td data-command=""></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td data-command=""></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td data-command=""></td><td><pre>  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token property-access">method</span> <span class="token operator">===</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">return</span> <span class="token function">handleOptions</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td data-command=""></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td data-command=""></td><td><pre>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td data-command=""></td><td><pre>  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'Origin'</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token constant">ORIGINS</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td data-command=""></td><td><pre>    <span class="token comment">// const target = ORIGINS[url.hostname];</span></pre></td></tr><tr><td data-num="25"></td><td data-command=""></td><td><pre>    url<span class="token punctuation">.</span><span class="token property-access">hostname</span> <span class="token operator">=</span> <span class="token string">"---------------"</span><span class="token operator">:</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td data-command=""></td><td><pre>    <span class="token keyword">let</span> reqHEDNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>reqHEDNew<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"X-LC-Id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td data-command=""></td><td><pre>      reqHEDNew<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">"X-LC-Id"</span><span class="token punctuation">,</span> <span class="token maybe-class-name">AppId</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td data-command=""></td><td><pre>      reqHEDNew<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">"X-LC-Key"</span><span class="token punctuation">,</span> <span class="token maybe-class-name">AppKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>reqHEDNew<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"x-lc-sign"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td data-command=""></td><td><pre>      reqHEDNew<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"x-lc-sign"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td data-command=""></td><td><pre>    <span class="token keyword">let</span> reqNew<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td data-command="PUTè¯·æ±‚"></td><td><pre>    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token property-access">method</span> <span class="token operator">===</span> <span class="token string">"PUT"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td data-command=""></td><td><pre>      reqNew <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"PUT"</span><span class="token punctuation">,</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> reqHEDNew<span class="token punctuation">,</span> <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token keyword control-flow">await</span> request<span class="token punctuation">.</span><span class="token method function property-access">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">else</span></pre></td></tr><tr><td data-num="38"></td><td data-command=""></td><td><pre>      reqNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> reqHEDNew <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td data-command=""></td><td><pre>    <span class="token keyword">let</span> responsefetch <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reqNew<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td data-command=""></td><td><pre>    <span class="token keyword">let</span> resHEDNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>responsefetch<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td data-command=""></td><td><pre>    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>responsefetch<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">headers</span><span class="token operator">:</span> resHEDNew <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td data-command=""></td><td><pre>    response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td data-command=""></td><td><pre>    response<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Methods"</span><span class="token punctuation">,</span> <span class="token string">"GET, POST, PUT, DELETE, OPTIONS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">return</span> response<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td data-command=""></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td data-command=""></td><td><pre>  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"nothing here"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td data-command=""></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleOptions</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td data-command=""></td><td><pre>  <span class="token keyword">let</span> headers <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td data-command=""></td><td><pre>  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"Origin"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&amp;&amp;</span> headers<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Request-Method"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&amp;&amp;</span> headers<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Request-Headers"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td data-command=""></td><td><pre>    <span class="token keyword">let</span> respHeaders <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td data-command=""></td><td><pre>      <span class="token spread operator">...</span>corsHeaders<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td data-command=""></td><td><pre>      <span class="token string-property property">"Access-Control-Allow-Headers"</span><span class="token operator">:</span> request<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Request-Headers"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td data-command=""></td><td><pre>      <span class="token literal-property property">headers</span><span class="token operator">:</span> respHeaders</pre></td></tr><tr><td data-num="58"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td data-command=""></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td data-command=""></td><td><pre>    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td data-command=""></td><td><pre>      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td data-command=""></td><td><pre>        <span class="token literal-property property">Allow</span><span class="token operator">:</span> <span class="token string">"GET, HEAD, PUT,DELETE, POST, OPTIONS"</span></pre></td></tr><tr><td data-num="63"></td><td data-command=""></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td data-command=""></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td data-command=""></td><td><pre><span class="token keyword module">export</span> <span class="token exports"><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td data-command=""></td><td><pre>  src_default <span class="token keyword module">as</span> <span class="token keyword module">default</span></pre></td></tr><tr><td data-num="69"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td data-command=""></td><td><pre><span class="token comment">//# sourceMappingURL=index.js.map</span></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E7%94%9F%E5%91%BD%E5%9C%A8%E4%BA%8E%E6%8A%98%E8%85%BE/">ç”Ÿå‘½åœ¨äºæŠ˜è…¾</category>
      
      <category domain="https://blog.yukx.io/categories/%E7%94%9F%E5%91%BD%E5%9C%A8%E4%BA%8E%E6%8A%98%E8%85%BE/MyBlog/">MyBlog</category>
      
      
      <category domain="https://blog.yukx.io/tags/MiniValine/">MiniValine</category>
      
      <category domain="https://blog.yukx.io/tags/Cloudflare-Workers/">Cloudflare Workers</category>
      
      <category domain="https://blog.yukx.io/tags/LeanCloud%E5%9B%BD%E9%99%85%E7%89%88/">LeanCloudå›½é™…ç‰ˆ</category>
      
      
      <comments>https://blog.yukx.io/2022/07/reverse-proxy-on-cloudflare-workers-access-leancloud-api/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶ğ’¾)ï¼šECSä¸­çš„Buffç³»ç»Ÿå®ç°æ€è·¯</title>
      <link>https://blog.yukx.io/2022/07/game-dev-journal-i-ideas-of-a-buff-system-in-ECS/</link>
      <guid>https://blog.yukx.io/2022/07/game-dev-journal-i-ideas-of-a-buff-system-in-ECS/</guid>
      <pubDate>Sun, 24 Jul 2022 18:58:52 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;æœ€è¿‘ä¸€ç›´åœ¨ç£• ECSï¼Œå…¶å°†æ•°æ®æ‹†åˆ†ä¸ºç»„ä»¶çš„æƒ³æ³•æ·±å¾—æˆ‘å¿ƒï¼Œæ¯•ç«Ÿæœ‰äº›ä¸œè¥¿ä½ æ€»æ˜¯è¦åšäº†æ‰çŸ¥é“åˆä¸åˆé€‚ï¼Œä½†æ˜¯åšå®Œå¥½ä¸å¥½æ”¹ï¼Œå¯å°±ä¸ä¸€å®šäº†ã€‚&lt;br /&gt;
å­¦ä¹ äº†å¾ˆå¤š ECS çš„åˆ©å¼Šï¼Œæ¯•ç«Ÿè½¯ä»¶å¼€å‘æ²¡æœ‰é“¶å¼¹ï¼ŒçœŸå®çš„ä¸–ç•Œå¤„å¤„å……æ»¡äº†å¦¥åã€‚&lt;br /&gt;
è€Œçœ‹åˆ°äº†æœ‰äººè¯´ Buff/Debuff åœ¨</description>
        
      
      
      
      <content:encoded><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨ç£• ECSï¼Œå…¶å°†æ•°æ®æ‹†åˆ†ä¸ºç»„ä»¶çš„æƒ³æ³•æ·±å¾—æˆ‘å¿ƒï¼Œæ¯•ç«Ÿæœ‰äº›ä¸œè¥¿ä½ æ€»æ˜¯è¦åšäº†æ‰çŸ¥é“åˆä¸åˆé€‚ï¼Œä½†æ˜¯åšå®Œå¥½ä¸å¥½æ”¹ï¼Œå¯å°±ä¸ä¸€å®šäº†ã€‚<br />å­¦ä¹ äº†å¾ˆå¤š ECS çš„åˆ©å¼Šï¼Œæ¯•ç«Ÿè½¯ä»¶å¼€å‘æ²¡æœ‰é“¶å¼¹ï¼ŒçœŸå®çš„ä¸–ç•Œå¤„å¤„å……æ»¡äº†å¦¥åã€‚<br />è€Œçœ‹åˆ°äº†æœ‰äººè¯´ Buff/Debuff åœ¨ ECS ä¸­å¾ˆéš¾é«˜æ•ˆå®ç°ï¼Œé‚£ä»Šæ—¶ä¸åŒå¾€æ—¥ï¼Œæˆ‘è‡ªç„¶æ˜¯è¦è¯•è¯•ï¼Œå·²ç»æ¶Œç°äº†ä¸å°‘æƒ³æ³•ï¼Œå¿…å¯æ´»ç”¨äºä¸‹ä¸€æ¬¡ã€‚</p><h2 id="æœŸæœ›"><a class="anchor" href="#æœŸæœ›">#</a> æœŸæœ›</h2><p>ä¸€ä¸ª Buff/Debuffï¼Œæœ€ä¸ºæ™®éçš„æ•ˆæœä¾¿æ˜¯å¯¹æ•°å€¼çš„å¢å‡ï¼Œå¯¹ä¸€ä¸ªæˆ–æ•°ä¸ªæ•°å€¼ï¼Œä¸€ä¸ªæˆ–æ•°ä¸ª Buff äº§ç”Ÿæ•ˆæœï¼Œä½œç”¨åˆ°ä¸€ä¸ªæˆ–æ•°ä¸ªç›®æ ‡ã€‚æˆ‘ä»¬è‡ªç„¶æ˜¯å¸Œæœ›è¿™ä¸ªç³»ç»Ÿå¯ä»¥æ¯”è¾ƒå¥½çš„æè¿°è¿™äº›è¡Œä¸ºã€‚</p><h2 id="æ€è·¯"><a class="anchor" href="#æ€è·¯">#</a> æ€è·¯</h2><p>æˆ‘ä»¬å°†ä¸€ä¸ª Buff è§†ä¸ºä¸€ä¸ª Entityï¼ŒBuff çš„æ•ˆæœæš‚ä¸”ä»…å…³æ³¨å„ç§æ•°å€¼çš„ <code>Modifier</code> ï¼Œå› ä¸ºå¾ˆæ˜¾ç„¶ä¸ä½œæ•°å€¼å½±å“çš„å„ç±» Buff æ˜¯å¿…å®šè¦è¿›è¡Œå®ç°çš„ï¼Œä¸èƒ½ç®€å•çš„å¤ç”¨ã€‚</p><p>è¿™æ ·ä¸€ä¸ª Buff ä¸è¢«ä½œç”¨è€…çš„å…³ç³»æˆ‘ä»¬å¯ä»¥è¿™æ ·æè¿°ã€‚</p><figure class="highlight mermaid"><figcaption data-lang="mermaid"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">flowchart</span> TB</pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">subgraph</span> BuffEntity<span class="token text string">["Buff (Entity)"]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    b1<span class="token text string">["Buff (component)"]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    b2<span class="token text string">["xxx Effect"]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">subgraph</span> AffectedEntity<span class="token text string">["Affected Entity"]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    a1<span class="token text string">["xxx Modifiable"]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    a2<span class="token text string">["xxx Modification"]</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    a1 <span class="token arrow operator">--></span> a2</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">end</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    a2 <span class="token arrow operator">--></span> b2</pre></td></tr><tr><td data-num="14"></td><td><pre>    a2 <span class="token arrow operator">-.-></span> BuffEntity</pre></td></tr></table></figure><div class="note info"><p>æ­¤å¤„ä»…è¡¨ç¤ºé€»è¾‘ä¸Šçš„å…³ç³»ã€‚</p></div><p>é€šè¿‡å®ä½“ä¸Šçš„ <code>Buff</code>  ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤æ¥è¿½è¸ª Buff çš„ä½œç”¨æ—¶é—´ï¼ŒECS èŒƒå¼ä¸‹æ™®éæ”¯æŒç»„ä»¶çš„ç§»é™¤æ£€æµ‹ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ Buff ç»“æŸåä»…å°†ç»„ä»¶ç§»é™¤ï¼Œè€Œåœ¨ Buff çš„å®é™…å®ç°ä¸­ç›‘æµ‹ç»„ä»¶ç§»é™¤ï¼Œå°±å¯ä»¥æ­£ç¡®çš„ç§»é™¤ Buff ç”Ÿæ•ˆæ—¶æ·»åŠ çš„æ•ˆæœã€‚</p><p><code>xxx Effect</code>  å³ä¸ºæˆ‘ä»¬å®ç°çš„ Buff çš„æ ‡è®°åœ¨ç³»ç»Ÿä¸­æŸ¥è¯¢åŒºåˆ†ã€‚</p><p><code>xxx Modifiable</code>  æ˜¯æˆ‘ä»¬è·å–æ•°å€¼æ—¶æŸ¥è¯¢çš„ç»„ä»¶ã€‚è€Œ <code>xxx Modification</code>  ç”¨äºå­˜å‚¨æ‰€æœ‰å½±å“è¯¥ç»„ä»¶çš„ Buffï¼ˆ <code>Modifier</code> sï¼Œ <code>Buff</code> ï¼‰ã€‚<br />åˆ™å…¶å®æœ¬ç³»ç»Ÿä¸  <code>Modifiable</code> s å‡ ä¹æ˜¯æ— å…³çš„ï¼Œåœ¨å¯¹åº” <code>Modification</code>  ä¸­ <code>Modifier</code>  ä¸ <code>Buff</code>  å®ä½“å¯¹åº”å­˜å‚¨ï¼Œç”¨äº Buff æ•ˆæœçš„è§£é™¤ã€‚åªéœ€è¦æ¯æ¬¡æ›´æ–°ä¸­æŒ‰ç…§<ruby>ä¸€å®šé¡ºåº<rp> (</rp><rt>å¤§ å‘</rt><rp>)</rp></ruby> è®¡ç®— <code>Modifier</code>  æ±‚å€¼æ›´æ–°æ•°å€¼åˆ° <code>Modifiable</code> ã€‚</p><h3 id="å…³äºè®¡ç®—é¡ºåº"><a class="anchor" href="#å…³äºè®¡ç®—é¡ºåº">#</a> å…³äºè®¡ç®—é¡ºåº</h3><p>ç›®å‰ä¹Ÿæœ‰ä¸€ç‚¹æƒ³æ³•ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œé€šè¿‡ä¼˜å…ˆçº§æ’åºç¡®å®šè®¡ç®—é¡ºåºï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒä¼˜å…ˆçº§ä¸èƒ½æœ‰ä¸¤ç§ä¸åŒçš„è®¡ç®—æ–¹æ³•ã€‚</p><h2 id="bonus"><a class="anchor" href="#bonus">#</a> Bonus</h2><p>åœ¨æ­¤é™„ä¸Šå®éªŒç”¨åˆ°çš„ä»£ç ï¼Œä½¿ç”¨äº† Bevy å®ç°ï¼Œä¸è¿‡æ€è·¯åº”è¯¥å¯ä»¥é€šç”¨ã€‚</p><p>:::warn<br /> å£°æ˜ï¼šä»£ç ä»…ä¿è¯äº†æ²¡æœ‰<em>ç¼–è¯‘é”™è¯¯</em><sub> (ç¬‘)</sub>ï¼Œæœªå®é™…è¿è¡Œæ£€éªŒï¼Œä¹Ÿå¹¶ä¸ä¸ä¸Šæ–‡æ‰€è¿°æ€è·¯å®Œå…¨ä¸€è‡´ã€‚<span class="spoiler" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">è¿™ä¸€åˆ‡å®Œå…¨éƒ½æ˜¯åœ¨å®è·µä¸­ä¸€ç‚¹ç‚¹å‘ç°ä¸å¯è¡Œæ€§åä¿®è¡¥çš„ç»“æœçš„è¯´â€¦</span><br />:::</p><figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token attribute attr-name">#[derive(Component)]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Vision</span><span class="token punctuation">(</span><span class="token keyword">f32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token attribute attr-name">#[derive(Component)]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Buff</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    target<span class="token punctuation">:</span> <span class="token class-name">Entity</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    from<span class="token punctuation">:</span> <span class="token class-name">Entity</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    duration<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token attribute attr-name">#[derive(Component)]</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">VisionModification</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    ord1<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">ModifierEffect</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    ord2<span class="token punctuation">:</span> <span class="token namespace">collections<span class="token punctuation">::</span></span><span class="token class-name">BTreeSet</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token class-name">ModifierEffect</span><span class="token punctuation">,</span> <span class="token class-name">Entity</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token attribute attr-name">#[derive(Component)]</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">ModifierEffect</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token class-name">ByValue</span><span class="token punctuation">(</span><span class="token keyword">f32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token class-name">ByPercentage</span><span class="token punctuation">(</span><span class="token keyword">f32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token attribute attr-name">#[derive(Component)]</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">VisionModifierEffect</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">buff_vision_modify_system</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">mut</span> commands<span class="token punctuation">:</span> <span class="token class-name">Commands</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">mut</span> vision_effects<span class="token punctuation">:</span> <span class="token class-name">Query</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Buff</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">ModifierEffect</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">With</span><span class="token operator">&lt;</span><span class="token class-name">VisionModifierEffect</span><span class="token operator">>></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">mut</span> visions<span class="token punctuation">:</span> <span class="token class-name">Query</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">Entity</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">Vision</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">VisionModification</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">mut</span> visions_removed<span class="token punctuation">:</span> <span class="token class-name">RemovedComponents</span><span class="token operator">&lt;</span><span class="token class-name">Buff</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>buff<span class="token punctuation">,</span> vision_effect<span class="token punctuation">)</span> <span class="token keyword">in</span> vision_effects<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">let</span> vision <span class="token operator">=</span> visions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buff<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">match</span> vision_effect <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token class-name">ModifierEffect</span><span class="token punctuation">::</span><span class="token class-name">ByValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                commands</pre></td></tr><tr><td data-num="34"></td><td><pre>                    <span class="token punctuation">.</span><span class="token function">entity</span><span class="token punctuation">(</span>buff<span class="token punctuation">.</span>target<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Vision</span><span class="token punctuation">(</span>vision<span class="token number">.1</span> <span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token class-name">ModifierEffect</span><span class="token punctuation">::</span><span class="token class-name">ByPercentage</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                commands</pre></td></tr><tr><td data-num="39"></td><td><pre>                    <span class="token punctuation">.</span><span class="token function">entity</span><span class="token punctuation">(</span>buff<span class="token punctuation">.</span>target<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                    <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Vision</span><span class="token punctuation">(</span>vision<span class="token number">.1</span> <span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">*</span> factor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">for</span> e <span class="token keyword">in</span> visions_removed<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> effect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> vision_effects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token keyword">let</span> vision <span class="token operator">=</span> visions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>buff<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token keyword">match</span> effect <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token class-name">ModifierEffect</span><span class="token punctuation">::</span><span class="token class-name">ByValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                    commands<span class="token punctuation">.</span><span class="token function">entity</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Vision</span><span class="token punctuation">(</span>vision<span class="token number">.1</span> <span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">-</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token class-name">ModifierEffect</span><span class="token punctuation">::</span><span class="token class-name">ByPercentage</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                    commands<span class="token punctuation">.</span><span class="token function">entity</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Vision</span><span class="token punctuation">(</span>vision<span class="token number">.1</span> <span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">/</span> factor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>            commands<span class="token punctuation">.</span><span class="token function">entity</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">despawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">buff_duration_system</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token keyword">mut</span> commands<span class="token punctuation">:</span> <span class="token class-name">Commands</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token keyword">mut</span> buffs<span class="token punctuation">:</span> <span class="token class-name">Query</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">Entity</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">Buff</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    time<span class="token punctuation">:</span> <span class="token class-name">Res</span><span class="token operator">&lt;</span><span class="token class-name">Time</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token keyword">for</span> mutable <span class="token keyword">in</span> buffs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        mutable<span class="token number">.1</span><span class="token punctuation">.</span>duration <span class="token operator">-=</span> time<span class="token punctuation">.</span><span class="token function">delta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_secs_f32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token keyword">if</span> mutable<span class="token number">.1</span><span class="token punctuation">.</span>duration <span class="token operator">&lt;=</span> <span class="token number">0.0</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            commands<span class="token punctuation">.</span><span class="token function">entity</span><span class="token punctuation">(</span>mutable<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Buff</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="bonus-plus"><a class="anchor" href="#bonus-plus">#</a> Bonus Plus</h2><p>æœ€åˆçš„æ„æƒ³å…¶å®æ˜¯ä½¿ç”¨æ¥å£æŠ½è±¡ï¼Œæ¯ä¸ª Buff éƒ½å®ç°æ­¤æ¥å£ï¼Œä½œä¸ºç»„ä»¶æŒ‚åœ¨è¢«ä½œç”¨å¯¹è±¡çš„å®ä½“ä¸Šï¼Œåœ¨ System ä¸­é€šè¿‡æ¥å£æ¥è·å–æ‰€æœ‰ Buff ç»„ä»¶è¿›è¡Œå¤„ç†ã€‚<br />ä½†è¿™æ ·åšé—®é¢˜å¾ˆå¤šï¼Œ</p><blockquote><p>Unity ECS æ”¯æŒæŸ¥è¯¢æ¥å£ï¼Œä»£ä»·æ˜¯æ— æ³•ä½¿ç”¨é«˜æ€§èƒ½çš„ Burst ç¼–è¯‘å™¨ï¼Œæœ€é‡è¦çš„æ˜¯å¤šä¸ªå½±å“æŸä¸ªæ•°å€¼çš„ Buff æ— æ³•ç»“ç®— â€”â€” å…¶ä»–åŒç±»å‹çš„ç»„ä»¶ä¸å¯è§ï¼›ä¸”æƒ³è¦ç”¨æ³›å‹æ¥å£æ¥ç»Ÿä¸€æ—¶å°±ä¼šå‘ç°ç»„ä»¶å†…ä¸å…è®¸å‡ºç°éå€¼ç±»å‹ï¼Œå³ä½¿æœ€åå®ç°æ¥å£çš„å‡æ˜¯ <code>struct</code> ã€‚</p><p>è€Œåœ¨ Rust ä¸­ç±»ä¼¼çš„æ–¹æ³•æ—¶ä½¿ç”¨ traits ä½œä¸ºç±»å‹å‚æ•°ï¼Œè€Œ trait objects æ— æ³•åœ¨ç¼–è¯‘æ—¶æ—¶ç¡®å®šå¤§å°éœ€è¦è£…ç®±ï¼Œé‚£å°±è¦ç»™ <code>Box&lt;trait&gt;</code>  å®ç° <code>Component</code> ï¼Œä¹Ÿå¤ªæ€ªäº†ã€‚</p></blockquote><p>æœ€åä¸€å®šè¦åæ§½çš„æ˜¯ï¼ŒUnity çš„ ECS æ–‡æ¡£ç›®å‰å†™çš„çœŸæ˜¯å±ä¸€æ ·ï¼Œè¿™æ ·æ˜¯æœ€åå°è¯•éƒ½åœ¨ Bevy ä¸­åšçš„åŸå› ã€‚<br />è™½ç„¶å¯èƒ½æœ‰è¿˜åœ¨ experimental çš„ç¼˜æ•…ï¼Ÿçœ‹äº†ä¸€å¤§å †ä¸æ˜æ‰€ä»¥çš„æ¦‚å¿µï¼Œæœ€åè¯•äº†ä¸€ä¸‹ç¡®è®¤äº† System åˆ›å»ºåç›´æ¥å¯ä»¥ç”Ÿæ•ˆã€‚ä¹Ÿä¸å¾—ä¸è¯´å…¶å®ç°ä¹Ÿç”¨ç€æœ‰ç‚¹åˆ«æ‰­ï¼ˆç›¸å¯¹äº Bevyï¼‰ã€‚å¯èƒ½æ˜¯æˆ‘å…ˆå…¥ä¸ºä¸»å—ï¼Ÿæˆ–è€…è¯´æ˜¯åŸºç¡€è®¾æ–½å¯¹äººæ½œæ„è¯†çš„å¼•å¯¼ï¼Ÿæ€»è§‰å¾—ç°åœ¨ Unity çš„ ECS<sup>0.51</sup> æœ‰ç‚¹ä¸ä¼¦ä¸ç±»ï¼›å†™åˆ°è¿™é‡Œæˆ‘çªç„¶æ„è¯†åˆ°æ²¡çœ‹åˆ°æœ‰åˆ›å»º Entity ç›¸å…³çš„å†…å®¹ï¼Œèµ¶ç´§å»æ‰¾äº†ä¸‹ï¼Œå—¯â€¦<br />â€¦<br /> ç‰Œå­ã€è½¦ã€å²”è·¯.jpg</p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E6%80%9D%E8%B7%AF/">æ€è·¯</category>
      
      
      <category domain="https://blog.yukx.io/tags/ECS/">ECS</category>
      
      <category domain="https://blog.yukx.io/tags/Buff-Debuff-System/">Buff/Debuff System</category>
      
      <category domain="https://blog.yukx.io/tags/Modifiers/">Modifiers</category>
      
      
      <comments>https://blog.yukx.io/2022/07/game-dev-journal-i-ideas-of-a-buff-system-in-ECS/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶Ï€)ï¼šRustã€Bevy &amp; ECS</title>
      <link>https://blog.yukx.io/2022/07/game-dev-journal-pi-Rust-Bevy-and-ECS/</link>
      <guid>https://blog.yukx.io/2022/07/game-dev-journal-pi-Rust-Bevy-and-ECS/</guid>
      <pubDate>Fri, 22 Jul 2022 06:18:09 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;æœ¬æ¥å˜›ï¼Œæƒ³ç€é‡æ„è¦è¶æ—©ï¼Œç°åœ¨ä¹Ÿé˜¶æ®µæ€§å®Œæˆä¸€éƒ¨åˆ†å†…å®¹ï¼Œè¯•ç€æŠŠé¡¹ç›®ç”¨ Rust é‡å†™ï¼Œåˆšå¥½æœ€è¿‘äº†è§£äº† &lt;a href=&quot;https://bevyengine.org/&quot;&gt;Bevy&lt;/a&gt; è¿™ä¸ª Rust å†™çš„ä½¿ç”¨ ECS èŒƒå¼çš„æ¸¸æˆå¼•æ“ï¼Œä¸€ä¸¾å¤šå¾—å²‚ä¸ç¾å“‰ï¼Ÿ&lt;/p&gt;
&lt;h2 id</description>
        
      
      
      
      <content:encoded><![CDATA[<p>æœ¬æ¥å˜›ï¼Œæƒ³ç€é‡æ„è¦è¶æ—©ï¼Œç°åœ¨ä¹Ÿé˜¶æ®µæ€§å®Œæˆä¸€éƒ¨åˆ†å†…å®¹ï¼Œè¯•ç€æŠŠé¡¹ç›®ç”¨ Rust é‡å†™ï¼Œåˆšå¥½æœ€è¿‘äº†è§£äº† <a href="https://bevyengine.org/">Bevy</a> è¿™ä¸ª Rust å†™çš„ä½¿ç”¨ ECS èŒƒå¼çš„æ¸¸æˆå¼•æ“ï¼Œä¸€ä¸¾å¤šå¾—å²‚ä¸ç¾å“‰ï¼Ÿ</p><h2 id="åˆè§"><a class="anchor" href="#åˆè§">#</a> åˆè§</h2><p>çœ‹çœ‹è¿™ç›®å½•ç»“æ„ï¼Œå¥½ä¸æ•´é½<br /><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220722222441.png" alt="directory" title="çœŸå¥½å•Š" /></p><p>æ•°æ®ä½¿ç”¨ç»„ä»¶å®Œå…¨æ‰“æ•£ï¼Œåœ¨ç³»ç»Ÿä¸­é€šè¿‡æŸ¥è¯¢æ¥è·å–ç»„ä»¶æˆ–å®ä½“ï¼Œå¯ä»¥è¯´æ˜¯å½»åº•è§£å†³äº†æˆ‘ä¸çŸ¥é“è¦æ€ä¹ˆç»„ç»‡ä»£ç æ‰ç®—å¥½çš„é—®é¢˜ï¼ŒåŠŸèƒ½ä¹Ÿéƒ½å®Œå…¨éš”ç¦»å¼€ï¼Œå¯ä»¥è¯´æ˜¯æ²¡æœ‰è€¦åˆçš„æœºä¼šäº†ã€‚</p><p>æœ€å…ˆå®ç°çš„åˆ™æ˜¯åœ°å›¾ç½‘æ ¼ç”Ÿæˆï¼Œæ„Ÿè§‰ä¸Šæ—¢ä¸ç®—æ˜¯è¿‡äºå¤æ‚ï¼Œåˆè¶³å¤Ÿå¯ä»¥è¸©å‘äº†ã€‚</p><h2 id="è¯•æ¢"><a class="anchor" href="#è¯•æ¢">#</a> è¯•æ¢</h2><p>äºæ˜¯æœä¸å…¶ç„¶ï¼Œå½“å‰ç‰ˆæœ¬çš„ Bevy <sup>0.7.0</sup> å¹¶æ²¡æœ‰ç‰©ç†ç³»ç»Ÿï¼Œäºæ˜¯é€’å½’æŸ¥æ‰¾ç‰©ç†å¼•æ“çš„æ’ä»¶ã€‚<br />å€’è¿˜çœŸæœ‰ <a href="https://rapier.rs/docs/">Rapier</a> è¿™ä¸ª Rust å†™çš„ç‰©ç†å¼•æ“ï¼Œä»–ä»¬ç»™ Bevy å†™äº†ä¸€ä¸ªç‰©ç†å¼•æ“æ’ä»¶æä¾›äº†ç‰©ç†ç³»ç»Ÿã€‚<br />ä½†æˆ‘ä»¬çš„ä¸»è§’å´å¹¶éå…¶äººï¼Œè€Œä¹Ÿæ­£æ˜¯è¿™ä¸ªæ’ä»¶ï¼Œä½¿æˆ‘çš„å¿ƒæ€å‘ç”Ÿäº†ä¸€ç‚¹å˜åŒ–ã€‚</p><p><a href="https://github.com/jcornaz/heron">Heron</a>ï¼ŒåŸºäº Rapier æä¾›äº†ä¸€å¥— APIï¼Œçœ‹ä¸Šå»ä¹ŸæŒºå¯¹å‘³<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>ï¼Œä½¿æˆ‘é€‰æ‹©äº†å®ƒã€‚</p><p>ç”±äºæ²¡æœ‰è¯¸å¦‚ <code>OverlapBox</code>  ä¹‹ç±»çš„åŠ©æ‰‹å‡½æ•°ï¼Œæˆ‘åªå¥½æŒ‰å—åœ¨åœ°å›¾ä¸Šç”Ÿæˆ<ruby>ç¢°æ’æ£€æµ‹ä½“<rp> (</rp><rt>Sensor</rt><rp>)</rp></ruby>ï¼Œåœ¨ä¸‹ä¸€å¸§ä¸­æŸ¥è¯¢ç‰©ä½“æ˜¯å¦å‘ç”Ÿé‡å ã€‚</p><figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>grid<span class="token punctuation">.</span>width <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>grid<span class="token punctuation">.</span>height <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        world</pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">insert_bundle</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">TransformBundle</span><span class="token operator">></span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token class-name">Transform</span><span class="token punctuation">::</span><span class="token function">from_translation</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                    grid<span class="token punctuation">.</span><span class="token function">get_world_coordinate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token punctuation">.</span><span class="token function">with_scale</span><span class="token punctuation">(</span><span class="token class-name">MapGrid</span><span class="token punctuation">::</span><span class="token function">vec_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">RigidBody</span><span class="token punctuation">::</span><span class="token class-name">Sensor</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">CollisionShape</span><span class="token punctuation">::</span><span class="token class-name">Cuboid</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                half_extends<span class="token punctuation">:</span> <span class="token class-name">MapGrid</span><span class="token punctuation">::</span><span class="token function">vec_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                border_radius<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Collisions</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Tile</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                grid<span class="token punctuation">:</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>world<span class="token punctuation">.</span><span class="token function">insert_resource</span><span class="token punctuation">(</span><span class="token class-name">Tiled</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><div class="note info"><p>è¿™é‡Œå±•ç¤ºäº†åˆ›å»ºå®ä½“çš„æ–¹æ³•ï¼Œåœ¨æœ€åç”Ÿæˆå®Œç –å—ååœ¨ä¸–ç•Œé‡Œæ·»åŠ  <code>Tiled</code>  èµ„æºï¼Œä»¥åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶ä½œä¸ºåˆ¤æ–­ä¾æ®ã€‚</p></div><p>æŸ¥è¯¢ Tile (å­˜å‚¨ç€ç –å—çš„ç´¢å¼•)ï¼Œå’Œ Collisionï¼ˆå­˜å‚¨ç€ç¢°æ’çš„ä¿¡æ¯ï¼‰ï¼Œç”Ÿæˆç½‘æ ¼æ•°æ®ï¼Œ<br />æŠŠ Entity å­˜èµ·æ¥åé¢æ¸…ç†ç”¨ã€‚<br />è¿™æ ·ç½‘æ ¼æ•°æ®ä½œä¸ºæ¸¸æˆå†…æœ‰å”¯ä¸€æ€§çš„æ•°æ®å°±ä½œä¸º Resource å­˜å‚¨å¥½äº†ï¼Œéšååˆ‡æ¢<ruby>çŠ¶æ€<rp> (</rp><rt>State</rt><rp>)</rp></ruby> è¡¨ç¤ºæ¸¸æˆå¯ä»¥å¼€å§‹äº†<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>ã€‚</p><figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td data-command=""></td><td><pre><span class="token keyword">let</span> <span class="token keyword">mut</span> map_grid <span class="token operator">=</span> <span class="token class-name">MapGrid</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td data-command=""></td><td><pre>    width<span class="token punctuation">:</span> map<span class="token punctuation">.</span>size<span class="token punctuation">.</span>x <span class="token keyword">as</span> <span class="token keyword">i32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre>    height<span class="token punctuation">:</span> map<span class="token punctuation">.</span>size<span class="token punctuation">.</span>y <span class="token keyword">as</span> <span class="token keyword">i32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre>    status<span class="token punctuation">:</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token class-name">MapStatus</span><span class="token punctuation">::</span><span class="token class-name">Empty</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span>size<span class="token punctuation">.</span>x <span class="token operator">*</span> map<span class="token punctuation">.</span>size<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td data-command=""></td><td><pre><span class="token comment">// map is tiled, check tiles</span></pre></td></tr><tr><td data-num="7"></td><td data-command=""></td><td><pre><span class="token keyword">let</span> <span class="token keyword">mut</span> query <span class="token operator">=</span> world<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">Entity</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">Tile</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">Collisions</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre><span class="token keyword">let</span> <span class="token keyword">mut</span> tile_entities <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> tiles <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>world<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token class-name">Tile</span> <span class="token punctuation">&#123;</span> grid<span class="token punctuation">:</span> pos <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> collision<span class="token punctuation">)</span> <span class="token keyword">in</span> tiles<span class="token punctuation">.</span><span class="token function">by_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>        map_grid<span class="token punctuation">[</span><span class="token punctuation">[</span>pos<span class="token punctuation">.</span>x <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">if</span> collision<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>            <span class="token class-name">MapStatus</span><span class="token punctuation">::</span><span class="token class-name">Empty</span></pre></td></tr><tr><td data-num="14"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>            <span class="token class-name">MapStatus</span><span class="token punctuation">::</span><span class="token class-name">Obstacle</span></pre></td></tr><tr><td data-num="16"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>        tile_entities<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td data-command="æˆ‘ä¸ç¼–è¯‘å™¨ææ–—çš„è¯æ˜"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td data-command=""></td><td><pre><span class="token keyword">for</span> t <span class="token keyword">in</span> tile_entities <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td data-command=""></td><td><pre>    world<span class="token punctuation">.</span><span class="token function">despawn</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td data-command=""></td><td><pre>world<span class="token punctuation">.</span><span class="token function">remove_resource</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Tiled</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td data-command=""></td><td><pre>world<span class="token punctuation">.</span><span class="token function">insert_resource</span><span class="token punctuation">(</span>map_grid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td data-command=""></td><td><pre>world</pre></td></tr><tr><td data-num="28"></td><td data-command=""></td><td><pre>    <span class="token punctuation">.</span><span class="token function">get_resource_mut</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&lt;</span><span class="token class-name">GameState</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td data-command=""></td><td><pre>    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td data-command=""></td><td><pre>    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">Game</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td data-command=""></td><td><pre>    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><div class="note info"><p>ä¸­é—´çªå…€çš„å¤§æ‹¬å·æ–¹æ³•å—æ˜¯ä¸ºäº†è®©å…¶ä¸­çš„ world ä¸å¯å˜å¼•ç”¨æ—©æ—¥å¦‚åœŸä¸ºå®‰ï¼Œä¸è¦å¦¨ç¢åé¢çš„å¯å˜å¼•ç”¨è°ƒç”¨ã€‚<br />è¿™é‡Œå±•ç¤ºäº†æŸ¥è¯¢ç»„ä»¶å’Œå®ä½“ï¼Œè¿›è¡Œæ“ä½œçš„æ–¹æ³•</p></div><h2 id="é€’è¿›"><a class="anchor" href="#é€’è¿›">#</a> é€’è¿›</h2><p>è¿™é‡Œå¯ä»¥é€éœ²ä¸€ä¸‹åœ°å›¾æ–‡ä»¶çš„è®¾è®¡ï¼Œä½¿ç”¨ json å­˜å‚¨ï¼Œåœ°å›¾ä¸Šçš„å¯¹è±¡è®¾è®¡æˆå†…ç½®ã€å¤–ç½®ç´ æï¼Œæ–¹ä¾¿è¿›ä¸€æ­¥è‡ªå®šä¹‰ã€‚</p><p>è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ Rust å¯ä»¥å°†  <code>Result&lt;T, E&gt;</code>  çš„è¿­ä»£å™¨ï¼ˆä¸åšå¤„ç†çš„æœ€ç»ˆç»“æœå°†æ˜¯ <code>Vec&lt;Result&lt;T, E&gt;&gt;</code> ï¼‰æ”¶é›†ä¸º <code>Result&lt;Vec&lt;T&gt;, E&gt;</code> ï¼Œè¿™æ ·æå¤§æ–¹ä¾¿äº†å¯¹æ•°ç»„æ˜ å°„æ—¶çš„é”™è¯¯å¤„ç†ï¼ŒçœŸæ˜¯ç™¾é—»ä¸å¦‚ä¸€è§ï¼Œä»¤äººè€³ç›®ä¸€æ–°ã€‚<br />è¿™æ ·æˆ‘å°±å¯ä»¥æ”¾å¿ƒçš„è¿”å›ä¸€ä¸ª <code>Err</code> ï¼Œè€Œå®ƒæœ€ç»ˆä¹Ÿä¼šå†’æ³¡åˆ°é—­åŒ…å¤–éƒ¨æˆä¸ºè¿”å›å€¼ã€‚</p><figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// pub fn load_map(path: &amp;str) -> Result&lt;Map, Box&lt;dyn Error>></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> objects <span class="token operator">=</span> map<span class="token punctuation">[</span><span class="token string">"objects"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>obj<span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">match</span> obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">map_object_meta<span class="token punctuation">::</span></span><span class="token class-name">SpawnPoint</span><span class="token punctuation">::</span><span class="token constant">TYPENAME</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">let</span> position<span class="token punctuation">:</span> <span class="token class-name">Vec2</span> <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"position"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_f32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"position"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_f32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">let</span> player <span class="token operator">=</span> obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"player"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_i32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">MapObject</span><span class="token punctuation">::</span><span class="token class-name">SpawnPoint</span><span class="token punctuation">(</span><span class="token namespace">map_object_meta<span class="token punctuation">::</span></span><span class="token class-name">SpawnPoint</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                position<span class="token punctuation">,</span> player<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">map_object_meta<span class="token punctuation">::</span></span><span class="token class-name">Struct</span><span class="token punctuation">::</span><span class="token constant">TYPENAME</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">let</span> position<span class="token punctuation">:</span> <span class="token class-name">Vec2</span> <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"position"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_f32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"position"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_f32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">let</span> player <span class="token operator">=</span> obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"player"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_i32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">let</span> group <span class="token operator">=</span> obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"group"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_i32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token keyword">let</span> source <span class="token operator">=</span> obj<span class="token number">.1</span><span class="token punctuation">[</span><span class="token string">"source"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"map parsing err"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">MapObject</span><span class="token punctuation">::</span><span class="token class-name">Struct</span><span class="token punctuation">(</span><span class="token namespace">map_object_meta<span class="token punctuation">::</span></span><span class="token class-name">Struct</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                position<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                player<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                group<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                source<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        _ <span class="token operator">=></span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">"unknown map object type"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// Iter&lt;Result&lt;MapObject, &amp;str>></span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">></span><span class="token punctuation">,</span> _<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>åˆ°è¿™ä¸ºæ­¢éƒ½è¿˜æ˜¾å¾—ååˆ†å®é™ç¥¥å’Œã€‚</p><h2 id="ç»ˆç« "><a class="anchor" href="#ç»ˆç« ">#</a> ğ†‘ğ†‘ğ†‘ ç»ˆç« </h2><p>é‚£ä¹ˆå¾ˆè‡ªç„¶çš„ï¼Œæˆ‘è¦ç”Ÿæˆåœ°å›¾äº†ï¼Œæˆ‘è¦ç”Ÿæˆåœ°å›¾è¾¹ç•Œäº†ï¼Œæˆ‘å‘ç°æ²¡æœ‰è¿™æ ·ä¸€ä¸ªç¢°æ’ä½“ã€‚</p><p>Heron å£°æ˜æä¾›åº•å±‚ Rapier çš„åŠŸèƒ½ï¼Œæˆ‘æ‰¾åˆ°è¿™æ ·çš„ç¢°æ’ä½“äº†ï¼Œæˆ‘æ‰¾åˆ°æ‰€åœ¨çš„æ¨¡å—äº†ï¼Œæˆ‘å‘ç°è¿™ä¸ª <code>struct</code>  æ²¡æœ‰ <code>#[derive(Component)]</code> ã€‚</p><p>â„±ğ’¾ğ“ƒ.</p><hr /><p>ä¸è¿‡æ­¤å¤„æŠ˜è…¾ä¹Ÿä¸èƒ½è¯´æ˜¯ä¸€æ— æ‰€è·ï¼Œæœ¬æ–‡ä¹Ÿæ²¡æœ‰ä»»ä½•æŠ±æ€¨çš„æ„æ€ï¼ŒRustã€Bevy å¯ä»¥è¯´æœªæ¥å¯æœŸäº†ã€‚ä¸è¿‡ä¸€æ— æ‰€æœ‰çš„æˆ‘è¿˜æ˜¯è¦ä»¥å®Œæˆé¡¹ç›®ä¸ºä¼˜å…ˆäº‹é¡¹ï¼Œæš‚åˆ«ã€‚</p><hr class="footnotes-sep" /><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>ç›¸æ¯” Rapierï¼Œä½¿ç”¨å†…ç½®çš„ Vector ç±»å‹ï¼ŒAPI ä¹Ÿæ›´åŠ ç®€å• <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li><li id="fn2" class="footnote-item"><p>å…¶å®ä¸åº”è¯¥å†™åœ¨è¿™é‡Œï¼Œè€Œåº”è¯¥å•ç‹¬å†™ä¸€ä¸ªç³»ç»Ÿç”¨äºæ£€æŸ¥èµ„æºæ˜¯å¦å‡†å¤‡å®Œæˆåˆ‡æ¢çŠ¶æ€ï¼Œä¸è¿‡ç°åœ¨å§‘ä¸”è¿˜ç®—ç®€å•å°±å…ˆè¿™ä¹ˆå†™äº†ã€‚ <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Bevy/">Bevy</category>
      
      <category domain="https://blog.yukx.io/tags/Rust/">Rust</category>
      
      <category domain="https://blog.yukx.io/tags/ECS/">ECS</category>
      
      
      <comments>https://blog.yukx.io/2022/07/game-dev-journal-pi-Rust-Bevy-and-ECS/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶å››Â·ä¸€)ï¼šè¿·é›¾å¤§å°ä¸ç‰©ä½“å®é™…å¤§å°ä¸ä¸€è‡´çš„åŸå› </title>
      <link>https://blog.yukx.io/2022/07/game-dev-journal-4-1-mismatching-fog-size-with-obstacle-size/</link>
      <guid>https://blog.yukx.io/2022/07/game-dev-journal-4-1-mismatching-fog-size-with-obstacle-size/</guid>
      <pubDate>Mon, 18 Jul 2022 05:28:50 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡çš„æœ€åï¼Œå¯ä»¥çœ‹åˆ°å°å°ºå¯¸çš„éšœç¢ç‰©æœ‰ç€ä¸ä¹‹ä¸åŒ¹é…çš„å·¨å¤§é®æŒ¡é¢ç§¯ã€‚&lt;/p&gt;
&lt;p&gt;â€”â€” è¿™é‡Œä¸å¾—ä¸è¡¥å……ä¸‹ï¼šå°šæœªä¹¦é¢è®°å½•çš„ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨äº† ã€Œåœ°å›¾ã€ è¿™ä¸€æ¦‚å¿µï¼Œç›®å‰çš„è¿è¡Œåœºæ™¯ä¸­åŒ…å«ç¼–è¾‘å™¨ä¸­æ·»åŠ çš„ç‰©ä½“å’Œè¯»å–åœ°å›¾æ–‡ä»¶åè¿è¡Œæ—¶æ·»åŠ çš„ç‰©ä½“ã€‚åœ¨åœ°å›¾ç”Ÿæˆå®Œæˆåè°ƒç”¨åˆå§‹åŒ–ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;</description>
        
      
      
      
      <content:encoded><![CDATA[<p>åœ¨ä¸Šä¸€ç¯‡çš„æœ€åï¼Œå¯ä»¥çœ‹åˆ°å°å°ºå¯¸çš„éšœç¢ç‰©æœ‰ç€ä¸ä¹‹ä¸åŒ¹é…çš„å·¨å¤§é®æŒ¡é¢ç§¯ã€‚</p><p>â€”â€” è¿™é‡Œä¸å¾—ä¸è¡¥å……ä¸‹ï¼šå°šæœªä¹¦é¢è®°å½•çš„ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨äº† ã€Œåœ°å›¾ã€ è¿™ä¸€æ¦‚å¿µï¼Œç›®å‰çš„è¿è¡Œåœºæ™¯ä¸­åŒ…å«ç¼–è¾‘å™¨ä¸­æ·»åŠ çš„ç‰©ä½“å’Œè¯»å–åœ°å›¾æ–‡ä»¶åè¿è¡Œæ—¶æ·»åŠ çš„ç‰©ä½“ã€‚åœ¨åœ°å›¾ç”Ÿæˆå®Œæˆåè°ƒç”¨åˆå§‹åŒ–ç½‘æ ¼ã€‚</p><p>æ‰€ä»¥åˆç†æ€€ç–‘åˆ°äº†åœ°å›¾ç”Ÿæˆé˜¶æ®µã€‚</p><p><a href="#%E7%AD%94%E6%A1%88%E5%91%BC%E4%B9%8B%E6%AC%B2%E5%87%BA">å¤ªé•¿ä¸çœ‹</a></p><h3 id="gizmos"><a class="anchor" href="#gizmos">#</a> Gizmos</h3><p>ä¸ºäº† Debugï¼Œå­¦ä¹ äº†ä¸‹åŸé¡¹ç›®ä¸­ç»˜åˆ¶åœ°å›¾ç½‘æ ¼çš„æ“ä½œï¼Œåœ¨ Hierarchy ä¸­é€‰ä¸­å¯¹è±¡ï¼Œå¯ä»¥å°†ç”Ÿæˆçš„ç½‘æ ¼æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDrawGizmosSelected</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>mapGrid <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        Gizmos<span class="token punctuation">.</span>color <span class="token operator">=</span> Color<span class="token punctuation">.</span>blue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        Gizmos<span class="token punctuation">.</span><span class="token function">DrawWireCube</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> mapGrid<span class="token punctuation">.</span>GridSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                Gizmos<span class="token punctuation">.</span>color <span class="token operator">=</span> mapGrid<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">HasFlag</span><span class="token punctuation">(</span>MapGrid<span class="token punctuation">.</span>MapStatus<span class="token punctuation">.</span>Obstacle<span class="token punctuation">)</span> <span class="token punctuation">?</span> Color<span class="token punctuation">.</span>red <span class="token punctuation">:</span> Color<span class="token punctuation">.</span>white<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                Gizmos<span class="token punctuation">.</span><span class="token function">DrawWireCube</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span><span class="token function">GetRealPosition</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span>GridSize<span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>GridSize<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åœ°å›¾å¯è§†åŒ–åï¼Œå‘ç°å³ä¾§å°éšœç¢ç‰©åœ¨ç½‘æ ¼ä¸­çš„å¤§å°ä¼¼ä¹ä¸å·¦ä¸‹ä¾§å¤§éšœç¢ç‰©ï¼ˆç¼–è¾‘å™¨ä¸­çš„ Prefab åŸå‹ï¼‰ç›¸è¿‘ï¼Œè€Œè¯¥å°éšœç¢ç‰©æ˜¯åœ¨è¿è¡Œååˆ›å»ºçš„å¯¹è±¡ï¼Œå…¶å¤§å°æ˜¯ä»åœ°å›¾æ–‡ä»¶ä¸­è¯»å–ç¼©æ”¾å€¼åè®¾å®šçš„ã€‚</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"scale"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Vector3</span> scale <span class="token operator">=</span> st<span class="token punctuation">.</span>scale<span class="token punctuation">;</span> scale<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>st_in<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localScale <span class="token operator">=</span> scale<span class="token punctuation">;</span></pre></td></tr></table></figure><p>è€Œå°è¯•å°†å…¶å˜å¾—æ›´å¤§åï¼Œå‘ç°é®æŒ¡é¢ç§¯å¹¶æœªæ”¹å˜ï¼Œ</p><h3 id="ç­”æ¡ˆå‘¼ä¹‹æ¬²å‡º"><a class="anchor" href="#ç­”æ¡ˆå‘¼ä¹‹æ¬²å‡º">#</a> ç­”æ¡ˆå‘¼ä¹‹æ¬²å‡º</h3><p>â€”â€” localScale å¹¶éç«‹å³ç”Ÿæ•ˆï¼Œæ‰€ä»¥ç”Ÿæˆé˜¶æ®µè®¾ç½® scaleï¼Œç”Ÿæ•ˆå»¶ååˆ°äº†ç”Ÿæˆé˜¶æ®µå®Œæˆç½‘æ ¼åˆå§‹åŒ–ä¹‹åï¼Œå¯èƒ½æ˜¯åœ¨ä¸‹ä¸€å¸§ä¸­ç”Ÿæ•ˆï¼Ÿ</p><p>ä½¿ç”¨ <code>Invoke</code>  å»¶è¿Ÿç½‘æ ¼åˆå§‹åŒ–åé—®é¢˜ä¹ŸæˆåŠŸè§£å†³ã€‚</p><div class="note default"><p>è¿™ä¸ªå¼‚å¸¸çš„è¿·é›¾æ²¡æœ‰ç¢°æ’ä½“ç§¯ï¼Œèµ°åœ¨é‡Œé¢ä¼šä¸¢å¤±å‘¨å›´ä¸€åˆ‡çš„è§†é‡ï¼Œåªèƒ½çœ‹åˆ°å‘¨å›´ä¸€åœˆï¼Œå¤–é¢è‡ªç„¶ä¹Ÿæ— æ³•çœ‹åˆ°é‡Œé¢<br />å…¶å®è¿˜æŒºé…·çš„ï¼Œã€Œé»‘åŸŸã€ï¼Œåç»­å¯ä»¥ä¸“é—¨æä¸€ä¸ªã€‚</p></div><h3 id="å¦å¤–çš„å°æ”¶è·"><a class="anchor" href="#å¦å¤–çš„å°æ”¶è·">#</a> å¦å¤–çš„å°æ”¶è·</h3><p>åœ¨ä¸Šä¸€ç¯‡çš„ç¼“åŠ¨å‡½æ•° <code>Lerp</code>  ä¸­<br />å°†</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>Graphics<span class="token punctuation">.</span><span class="token function">Blit</span><span class="token punctuation">(</span>nextTexture<span class="token punctuation">,</span> currnetTexture<span class="token punctuation">,</span> blurMaterial<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ä¸­çš„ <code>pass</code>  ä¼ å…¥å‚æ•°  <code>1</code>  æ”¹ä¸º  <code>0</code> ï¼Œå¯ä»¥é¿å…è¿·é›¾çš„é€æ˜åº¦çš„æå‡å¯¼è‡´å¯ä»¥é€è¿‡æœªæ¢ç´¢è¿·é›¾çœ‹åˆ°åœ°å½¢ã€‚</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220718220522.png" alt="æ–°æ•ˆæœ" /></p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Unity/">Unity</category>
      
      <category domain="https://blog.yukx.io/tags/%E6%88%98%E4%BA%89%E8%BF%B7%E9%9B%BE/">æˆ˜äº‰è¿·é›¾</category>
      
      <category domain="https://blog.yukx.io/tags/localScale/">localScale</category>
      
      
      <comments>https://blog.yukx.io/2022/07/game-dev-journal-4-1-mismatching-fog-size-with-obstacle-size/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶å››)ï¼šæˆ˜äº‰è¿·é›¾</title>
      <link>https://blog.yukx.io/2022/07/game-dev-journal-4-fog-of-war/</link>
      <guid>https://blog.yukx.io/2022/07/game-dev-journal-4-fog-of-war/</guid>
      <pubDate>Sun, 17 Jul 2022 17:15:11 GMT</pubDate>
      
        
        
      <description>&lt;div class=&quot;note info&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäº&lt;a href=&quot;https://www.bilibili.com/video/BV1tt411j7Zr?share_source=copy_web&quot;&gt;ã€åŸºäºè§†é‡çš„æˆ˜äº‰è¿·é›¾å®ç°ã€‘Unity æˆ˜äº‰è¿·é›¾å®ç°&lt;/a&gt; &lt;a </description>
        
      
      
      
      <content:encoded><![CDATA[<div class="note info"><p>æœ¬æ–‡åŸºäº<a href="https://www.bilibili.com/video/BV1tt411j7Zr?share_source=copy_web">ã€åŸºäºè§†é‡çš„æˆ˜äº‰è¿·é›¾å®ç°ã€‘Unity æˆ˜äº‰è¿·é›¾å®ç°</a> <a href="https://space.bilibili.com/3981300">@ç´æ¡Œ</a> å®ç°ã€‚<br /><a href="https://github.com/QinZhuo/FogOfWar_ForUnity">Github</a></p></div><div class="note default"><p>ä¸€ä¸ªæœˆçš„ç£•ç£•ç»Šç»Šç»ˆäºæ˜¯å®Œæˆäº†æ•ˆæœï¼Œæ€»æ„Ÿè§‰æ—¢ç„¶å½“åˆå¯Ÿè§‰äº†æŒæ¡ ECS çš„å¥‘æœºä¸å¦‚ç›´æ¥ä¸Šæ‰‹ï¼Œç°åœ¨çº ç»“è¿™äº›å¯¹è±¡ã€ç±»åŠŸèƒ½çš„åˆ’åˆ†å®å±éš¾å—ã€‚<br />æ—äººçš„æ‰“æ–­ï¼Œè‡ªå·±çš„æ‘†çƒ‚ï¼Œæƒ³åˆ°è¿™é‡Œï¼Œä¸ç¦æ½¸ç„¶ã€‚</p></div><h2 id="æ¦‚è¿°"><a class="anchor" href="#æ¦‚è¿°">#</a> æ¦‚è¿°</h2><p>æ€»ä½“ä¸Šçš„æ€è·¯ä¸ºå°†åœ°å›¾æŒ‰æ–¹å—åˆ’åˆ†ï¼Œå°†åœ°å›¾ä¸Šçš„éšœç¢ç‰©æ ‡è®°å‡ºæ¥ï¼Œå¯¹æ¯ä¸ªæœ‰è§†é‡çš„å•ä½è¿›è¡Œå°„çº¿æ£€æµ‹åˆ¤æ–­è§†é‡æ˜¯å¦è¢«é®æŒ¡ï¼Œå°†æ–¹å—åŒ–çš„è§†é‡è½¬æ¢ä¸º RenderTexture ä½œä¸ºè¿·é›¾å¯¹è±¡çš„æè´¨æ¸²æŸ“åˆ°åœ°å›¾çš„ä¸Šæ–¹ã€‚</p><h2 id="åœ°å›¾å—"><a class="anchor" href="#åœ°å›¾å—">#</a> åœ°å›¾å—</h2><h3 id="åœ°å›¾å—å®šä¹‰"><a class="anchor" href="#åœ°å›¾å—å®šä¹‰">#</a> åœ°å›¾å—å®šä¹‰</h3><p>ä½¿ç”¨ä¸€ä¸ªæšä¸¾ä»£è¡¨ä¸€ä¸ªåœ°å›¾å—çš„çŠ¶æ€</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">MapStatus</span><span class="token punctuation">:</span><span class="token type-list"><span class="token keyword">byte</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    Empty<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    Obstacle<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    AllyUnit<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    EnemeyUnit<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    SelfUnit</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// æ•´ä¸ªåœ°å›¾çš„åœ°å›¾å—</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token class-name">MapStatus<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> innerMap<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// åœ°å›¾å®½é«˜</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Width <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token operator">=></span> innerMap<span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Height <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token operator">=></span> innerMap<span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// åœ°å›¾å—çš„è¾¹é•¿</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> GridSize <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="åœ°å›¾å—ç´¢å¼•"><a class="anchor" href="#åœ°å›¾å—ç´¢å¼•">#</a> åœ°å›¾å—ç´¢å¼•</h3><p>å¯¹åœ°å›¾çš„ç´¢å¼•åˆ°çœŸå®ä½ç½®çš„è½¬æ¢åˆ™æœ‰</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name">Vector2</span> <span class="token function">GetRealPosition</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token punctuation">(</span>x <span class="token operator">-</span> Width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span> <span class="token operator">*</span> GridSize<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token punctuation">(</span>y <span class="token operator">-</span> Height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span> <span class="token operator">*</span> GridSize</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name">Vector2Int</span> <span class="token function">GetGridPosition</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> position<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2Int</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>x <span class="token operator">/</span> GridSize <span class="token operator">+</span> Width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>y <span class="token operator">/</span> GridSize <span class="token operator">+</span> Height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsInMap</span><span class="token punctuation">(</span><span class="token class-name">Vector2Int</span> pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> pos<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> Width<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pos<span class="token punctuation">.</span>y <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> pos<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> Height<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="åœ°å›¾å—ç”Ÿæˆ"><a class="anchor" href="#åœ°å›¾å—ç”Ÿæˆ">#</a> åœ°å›¾å—ç”Ÿæˆ</h3><p>å¯¹äºåœ°å›¾ï¼Œå¯ä»¥ä½¿ç”¨  <code>Physics2D.OverlapBox()</code> <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> æ¥åˆ¤æ–­åœ°å›¾å—çŠ¶æ€ï¼Œä½¿ç”¨äº† <code>Solid Unit</code>  ä½œä¸ºéšœç¢ç‰©çš„ Layerï¼Œæ’é™¤å…¶ä»–å•ä½ç¢°æ’ä½“ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Width<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> Height<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> box <span class="token operator">=</span> Physics2D<span class="token punctuation">.</span><span class="token function">OverlapBox</span><span class="token punctuation">(</span><span class="token function">GetRealPosition</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>GridSize<span class="token punctuation">,</span> GridSize<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> LayerMask<span class="token punctuation">.</span><span class="token function">GetMask</span><span class="token punctuation">(</span><span class="token string">"Solid Unit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>box <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            innerMap<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> MapStatus<span class="token punctuation">.</span>Obstacle<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">else</span> innerMap<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> MapStatus<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="å•ä½è§†é‡"><a class="anchor" href="#å•ä½è§†é‡">#</a> å•ä½è§†é‡</h2><p>ä½¿ç”¨ä¸€ä¸ª Behavior å­˜å‚¨å•ä½è§†é‡ç›¸å…³çš„æ•°æ®</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnitVision</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span> <span class="token comment">// è¿™ä¸ª Attribute å¯ä»¥è®©å˜é‡æ˜¾ç¤ºåœ¨ Inspector çª—å£ä¸­</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name"><span class="token keyword">float</span></span> sightRange <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> <span class="token function">GetSight</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> sightRange<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="è¿·é›¾ç”Ÿæˆ"><a class="anchor" href="#è¿·é›¾ç”Ÿæˆ">#</a> è¿·é›¾ç”Ÿæˆ</h2><p>é¦–å…ˆå½’çº³ä¸‹ç°æœ‰ä»£ç ï¼Œå°†<a href="#%E5%9C%B0%E5%9B%BE%E5%9D%97">åœ°å›¾å—</a>å†…ä»£ç å‡åŒ…è£…ä¸º <code>MapGrid</code>  ç±»</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapGrid</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="åŸºæœ¬è®¾æ–½"><a class="anchor" href="#åŸºæœ¬è®¾æ–½">#</a> åŸºæœ¬è®¾æ–½</h3><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FogMaker</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// åœ°å›¾ç½‘æ ¼</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">MapGrid</span> mapGrid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// è§‚å¯Ÿè€…</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">List<span class="token punctuation">&lt;</span>UnitVision<span class="token punctuation">></span></span> viewers <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// è¿·é›¾é¢œè‰²ä¿¡æ¯</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">Color32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> colorBuffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// ç½‘æ ¼ç´¢å¼•è½¬æ¢ä¸ºé¢œè‰²ç´¢å¼•</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">ColorIndex</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">*</span> mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token class-name">MapGrid</span> map<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment">// åˆå§‹åŒ–è¿·é›¾ä¸ºä¸é€æ˜é»‘è‰²</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        colorBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color32</span><span class="token punctuation">[</span>mapGrid<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        Array<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>colorBuffer<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">// ... </span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="è¿·é›¾çš„è®¡ç®—"><a class="anchor" href="#è¿·é›¾çš„è®¡ç®—">#</a> è¿·é›¾çš„è®¡ç®—</h3><p>å¯¹æ¯ä¸ªè§‚å¯Ÿè€…ï¼Œè·å–è§†é‡èŒƒå›´å†…çš„æ–¹å—</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> v <span class="token keyword">in</span> viewers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name"><span class="token keyword">var</span></span> pos <span class="token operator">=</span> mapGrid<span class="token punctuation">.</span><span class="token function">GetGridPosition</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name"><span class="token keyword">var</span></span> sight_radius <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">GetSight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> mapGrid<span class="token punctuation">.</span>GridSize<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name"><span class="token keyword">var</span></span> sight_square <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sight_radius <span class="token operator">*</span> sight_radius<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">List<span class="token punctuation">&lt;</span>Vector2Int<span class="token punctuation">></span></span> curVisionPos <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sight_radius<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sight_radius<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sight_radius<span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sight_radius<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> i <span class="token operator">+</span> j <span class="token operator">*</span> j <span class="token operator">&lt;=</span> sight_square<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token comment">// è¯¥åæ ‡å¤„äºå¯è§†èŒƒå›´å†… ä¸”å¤„äºåœ°å›¾å†…</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token class-name"><span class="token keyword">var</span></span> p <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2Int</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token keyword">if</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span><span class="token function">IsInMap</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                    curVisionPos<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    </pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>å¯¹è·å–åˆ°çš„æ–¹å—ï¼Œå°†å…¶ä¸è§‚å¯Ÿè€…è¿çº¿ï¼Œåˆ¤æ–­ä¸­é—´æ˜¯å¦æœ‰éšœç¢ç‰©é®æŒ¡ï¼Œè‹¥æœ‰åˆ™ä»è§†é‡ä¸­ç§»é™¤ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// ç”±è¿œåˆ°è¿‘æ’åº</span></pre></td></tr><tr><td data-num="2"></td><td><pre>curVisionPos<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">DistanceSquared</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">DistanceSquared</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">HashSet<span class="token punctuation">&lt;</span>Vector2Int<span class="token punctuation">></span></span> visited <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> novision <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> p <span class="token keyword">in</span> curVisionPos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">var</span> <span class="token punctuation">(</span>blocked<span class="token punctuation">,</span> unblocked<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">GetBlockedAndUnblocked</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        novision<span class="token punctuation">.</span><span class="token function">UnionWith</span><span class="token punctuation">(</span>blocked<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        visited<span class="token punctuation">.</span><span class="token function">UnionWith</span><span class="token punctuation">(</span>blocked<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        visited<span class="token punctuation">.</span><span class="token function">UnionWith</span><span class="token punctuation">(</span>unblocked<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// ç§»é™¤æ— è§†é‡</span></pre></td></tr><tr><td data-num="17"></td><td><pre>curVisionPos<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span>p <span class="token operator">=></span> novision<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// å°†è§†é‡åŒºåŸŸè®¾ç½®ä¸ºé€æ˜</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> p <span class="token keyword">in</span> curVisionPos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    colorBuffer<span class="token punctuation">[</span><span class="token function">ColorIndex</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œé¦–å…ˆæŒ‰ç…§ç”±è¿œåˆ°è¿‘çš„è·ç¦»å°†æ–¹å—æ’åºï¼Œæé«˜åç»­è®¡ç®—æ•ˆç‡ï¼Œå› ä¸ºåœ¨è®¡ç®—é®æŒ¡æ—¶ä¼šå°†æ‰€æœ‰è¢«é®æŒ¡å’Œä¸è¢«é®æŒ¡çš„æ–¹å—è¿”å›ï¼Œå¯ä»¥å°½å¯èƒ½å¤šçš„æ’é™¤ visited æ–¹å—ã€‚</p><h4 id="å°„çº¿æ£€æµ‹å‡½æ•°"><a class="anchor" href="#å°„çº¿æ£€æµ‹å‡½æ•°">#</a> å°„çº¿æ£€æµ‹å‡½æ•°</h4><p>ç”±èµ·ç‚¹å‘ç»ˆç‚¹é€æ–¹å—æ£€æµ‹æ˜¯å¦æœ‰éšœç¢ç‰©ï¼Œè‹¥é‡åˆ°éšœç¢ç‰©åˆ™åç»­æ–¹å—å‡ä¸ºæ— è§†é‡çš„é®æŒ¡åŒºåŸŸã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token punctuation">(</span>List<span class="token punctuation">&lt;</span>Vector2Int<span class="token punctuation">></span><span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span>Vector2Int<span class="token punctuation">></span><span class="token punctuation">)</span></span> <span class="token function">GetBlockedAndUnblocked</span><span class="token punctuation">(</span><span class="token class-name">Vector2Int</span> source<span class="token punctuation">,</span> <span class="token class-name">Vector2Int</span> target<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name"><span class="token keyword">var</span></span> blocked <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Vector2Int<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name"><span class="token keyword">var</span></span> unblocked <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Vector2Int<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name"><span class="token keyword">var</span></span> delta <span class="token operator">=</span> target <span class="token operator">-</span> source<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// èµ·å§‹ä½ç½®ç›¸åŒ</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>delta<span class="token punctuation">.</span>sqrMagnitude <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>mapGrid<span class="token punctuation">[</span>source<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">HasFlag</span><span class="token punctuation">(</span>MapGrid<span class="token punctuation">.</span>MapStatus<span class="token punctuation">.</span>Obstacle<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            blocked<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">else</span> unblocked<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>blocked<span class="token punctuation">,</span> unblocked<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    unblocked<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token class-name"><span class="token keyword">bool</span></span> blockMet <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// åˆ¤æ–­ X æˆ– Y ä½œä¸ºåŸºç¡€æ­¥é•¿æ–¹å‘</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>delta<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">></span> Math<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>delta<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token comment">// X è½´ä¸ºæ–¹å‘</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    </pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment">// ç¬¦å·</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name"><span class="token keyword">int</span></span> x_sign <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>delta<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment">// å¢é‡</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> y_inc <span class="token operator">=</span> <span class="token punctuation">(</span>delta<span class="token punctuation">.</span>y <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> Math<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>delta<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name"><span class="token keyword">float</span></span> step_y <span class="token operator">=</span> y_inc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> step_x <span class="token operator">=</span> x_sign<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            x_sign <span class="token operator">*</span> step_x <span class="token operator">&lt;=</span> x_sign <span class="token operator">*</span> delta<span class="token punctuation">.</span>x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            step_x<span class="token operator">+=</span>x_sign<span class="token punctuation">,</span> step_y<span class="token operator">+=</span>y_inc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token class-name"><span class="token keyword">var</span></span> s <span class="token operator">=</span> source <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2Int</span><span class="token punctuation">(</span>step_x<span class="token punctuation">,</span> Mathf<span class="token punctuation">.</span><span class="token function">RoundToInt</span><span class="token punctuation">(</span>step_y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>blockMet<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                unblocked<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                blockMet <span class="token operator">=</span> mapGrid<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">HasFlag</span><span class="token punctuation">(</span>MapGrid<span class="token punctuation">.</span>MapStatus<span class="token punctuation">.</span>Obstacle<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token keyword">else</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                blocked<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">else</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token comment">// æ–¹å‘ä¸º Y è½´çš„æƒ…å†µä¸ X è½´åŸºæœ¬ç›¸åŒï¼Œåªéœ€è°ƒæ¢ xã€y çš„è§’è‰²å³å¯</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>blocked<span class="token punctuation">,</span> unblocked<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="è¿·é›¾åˆ·æ–°"><a class="anchor" href="#è¿·é›¾åˆ·æ–°">#</a> è¿·é›¾åˆ·æ–°</h3><p>åœ¨åŒºåŸŸä¸¢å¤±è§†é‡æ—¶é‡æ–°è¦†ç›–ä¸€å±‚åŠé€æ˜çš„å·²æ¢ç´¢è¿·é›¾</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RefreshFog</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> colorBuffer<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>colorBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            colorBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>é…åˆä½¿ç”¨å¯ä»¥å®ç°æˆ˜äº‰è¿·é›¾ -(æœª) æ¢ç´¢åŒºåŸŸçš„æ•ˆæœã€‚</p><h3 id="è¿·é›¾è´´å›¾"><a class="anchor" href="#è¿·é›¾è´´å›¾">#</a> è¿·é›¾è´´å›¾</h3><div class="note info"><p>Shaderã€æè´¨ã€çº¹ç†ï¼Œå±å®å¤´å¤§ä½äº†ï¼Œå¹¶æ²¡æœ‰å®Œå…¨ç†è§£æ­¤éƒ¨åˆ†çš„æµç¨‹ï¼Œä¸è¿‡å§‘ä¸”å®ç°äº†æ•ˆæœ</p></div><p>åˆå§‹åŒ–èµ„æº</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Material</span> blurMaterial<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Texture2D</span> textureBuffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">RenderTexture</span> renderTexture<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">RenderTexture</span> renderTexture2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">RenderTexture</span> nextTexture<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token class-name">RenderTexture</span> currnetTexture<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token class-name">MapGrid</span> map<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// ... </span></pre></td></tr><tr><td data-num="10"></td><td><pre>    blurMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Material</span><span class="token punctuation">(</span>Shader<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"ImageEffect/AverageBlur"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    textureBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Texture2D</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> TextureFormat<span class="token punctuation">.</span>ARGB32<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    renderTexture <span class="token operator">=</span> RenderTexture<span class="token punctuation">.</span><span class="token function">GetTemporary</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    renderTexture2 <span class="token operator">=</span> RenderTexture<span class="token punctuation">.</span><span class="token function">GetTemporary</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    nextTexture <span class="token operator">=</span> RenderTexture<span class="token punctuation">.</span><span class="token function">GetTemporary</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    currnetTexture <span class="token operator">=</span> RenderTexture<span class="token punctuation">.</span><span class="token function">GetTemporary</span><span class="token punctuation">(</span>mapGrid<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> mapGrid<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// åœ¨é”€æ¯æ—¶é‡Šæ”¾èµ„æº</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    RenderTexture<span class="token punctuation">.</span><span class="token function">ReleaseTemporary</span><span class="token punctuation">(</span>renderTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    RenderTexture<span class="token punctuation">.</span><span class="token function">ReleaseTemporary</span><span class="token punctuation">(</span>renderTexture2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    RenderTexture<span class="token punctuation">.</span><span class="token function">ReleaseTemporary</span><span class="token punctuation">(</span>currnetTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    RenderTexture<span class="token punctuation">.</span><span class="token function">ReleaseTemporary</span><span class="token punctuation">(</span>nextTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ä½¿ç”¨é¢œè‰²ä¿¡æ¯ç”Ÿæˆ Textureï¼Œå¹¶è¿›è¡Œå‡ æ¬¡æ¨¡ç³Š</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MakeTextureAndBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    textureBuffer<span class="token punctuation">.</span><span class="token function">SetPixels32</span><span class="token punctuation">(</span>colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    textureBuffer<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    Graphics<span class="token punctuation">.</span><span class="token function">Blit</span><span class="token punctuation">(</span>textureBuffer<span class="token punctuation">,</span> renderTexture<span class="token punctuation">,</span> blurMaterial<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    </pre></td></tr><tr><td data-num="8"></td><td><pre>    Graphics<span class="token punctuation">.</span><span class="token function">Blit</span><span class="token punctuation">(</span>renderTexture<span class="token punctuation">,</span> renderTexture2<span class="token punctuation">,</span> blurMaterial<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    Graphics<span class="token punctuation">.</span><span class="token function">Blit</span><span class="token punctuation">(</span>renderTexture2<span class="token punctuation">,</span> renderTexture<span class="token punctuation">,</span> blurMaterial<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    Graphics<span class="token punctuation">.</span><span class="token function">Blit</span><span class="token punctuation">(</span>renderTexture<span class="token punctuation">,</span> nextTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ç¼“åŠ¨ï¼Œåœ¨ä¸¤å¸§è¿·é›¾é—´è¿‡æ¸¡</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Lerp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Graphics<span class="token punctuation">.</span><span class="token function">Blit</span><span class="token punctuation">(</span>currnetTexture<span class="token punctuation">,</span> renderTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    blurMaterial<span class="token punctuation">.</span><span class="token function">SetTexture</span><span class="token punctuation">(</span><span class="token string">"_LastTex"</span><span class="token punctuation">,</span> renderTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Graphics<span class="token punctuation">.</span><span class="token function">Blit</span><span class="token punctuation">(</span>nextTexture<span class="token punctuation">,</span> currnetTexture<span class="token punctuation">,</span> blurMaterial<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åœ¨æ¯æ¬¡æ›´æ–°æ—¶æ›´æ–°è¿·é›¾</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">RefreshFog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">ComputeFog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">MakeTextureAndBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">Lerp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>å¯¹å¤–æä¾› Texture è·å–</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name">RenderTexture</span> FogTexture <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token operator">=></span> currnetTexture<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="è¿·é›¾æ¸²æŸ“"><a class="anchor" href="#è¿·é›¾æ¸²æŸ“">#</a> è¿·é›¾æ¸²æŸ“</h2><p>è·å–æ¸²æŸ“è¿·é›¾çš„å¯¹è±¡çš„æè´¨ï¼Œæ¯æ¬¡æ›´æ–°æ—¶å°†ç”Ÿæˆçš„ FogTexture èµ‹äºˆåˆ°æè´¨å³å¯ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td data-command=""></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FogRenderer</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span></pre></td></tr><tr><td data-num="2"></td><td data-command=""></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> fogRenderer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">FogMaker</span> fogMaker<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre>    </pre></td></tr><tr><td data-num="6"></td><td data-command=""></td><td><pre>    <span class="token class-name">Material</span> fogMaterial<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td data-command=""></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td data-command=""></td><td><pre>        fogMaterial <span class="token operator">=</span> fogRenderer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Renderer<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>material<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td data-command=""></td><td><pre>    <span class="token comment">// Update is called once per frame</span></pre></td></tr><tr><td data-num="12"></td><td data-command=""></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td data-command=""></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fogMaker<span class="token punctuation">.</span>FogTexture <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td data-command=""></td><td><pre>            fogMaterial<span class="token punctuation">.</span><span class="token function">SetTexture</span><span class="token punctuation">(</span><span class="token string">"_MainTex"</span><span class="token punctuation">,</span> fogMaker<span class="token punctuation">.</span>FogTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ä¸º fogRenderer æ·»åŠ å¦‚ä¸‹ç»„ä»¶</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220718140108.png" alt="ç¤ºä¾‹" /></p><div class="note info"><p>åœ¨ 2D é¡¹ç›®ä¸­ä½¿ç”¨ Plane éœ€è¦è¿›è¡Œæ—‹è½¬ï¼Œç¡®ä¿æ–¹å‘ç¬¦åˆä½ çš„è¦æ±‚ã€‚</p><p>MeshRenderer çš„æè´¨æ˜¯ä½¿ç”¨ Shader åˆ›å»ºçš„ï¼Œè§<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1FpblpodW8vRm9nT2ZXYXJfRm9yVW5pdHkvdHJlZS9tYXN0ZXIvQXNzZXRzL0ZvZ09mV2FyL1NoYWRlcnM=" title="Shaders">æ­¤</span></p></div><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220718140207.png" alt="æ•ˆæœå±•ç¤º" /></p><div class="note default"><p>æ„å¤–çš„å®ç°äº†ä¸€ä¸ªè‰ä¸›å‘¢â€¦ çœŸæ˜¯ä¸–äº‹éš¾æ–™ã€‚<br />åœ¨æœ¬ç« èŠ‚ä¸­çš„ MapGrid å¯ä»¥åŸºäºæ­¤ä¸Šè¿›ä¸€æ­¥æ¥å®ç°å¯»è·¯ç³»ç»Ÿï¼Œæ•¬è¯·æœŸå¾…ã€‚</p></div><hr class="footnotes-sep" /><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>å¯¹äº 3D é¡¹ç›®ï¼Œä½¿ç”¨ <code>Physics.CheckBox()</code> <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Unity/">Unity</category>
      
      <category domain="https://blog.yukx.io/tags/%E6%88%98%E4%BA%89%E8%BF%B7%E9%9B%BE/">æˆ˜äº‰è¿·é›¾</category>
      
      <category domain="https://blog.yukx.io/tags/%E5%9C%B0%E5%9B%BE%E7%BD%91%E6%A0%BC/">åœ°å›¾ç½‘æ ¼</category>
      
      
      <comments>https://blog.yukx.io/2022/07/game-dev-journal-4-fog-of-war/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶ä¸‰)ï¼šå•ä½ç§»åŠ¨</title>
      <link>https://blog.yukx.io/2022/06/game-dev-journal-3-unit-move/</link>
      <guid>https://blog.yukx.io/2022/06/game-dev-journal-3-unit-move/</guid>
      <pubDate>Wed, 15 Jun 2022 18:20:49 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;span class=&quot;spoiler blur&quot; title=&quot;ä½ çŸ¥é“å¾—å¤ªå¤šäº†&quot;&gt;æˆ‘è¿˜çœŸæ—¶è·Ÿå¯¹è±¡æ²¡æœ‰ç¼˜åˆ†ï¼Œè¿™å‡ å¤©çš„é—·å¤´æäº‹ç«Ÿç„¶è¿˜ç®—æ‘¸åˆ°äº†ä¸€ç‚¹ ECS çš„è¾¹ã€‚é€‰è¯­è¨€ä¹Ÿæ˜¯æ”¾ç€ä¸€ä¼— OOP ä¸ç®¡ä¸€å¤´æ‰è¿›äº†å‡½æ•°å¼çš„å‘ï¼Œååç©çš„è¿˜å¾ˆèœã€‚&lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;ç§»åŠ¨</description>
        
      
      
      
      <content:encoded><![CDATA[<p><span class="spoiler blur" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">æˆ‘è¿˜çœŸæ—¶è·Ÿå¯¹è±¡æ²¡æœ‰ç¼˜åˆ†ï¼Œè¿™å‡ å¤©çš„é—·å¤´æäº‹ç«Ÿç„¶è¿˜ç®—æ‘¸åˆ°äº†ä¸€ç‚¹ ECS çš„è¾¹ã€‚é€‰è¯­è¨€ä¹Ÿæ˜¯æ”¾ç€ä¸€ä¼— OOP ä¸ç®¡ä¸€å¤´æ‰è¿›äº†å‡½æ•°å¼çš„å‘ï¼Œååç©çš„è¿˜å¾ˆèœã€‚</span></p><h2 id="ç§»åŠ¨"><a class="anchor" href="#ç§»åŠ¨">#</a> ç§»åŠ¨</h2><div class="note default no-icon"><p>æœ¬æ¥ä»¥ä¸ºè¿‘æœŸå¯èƒ½ä¸å¤ªæœ‰ä»€ä¹ˆå¯ä»¥è¯´é“çš„äº‹äº†ï¼Œè¿˜æ˜¯ä½ä¼°äº†æ¸¸æˆå¼€å‘çš„å¥¥å¦™ï¼Œä»å¤´æ­å»ºä¸€ä¸ªä¸–ç•ŒçœŸçš„æ˜¯å¡”è¯ºè¥¿å‘ã€‚</p></div><p>ç§»åŠ¨è¿™ä¸ªè¿‡ç¨‹é¦–å…ˆæ˜¯è½¬å‘ï¼Œé¢å‘è¦å‰å¾€çš„æ–¹å‘ï¼Œå¼€å§‹å‰è¿›æ˜¯ä¸€ä¸ªå¾ˆè‡ªç„¶ï¼Œå¾ˆç¬¦åˆç›´è§‰çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä¹ŸåŠ ä¸Šäº†éœ€è¦è½¬è¿‡èº«æ¥æ‰èƒ½ç§»åŠ¨çš„é™åˆ¶ã€‚</p><div class="note info"><p>è¿™é‡Œç›´æ¥ä½¿ç”¨äº†æˆ‘è§‰å¾—å¾ˆå¦™çš„ç»„ç»‡æ–¹æ³•ï¼Œå¦‚æœè¯´å¯èƒ½æœ‰æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ï¼Œåº”è¯¥ä¹Ÿèƒ½æ–¹ä¾¿çš„è½¬å†™æˆ ECS çš„æ¨¡å¼ï¼ˆå¤§æ¦‚ï¼‰</p></div><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Unity ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ ä¾èµ–çš„ Rigidbody ç»„ä»¶</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token function">RequireComponent</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Rigidbody2D</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Movable</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Rigidbody2D</span> rigid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// å¯ç§»åŠ¨å•ä½çš„å±æ€§</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name"><span class="token keyword">float</span></span> moveSpeed <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token class-name"><span class="token keyword">float</span></span> rotateSpeed <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// ç§»åŠ¨è¿‡ç¨‹çš„å‚æ•°</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">Vector2</span> destination<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token return-type class-name">Vector2</span> direction <span class="token operator">=></span> destination <span class="token operator">-</span> rigid<span class="token punctuation">.</span>position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name"><span class="token keyword">bool</span></span> isMoving <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// ä¸€äº›æ¸©æš–äººå¿ƒçš„çŠ¶æ€åˆ¤æ–­</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsIdling <span class="token operator">=></span> <span class="token operator">!</span>isMoving<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsMoveFinished</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> destination<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span>isMoving <span class="token operator">&amp;&amp;</span> rigid<span class="token punctuation">.</span>position <span class="token operator">==</span> destination<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// å¯¹å¤–æ”¾å‡ºçš„åŠŸèƒ½</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MoveTo</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> destination<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>destination <span class="token operator">=</span> destination<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        isMoving <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Interupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        isMoving <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        isMoving <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">// Use this for initialization</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        rigid <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">// Update is called once per frame</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isMoving<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token comment">// é¦–å…ˆæ—‹è½¬</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token class-name"><span class="token keyword">var</span></span> lookRotation <span class="token operator">=</span> Quaternion<span class="token punctuation">.</span><span class="token function">LookRotation</span><span class="token punctuation">(</span>Vector3<span class="token punctuation">.</span>forward<span class="token punctuation">,</span> direction<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token comment">// è®¡ç®—å½“å‰å¸§åº”è¯¥è¿›è¡Œçš„è½¬åŠ¨</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token class-name"><span class="token keyword">var</span></span> rotation <span class="token operator">=</span> Quaternion<span class="token punctuation">.</span><span class="token function">RotateTowards</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">,</span> lookRotation<span class="token punctuation">,</span> Time<span class="token punctuation">.</span>deltaTime <span class="token operator">*</span> rotateSpeed<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token comment">// å½“å‰æ–¹å‘ä¸ç›®æ ‡çš„å¤¹è§’</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token class-name"><span class="token keyword">float</span></span> angle <span class="token operator">=</span> Quaternion<span class="token punctuation">.</span><span class="token function">Angle</span><span class="token punctuation">(</span>lookRotation<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token comment">// è½¬èº«ï¼ŒåŒæ—¶ç¢°æ’å¸¦æ¥çš„é¿å…ä¸å¿…è¦çš„ä¹±è½¬</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>angle <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                rigid<span class="token punctuation">.</span>freezeRotation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                transform<span class="token punctuation">.</span>rotation <span class="token operator">=</span> rotation<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> rigid<span class="token punctuation">.</span>freezeRotation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token comment">// å½“è§’åº¦å°äº 15 åº¦æ—¶å¯ä»¥ç§»åŠ¨</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>angle <span class="token operator">&lt;=</span> <span class="token number">15</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token class-name">Vector2</span> move <span class="token operator">=</span> Vector2<span class="token punctuation">.</span><span class="token function">MoveTowards</span><span class="token punctuation">(</span>rigid<span class="token punctuation">.</span>position<span class="token punctuation">,</span> destination<span class="token punctuation">,</span> Time<span class="token punctuation">.</span>deltaTime <span class="token operator">*</span> moveSpeed<span class="token operator">*</span><span class="token number">0.02f</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                rigid<span class="token punctuation">.</span>position <span class="token operator">=</span> move<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token comment">// åˆ°è¾¾ç›®çš„åœ°</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                <span class="token keyword">if</span><span class="token punctuation">(</span>destination <span class="token operator">==</span> rigid<span class="token punctuation">.</span>position<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                    isMoving <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªç‹¬ç«‹çš„ç§»åŠ¨ç»„ä»¶å°±å®Œæˆäº†ï¼Œå½“åé¢éœ€è¦è¿›è¡Œå¯»è·¯ç­‰ä¸€å¤§å †è®©äººå¤´å¤§çš„æ“ä½œæ—¶å°±å¯ä»¥æ–¹ä¾¿çš„é‡å†™äº†ï¼<br />åŒæ ·å¾—ç›Šäºç‹¬ç«‹æ€§ï¼Œå¯ä»¥è‡ªç”±çš„æƒ³è®©è°ç§»åŠ¨å°±è®©è°ç§»åŠ¨äº†ã€‚</p><hr /><p>ç„¶è€Œäº‹æƒ…ä¼¼ä¹ä¹Ÿå¹¶æ²¡æœ‰å¦‚æ­¤ç®€å•ï¼ŒæŒ‡ä»¤ â€”â€” ç§»åŠ¨ã€æ”»å‡»ã€å·¡é€»ï¼Œæ˜¯è¦æœ‰ä¸€ä¸ªé˜Ÿåˆ—çš„ã€‚è€Œåä¸¤ç§æŒ‡ä»¤ï¼Œä¹Ÿéƒ½æ˜¯åœ¨ç§»åŠ¨çš„åŸºç¡€ä¸Šæ·»åŠ çš„å˜åŒ–ã€‚</p><h2 id="æŒ‡ä»¤é˜Ÿåˆ—"><a class="anchor" href="#æŒ‡ä»¤é˜Ÿåˆ—">#</a> æŒ‡ä»¤é˜Ÿåˆ—</h2><h3 id="æŒ‡ä»¤"><a class="anchor" href="#æŒ‡ä»¤">#</a> æŒ‡ä»¤</h3><p>é¦–å…ˆè€ƒè™‘ä¸€ä¸ªæŠ½è±¡çš„æŒ‡ä»¤ï¼Œä»…éœ€è¦å®ƒçš„ç›®çš„åœ°ï¼Œå’Œåˆ¤æ–­æ˜¯å¦ç”Ÿæˆä¸€ä¸ªåç»§æŒ‡ä»¤å°±å¤Ÿäº†ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InstructionIntent</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token return-type class-name">Vector2</span> Destination <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Derive</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">InstructionIntent</span> derived<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿™æ ·ç§»åŠ¨å’Œå·¡é€»æŒ‡ä»¤å¾ˆç®€å•ï¼š</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">MoveIntent</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">InstructionIntent</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Vector2</span> position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name">Vector2</span> Destination <span class="token operator">=></span> position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token function">MoveIntent</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Derive</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">InstructionIntent</span> derived<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        derived <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">PatrolIntent</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">InstructionIntent</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token class-name">Vector2</span> from<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token class-name">Vector2</span> to<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name">Vector2</span> Destination <span class="token operator">=></span> to<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">public</span> <span class="token function">PatrolIntent</span><span class="token punctuation">(</span><span class="token class-name">Vector2</span> from<span class="token punctuation">,</span> <span class="token class-name">Vector2</span> to<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>from <span class="token operator">=</span> from<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>to <span class="token operator">=</span> to<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Derive</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">InstructionIntent</span> derived<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        derived <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PatrolIntent</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ç”±äºå·¡é€»åˆ°ç›®æ ‡ç‚¹åï¼Œæ˜¾ç„¶æ ¹æ®ç°å®ç»éªŒæˆ‘ä»¬éœ€è¦è¿”å›åŸç‚¹ï¼Œæ‰€ä»¥æŒ‡ä»¤å®Œæˆåéœ€è¦äº§ç”Ÿå‡ºæ–°çš„æŒ‡ç¤ºè¿”å›çš„æŒ‡ä»¤ã€‚</p><div class="note info"><p>æ”»å‡»æŒ‡ä»¤æ¶‰åŠåˆ°å¦å¤–çš„æ”»å‡»ç»„ä»¶ï¼Œææ€•ä¸èƒ½å¦‚æ­¤ç®€åŒ–ï¼Œä¸è¿‡æš‚ä¸”å…ˆæ”¾åœ¨è¿™é‡Œã€‚</p></div><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">AttackIntent</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">InstructionIntent</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">GameObject</span> target<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name">Vector2</span> Destination<span class="token operator">=></span>target<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Transform<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token function">AttackIntent</span><span class="token punctuation">(</span><span class="token class-name">GameObject</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Derive</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">InstructionIntent</span> derived<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        derived <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="é˜Ÿåˆ—"><a class="anchor" href="#é˜Ÿåˆ—">#</a> é˜Ÿåˆ—</h3><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Queue<span class="token punctuation">&lt;</span>InstructionIntent<span class="token punctuation">></span></span> instructions <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Stack<span class="token punctuation">&lt;</span>InstructionIntent<span class="token punctuation">></span></span> patrolSencondaryInstructions <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ä¸ºäº†åº”å¯¹ä¸€è¿ä¸²çš„å·¡é€»æŒ‡ä»¤ï¼Œå®ç°é€ç‚¹å¾€è¿”ï¼Œå¾ˆæ˜æ˜¾èƒ½æƒ³åˆ°è¿™æ˜¯ä¸€ä¸ªæ ˆï¼Œåœ¨å½“å‰æŒ‡ä»¤é˜Ÿåˆ—å…¨éƒ¨å®Œæˆåï¼Œå°†æ ˆå€’è¿›é˜Ÿåˆ—ï¼Œå°±å®ç°äº†å¾€å¤å¾ªç¯ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// å¦‚æœæŒ‡ä»¤é˜Ÿåˆ—é‡Œå­˜åœ¨æŒ‡ä»¤ï¼Œå¤„ç†æŒ‡ä»¤</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>instructions<span class="token punctuation">.</span><span class="token function">TryPeek</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> current<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>movableUnit<span class="token punctuation">.</span><span class="token function">IsMoveFinished</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span>Destination<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token comment">// å¦‚æœå·²åˆ°è¾¾ç›®çš„åœ°</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        </pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// æ˜¯å¦æœ‰æ´¾ç”Ÿç§»åŠ¨</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">.</span><span class="token function">Derive</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> next<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            patrolSencondaryInstructions<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        instructions<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// å¦‚æœå®Œæˆç§»åŠ¨åé˜Ÿåˆ—ä¸ºç©ºï¼ŒæŸ¥çœ‹æ´¾ç”Ÿç§»åŠ¨æ ˆ</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>instructions<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">while</span> <span class="token punctuation">(</span>patrolSencondaryInstructions<span class="token punctuation">.</span><span class="token function">TryPop</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                instructions<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>movableUnit<span class="token punctuation">.</span>IsIdling<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#123;</span><span class="token comment">// ç§»åŠ¨</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        movableUnit<span class="token punctuation">.</span><span class="token function">MoveTo</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span>Destination<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>éšåæ£€æµ‹åœ°å›¾ä¸Šçš„é¼ æ ‡å³é”®äº‹ä»¶ï¼Œé˜Ÿåˆ—æ¸…ç©ºï¼Œåœæ­¢ç§»åŠ¨ï¼Œéšåæ”¾å…¥æ–°æŒ‡ä»¤ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// move or attack</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyDown</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse1<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>EventSystem<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">IsPointerOverGameObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    mainPlay<span class="token punctuation">.</span>selectedShips<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>o <span class="token operator">=></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        o<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Warship<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>instructions<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        o<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Warship<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        o<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Warship<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>instructions<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">MoveIntent</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="note default"><p>æ­¤å¤„å¹¶æœªåˆ¤æ–­é˜Ÿåˆ—è¾“å…¥ï¼Œä¸è¿‡å¹¶ä¸å¤æ‚ã€‚</p></div><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220616121214.png" alt="åˆ†æ•£é˜Ÿå½¢" /></p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Unity/">Unity</category>
      
      <category domain="https://blog.yukx.io/tags/%E5%8D%95%E4%BD%8D%E7%A7%BB%E5%8A%A8/">å•ä½ç§»åŠ¨</category>
      
      
      <comments>https://blog.yukx.io/2022/06/game-dev-journal-3-unit-move/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶äºŒ)ï¼šå•ä½é€‰æ‹©ã€å°åœ°å›¾:ç»­</title>
      <link>https://blog.yukx.io/2022/06/game-dev-journal-2-unit-selection-and-minimap-more/</link>
      <guid>https://blog.yukx.io/2022/06/game-dev-journal-2-unit-selection-and-minimap-more/</guid>
      <pubDate>Sun, 12 Jun 2022 06:32:14 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;å¦‚æœæœ‰äººçœ‹äº†ä¸Šä¸€ç¯‡ï¼Œå¯èƒ½å·²ç»ç¨å¾®æœ‰ç‚¹æ„Ÿè§‰ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ä¸æ˜¯ RTS æ¸¸æˆå‘¢ï¼Ÿâ€”â€” å¾ˆéš¾è¯´ä¸æ˜¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‚æ¼”ç‰©ä½“&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#å‚æ¼”ç‰©ä½“&quot;&gt;#&lt;/a&gt; å‚æ¼”ç‰©ä½“&lt;/h2&gt;
&lt;p&gt;ä¾ç…§æƒ¯ä¾‹ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª&lt;ruby&gt;ç«æŠ€åœº&lt;</description>
        
      
      
      
      <content:encoded><![CDATA[<p>å¦‚æœæœ‰äººçœ‹äº†ä¸Šä¸€ç¯‡ï¼Œå¯èƒ½å·²ç»ç¨å¾®æœ‰ç‚¹æ„Ÿè§‰ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ä¸æ˜¯ RTS æ¸¸æˆå‘¢ï¼Ÿâ€”â€” å¾ˆéš¾è¯´ä¸æ˜¯ã€‚</p><h2 id="å‚æ¼”ç‰©ä½“"><a class="anchor" href="#å‚æ¼”ç‰©ä½“">#</a> å‚æ¼”ç‰©ä½“</h2><p>ä¾ç…§æƒ¯ä¾‹ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª<ruby>ç«æŠ€åœº<rp> (</rp><rt>Arena</rt><rp>)</rp></ruby> ä½œä¸ºæ•´åœºæ¸¸æˆçš„åœ°å›¾ã€‚<br />Boundary ä½œä¸ºåœ°å›¾è¾¹ç•Œé™åˆ¶ç‰©ä½“ç§»åŠ¨ã€‚<br /><ruby>æˆ˜èˆ°<rp> (</rp><rt>Warship</rt><rp>)</rp></ruby> ä½œä¸º Prefab è‡ªç„¶å°±æ˜¯å•ä½å•¦ã€‚</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220613110559.png" alt="objects" /></p><div class="note default no-icon"><p>æ­¤å¤„ä¹Ÿèƒ½çœ‹åˆ°åœ¨ä¸Šä¸€ç¯‡ä¸­æœªå±•ç¤ºçš„<ruby>å°åœ°å›¾æŒ‡ç¤ºå™¨<rp> (</rp><rt>Map   Indicator</rt><rp>)</rp></ruby></p></div><h2 id="æ¡†é€‰å•ä½"><a class="anchor" href="#æ¡†é€‰å•ä½">#</a> æ¡†é€‰å•ä½</h2><h3 id="å•ä½é€‰æ‹©çš„æ€è·¯"><a class="anchor" href="#å•ä½é€‰æ‹©çš„æ€è·¯">#</a> å•ä½é€‰æ‹©çš„æ€è·¯</h3><p>é€‰ä¸­å•ä½çš„è§†è§‰æ ‡è¯†</p><blockquote><p>å•ä½å…·æœ‰è¢«é€‰ä¸­å±æ€§</p></blockquote><p>é¼ æ ‡æ¡†é€‰</p><blockquote><p>æ¡†ä½“ç´ æã€è·Ÿéšé¼ æ ‡</p></blockquote><p>é¼ æ ‡å·¦é”®ç‚¹å‡»ä¸æ‹–åŠ¨æ¡†é€‰çš„ç»Ÿä¸€</p><blockquote><p>è¢«æ¡†é€‰ã€ç‚¹å‡»ç‰©ä½“çš„åˆ¤æ–­</p></blockquote><h3 id="å•ä½-warship"><a class="anchor" href="#å•ä½-warship">#</a> å•ä½ - Warship</h3><p>ç»™ç»‘å®šåˆ°å•ä½çš„è„šæœ¬ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsSelected <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    selectionIndicator<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span>IsSelected<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="é€‰æ‹©æ¡†"><a class="anchor" href="#é€‰æ‹©æ¡†">#</a> é€‰æ‹©æ¡†</h3><h4 id="å¤–è§‚"><a class="anchor" href="#å¤–è§‚">#</a> å¤–è§‚</h4><p>é€‰æ‹©æ¡†çš„å¤–è§‚ç»è¿‡æƒè¡¡é€‰æ‹©ä½¿ç”¨ LineRenderer å®ç°ï¼Œå°†å®ƒçš„ Size è®¾ç½®ä¸º 5 ä»¥å®¹çº³ä¸€ä¸ªå››è¾¹é—­åˆçš„çŸ©å½¢çº¿æ¡†ï¼Œå…·ä½“çš„ç‚¹æˆ‘ä»¬åœ¨è„šæœ¬é‡Œè®¡ç®—ã€‚<br />ç»™å®ƒä¸€ä¸ªç™½è‰²çš„æè´¨ï¼Œéšæ„è®¾ç½®ä¸€ä¸ªä½ å–œæ¬¢çš„é¢œè‰²ï¼Œå¹¶è°ƒæ•´å®½åº¦åˆ°åˆé€‚ã€‚<br />è¦æ³¨æ„çš„æ˜¯å°† <ins class="dot">Use World Space å–æ¶ˆé€‰ä¸­</ins>ï¼Œè¿™æ ·ç»˜åˆ¶å‡ºæ¥çš„æ¡†ä½“å°±ä¼šè·Ÿéšç‰©ä½“çš„ä½ç½®ã€‚</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220613125446.png" alt="selection box" /></p><p>ç°åœ¨æˆ‘ä»¬æ¥å¤„ç†é¼ æ ‡ã€‚</p><p>é¦–å…ˆæ˜¯å·¦é”®æŒ‰ä¸‹ï¼Œç¡®å®šäº†ä¸€ä¸ªç‚¹ï¼Œéšååœ¨æ‹–åŠ¨ä¸­æ›´æ–°å¦ä¸€ä¸ªç‚¹ç»˜åˆ¶çº¿æ¡†ï¼Œåœ¨é¼ æ ‡æŠ¬èµ·åç¡®å®šäº†å¦ä¸€ä¸ªç‚¹ã€‚</p><p>è®°å½•é¼ æ ‡èµ·ç‚¹ï¼Œé€šè¿‡åˆ¤æ–­ nullable æ¥ç¡®å®šé¼ æ ‡æ˜¯å¦å·²ç»æŒ‰ä¸‹ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Vector3<span class="token punctuation">?</span></span> selection_start_mouse_position<span class="token punctuation">;</span></pre></td></tr></table></figure><p>æ€»æ˜¯ä¼šç”¨åˆ°çš„é¼ æ ‡å½“å‰ä½ç½®</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Vector3</span> position <span class="token operator">=</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenToWorldPoint</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span>mousePosition<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>é¼ æ ‡æŒ‰ä¸‹ï¼Œæ¿€æ´»é€‰æ‹©æ¡†å¯¹è±¡ï¼Œè®°å½•ä½ç½®ï¼Œè¿™é‡Œé¢çš„åˆ¤æ–­æ˜¯ä¸ºäº†é¿å¼€ä¸Šå±‚çš„ UI å…ƒç´ ï¼Œä½ ä¹Ÿä¸æƒ³ç‚¹å°åœ°å›¾å°±å–æ¶ˆäº†å½“å‰å•ä½çš„é€‰æ‹©å¯¹å§ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyDown</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse0<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>EventSystem<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">IsPointerOverGameObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    selection_start_mouse_position <span class="token operator">=</span> position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    selectionBox<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>é¼ æ ‡æ‹–åŠ¨æ—¶ï¼Œè°ƒæ•´ LineRenderer ä¸å¿…è¯´ï¼Œéšåéœ€è¦è°ƒæ•´æ•´ä¸ªç‰©ä½“çš„ä¸­å¿ƒä½ç½®ï¼Œç¡®ä¿èµ·å§‹ç‚¹ä¸å˜ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse0<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selection_start_mouse_position <span class="token keyword">is</span> <span class="token class-name">Vector3</span> sp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">Vector3</span> size <span class="token operator">=</span> position <span class="token operator">-</span> sp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        size<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> half_size <span class="token operator">=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LineRenderer<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetPositions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3<span class="token punctuation">[</span><span class="token punctuation">]</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span>half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        selectionBox<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> position <span class="token operator">-</span> half_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åœ¨æŠ¬èµ·é¼ æ ‡æ—¶ï¼Œé‡ç½®å¤§å°å¹¶éšè—ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyUp</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse0<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selection_start_mouse_position <span class="token keyword">is</span> <span class="token class-name">Vector3</span> sp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LineRenderer<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetPositions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        selection_start_mouse_position <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="åŠŸèƒ½"><a class="anchor" href="#åŠŸèƒ½">#</a> åŠŸèƒ½</h4><p>ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ä½¿ç”¨èµ·å§‹ä¸¤ç‚¹ç¡®å®šçš„çŸ©å½¢ï¼Œåˆ¤æ–­å•ä½æ˜¯å¦åœ¨çŸ©å½¢å†…éƒ¨ï¼Œä¸è¿‡è¿™æ ·æœ‰ä¸ªå°é—®é¢˜ï¼Œä½¿ç”¨ä¸­å¿ƒç‚¹åˆ¤æ–­æ—¶éœ€è¦ç¡®ä¿ä¸­å¿ƒç‚¹åœ¨çŸ©å½¢çš„å†…éƒ¨ï¼Œä¸èƒ½è½»æ˜“çš„å®ç°ç¬¦åˆè§†è§‰é¢„æœŸçš„æ•ˆæœï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†ç¢°æ’ä½“ã€‚</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220613140415.png" alt="ç¢°æ’ä½“" /></p><p>åœ¨é¼ æ ‡æ‹–åŠ¨æ—¶æ·»åŠ å¦‚ä¸‹ä»£ç è°ƒæ•´ç¢°æ’ä½“å¤§å°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç¢°æ’ä½“çš„ size å‚æ•°éœ€è¦ä¿è¯é¡¶ç‚¹è·ç¦»ä¸èƒ½è¿‡å°æˆ–ä¸ºè´Ÿã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td data-command=""></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse0<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td data-command=""></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td data-command=""></td><td><pre>    position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td data-command=""></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selection_start_mouse_position <span class="token keyword">is</span> <span class="token class-name">Vector3</span> sp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td data-command=""></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td data-command=""></td><td><pre>        <span class="token class-name">Vector3</span> size <span class="token operator">=</span> position <span class="token operator">-</span> sp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td data-command=""></td><td><pre>        size<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td data-command=""></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> half_size <span class="token operator">=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td data-command=""></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LineRenderer<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetPositions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3<span class="token punctuation">[</span><span class="token punctuation">]</span></span></pre></td></tr><tr><td data-num="12"></td><td data-command=""></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td data-command=""></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td data-command=""></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td data-command=""></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td data-command=""></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">-</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span>half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td data-command=""></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> half_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td data-command=""></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td data-command="*"></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BoxCollider2D<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token function">Abs</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.01f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Max</span><span class="token punctuation">(</span><span class="token function">Abs</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.01f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td data-command=""></td><td><pre>        selectionBox<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> position <span class="token operator">-</span> half_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td data-command=""></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td data-command=""></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åœ¨é¼ æ ‡æŠ¬èµ·æ—¶ï¼Œé¦–å…ˆå–æ¶ˆä¹‹å‰çš„é€‰ä¸­ï¼Œç„¶åé€šè¿‡ <code>OverlapCollider</code>  å–å¾—é‡å çš„ç¢°æ’ä½“ï¼Œå¹¶é€‰ä¸­è¿™äº›ç¢°æ’ä½“å¯¹åº”çš„å•ä½ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyUp</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse0<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selection_start_mouse_position <span class="token keyword">is</span> <span class="token class-name">Vector3</span> sp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> ship <span class="token keyword">in</span> mainPlay<span class="token punctuation">.</span>selectedShips<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            ship<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Warship<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>IsSelected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        mainPlay<span class="token punctuation">.</span>selectedShips<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">List<span class="token punctuation">&lt;</span>Collider2D<span class="token punctuation">></span></span> shipColliders <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BoxCollider2D<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OverlapCollider</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContactFilter2D</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                useLayerMask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                layerMask <span class="token operator">=</span> LayerMask<span class="token punctuation">.</span><span class="token function">GetMask</span><span class="token punctuation">(</span><span class="token string">"Unit"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> shipColliders<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        mainPlay<span class="token punctuation">.</span>selectedShips <span class="token operator">=</span> shipColliders<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>c <span class="token operator">=></span> c<span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> ship <span class="token keyword">in</span> mainPlay<span class="token punctuation">.</span>selectedShips<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            ship<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Warship<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>IsSelected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        selectionBox<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LineRenderer<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetPositions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        selection_start_mouse_position <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="note info"><p>æ­¤å¤„ä½¿ç”¨äº† ContactFilter æ¥æ’é™¤å…¶ä»–å±‚ä¸­çš„ç‰©ä½“ã€‚<br />ç›®å‰å¹¶æœªè¿›è¡Œå•ä½é˜µè¥å½’å±çš„åˆ¤æ–­ã€‚</p></div><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220613180430.png" alt="ç¤ºä¾‹" /></p><p>è‡³æ­¤ï¼Œæ¡†é€‰åŠŸèƒ½å®Œæˆã€‚</p><h2 id="å°åœ°å›¾ç»­æ›´å¤šçš„äº¤äº’"><a class="anchor" href="#å°åœ°å›¾ç»­æ›´å¤šçš„äº¤äº’">#</a> å°åœ°å›¾ï¼šç»­ï¼Œæ›´å¤šçš„äº¤äº’</h2><p>åœ¨ä¸Šä¸€ç¯‡ä¸­åªæ˜¯å®ç°äº†å°åœ°å›¾çš„æ˜¾ç¤ºåŠŸèƒ½ï¼Œä¸‹é¢å¼€å§‹å®Œå–„ã€‚</p><h3 id="æ˜¾ç¤ºå½“å‰é•œå¤´èŒƒå›´"><a class="anchor" href="#æ˜¾ç¤ºå½“å‰é•œå¤´èŒƒå›´">#</a> æ˜¾ç¤ºå½“å‰é•œå¤´èŒƒå›´</h3><p>ä¹Ÿå°±æ˜¯å°åœ°å›¾ä¸Šçš„ç™½æ¡†ï¼Œæˆ‘ä»¬å¯ä»¥å»¶ç»­ä¹‹å‰æ˜¾ç¤ºå•ä½ç¼©ç•¥å›¾çš„æ€è·¯ï¼Œç»™ Main Camera æ·»åŠ ä¸€ä¸ª minimap å±‚çš„å­ç‰©ä½“ã€‚</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220613142422.png" alt="å­ç‰©ä½“" /></p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220613142502.png" alt="å­ç‰©ä½“" /></p><p>åŒæ ·ä½¿ç”¨ LineRenderer æ¥ç»˜åˆ¶ã€‚<br />åªéœ€è¦åœ¨æ¸¸æˆåˆå§‹åŒ–çš„æ—¶å€™è®¾ç½®ä¸€ä¸‹ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// è·å–ä¸»æ‘„åƒå¤´èŒƒå›´</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    half_cam_size <span class="token operator">=</span> <span class="token punctuation">(</span>Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenToWorldPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>Screen<span class="token punctuation">.</span>width<span class="token punctuation">,</span> Screen<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenToWorldPoint</span><span class="token punctuation">(</span>Vector3<span class="token punctuation">.</span>zero<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    GameObject<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"Camera Range"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LineRenderer<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetPositions</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">-</span>half_cam_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> half_cam_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_cam_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> half_cam_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span>half_cam_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>half_cam_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">-</span>half_cam_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>half_cam_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token operator">-</span>half_cam_size<span class="token punctuation">.</span>x<span class="token punctuation">,</span> half_cam_size<span class="token punctuation">.</span>y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220613180548.png" alt="ç¤ºä¾‹" /></p><h3 id="ç‚¹å‡»å°åœ°å›¾ç§»åŠ¨é•œå¤´"><a class="anchor" href="#ç‚¹å‡»å°åœ°å›¾ç§»åŠ¨é•œå¤´">#</a> ç‚¹å‡»å°åœ°å›¾ç§»åŠ¨é•œå¤´</h3><p>ç”±äº  <code>Input.GetXX</code>  ä¼šä½œç”¨äºå…¨å±€ï¼Œä¸ºäº†é¿å…ä¸å¿…è¦çš„åˆ¤æ–­ï¼Œä½œä¸º UI ç»„ä»¶å¯ä»¥ä½¿ç”¨  <code>IPointerDownHandler</code>  ç³»åˆ—æ¥å£è·å–ç‚¹å‡»äº‹ä»¶ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPointerDown</span><span class="token punctuation">(</span><span class="token class-name">PointerEventData</span> eventData<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Vector2</span> ratio <span class="token operator">=</span> <span class="token punctuation">(</span>eventData<span class="token punctuation">.</span>position <span class="token operator">-</span> Vector2<span class="token punctuation">.</span>one <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span>ratio<span class="token punctuation">.</span>x <span class="token operator">*</span> mainPlay<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> ratio<span class="token punctuation">.</span>y <span class="token operator">*</span> mainPlay<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>å°åœ°å›¾çš„å¤§å°ç›®å‰è®¾ç½®ä¸º 200ï¼Œæ•…é¼ æ ‡äº‹ä»¶çš„ä½ç½®éœ€è¦å‡å»ä¸€åŠå¤§å°åå†é™¤ä»¥ 200 å¾—åˆ°ç‚¹å‡»ä½ç½®ç›¸å¯¹äºå…¨å›¾çš„æ¯”ä¾‹ã€‚<br />æ³¨æ„ä¸è¦æ”¹åŠ¨æ‘„åƒæœºé«˜åº¦ã€‚</p><p>æ›´è¿›ä¸€æ­¥ã€‚</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token keyword">bool</span></span> map_operation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// Update is called once per frame</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>map_operation <span class="token operator">&amp;&amp;</span> Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Mouse0<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token class-name">Vector3</span> p <span class="token operator">=</span> Input<span class="token punctuation">.</span>mousePosition<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        </pre></td></tr><tr><td data-num="9"></td><td><pre>        p<span class="token punctuation">.</span>x <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        p<span class="token punctuation">.</span>y <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">Vector2</span> ratio <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> Vector3<span class="token punctuation">.</span>one <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span>ratio<span class="token punctuation">.</span>x <span class="token operator">*</span> mainPlay<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> ratio<span class="token punctuation">.</span>y <span class="token operator">*</span> mainPlay<span class="token punctuation">.</span>MapSize<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPointerDown</span><span class="token punctuation">(</span><span class="token class-name">PointerEventData</span> eventData<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    map_operation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPointerUp</span><span class="token punctuation">(</span><span class="token class-name">PointerEventData</span> eventData<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    map_operation<span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Unity/">Unity</category>
      
      <category domain="https://blog.yukx.io/tags/%E9%BC%A0%E6%A0%87%E6%A1%86%E9%80%89%E5%8D%95%E4%BD%8D/">é¼ æ ‡æ¡†é€‰å•ä½</category>
      
      <category domain="https://blog.yukx.io/tags/%E5%B0%8F%E5%9C%B0%E5%9B%BE%E4%BA%A4%E4%BA%92/">å°åœ°å›¾äº¤äº’</category>
      
      
      <comments>https://blog.yukx.io/2022/06/game-dev-journal-2-unit-selection-and-minimap-more/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ¸¸æˆå¼€å‘æ—¥å¿— (å…¶ä¸€)ï¼šHUDã€å°åœ°å›¾</title>
      <link>https://blog.yukx.io/2022/06/game-dev-journal-1-hud-minimap/</link>
      <guid>https://blog.yukx.io/2022/06/game-dev-journal-1-hud-minimap/</guid>
      <pubDate>Sat, 11 Jun 2022 18:38:51 GMT</pubDate>
      
        
        
      <description>&lt;div class=&quot;note default no-icon&quot;&gt;
&lt;p&gt;æŸäººæ—¥å¸¸ä¸åŠ¡æ­£ä¸šåŠ¡ç°å·²å¼€æ‹“è‡³æ¸¸æˆå¼€å‘æŒ¥å¹´å¤ä¸€å¹´çš„æ²‰ç§¯ææ”¾å…‰å§ï¼&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;note default&quot;&gt;
&lt;p&gt;æ¸¸æˆå…·ä½“æƒ…å†µæš‚ä¸”ä¸æï¼Œåç»­ä¹Ÿå°†åœ¨ github ä¸Šå¼€æºã€‚&lt;</description>
        
      
      
      
      <content:encoded><![CDATA[<div class="note default no-icon"><p>æŸäººæ—¥å¸¸ä¸åŠ¡æ­£ä¸šåŠ¡ç°å·²å¼€æ‹“è‡³æ¸¸æˆå¼€å‘æŒ¥å¹´å¤ä¸€å¹´çš„æ²‰ç§¯ææ”¾å…‰å§ï¼</p></div><div class="note default"><p>æ¸¸æˆå…·ä½“æƒ…å†µæš‚ä¸”ä¸æï¼Œåç»­ä¹Ÿå°†åœ¨ github ä¸Šå¼€æºã€‚</p></div><h2 id="hud"><a class="anchor" href="#hud">#</a> HUD</h2><p>é¦–å…ˆæˆ‘ä»¬ç§‰æŒä¼˜è‰¯ä¼ ç»Ÿï¼Œåˆ›å»ºä¸€ä¸ªæ ¹ GameObjectï¼Œ<br />åœ¨å…¶å†…éƒ¨æ·»åŠ  Canvasï¼Œåœ¨ Canvas å†…æ·»åŠ æˆ‘ä»¬éœ€è¦çš„ UI ç‰©ä½“å³å¯ã€‚<br /><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/object-hierachy.png" alt="å¯¹è±¡å±‚çº§ç¤ºä¾‹" /></p><h2 id="å°åœ°å›¾"><a class="anchor" href="#å°åœ°å›¾">#</a> å°åœ°å›¾</h2><p>å°åœ°å›¾æœ‰å¾ˆå¤šç§å®ç°æ–¹æ³•ï¼Œè¿™é‡Œæš‚ä¸”é‡‡ç”¨æœ€ç®€å•çš„ï¼Œæ·»åŠ ç¬¬äºŒä¸ª Camera çš„æ–¹æ³•ã€‚</p><h3 id="custom-render-texture"><a class="anchor" href="#custom-render-texture">#</a> Custom Render Texture</h3><p>é¦–å…ˆæ–°å»ºä¸€ä¸ª Custom Render Texture, ç”¨äºæ¥æ”¶æ‘„åƒæœºçš„å†…å®¹å¹¶æ˜¾ç¤ºåœ¨æŒ‡å®šä½ç½®ã€‚</p><h3 id="map-camera"><a class="anchor" href="#map-camera">#</a> Map Camera</h3><p>æ–°å»ºä¸€ä¸ª Cameraï¼Œå¹¶åˆ›å»ºä¸€ä¸ª layer: minimapï¼Œç”¨äºæ˜¾ç¤ºå•ä½çš„ç¼©ç•¥å›¾ã€‚</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220612140021.png" alt="Camera å±æ€§" /></p><p>è®¾ç½® Clear Flag ä¸º Solid Color ï¼Œ<ruby> <rt></rt>æŠ•å½±<rp> (</rp><rt>Projection</rt><rp>)</rp> <rt></rt></ruby>ä¸º<ruby> <rt></rt>æ­£äº¤<rp> (</rp><rt>Orthographic</rt><rp>)</rp> <rt></rt></ruby>ï¼Œä»¥æ’é™¤é€è§†çš„å½±å“ã€‚<br />è®¾ç½® <strong>Culling Mask</strong> å–æ¶ˆé€‰ä¸­å…¶ä»– layer ä»…ä¿ç•™åˆšåˆšæ–°å»ºçš„ minimapï¼Œè¿™æ ·å°åœ°å›¾ä¸­ä¸ä¼šæ˜¾ç¤ºå¤šä½™çš„å†…å®¹ã€‚(åœ¨å…¶ä»– Camera ä¸­ä¹Ÿéœ€è¦ä¿æŒä¸è¦é€‰ä¸­ minimap)</p><p>è®¾ç½® Target Texture ä¸ºåˆšåˆšåˆ›å»ºçš„ Custom Render Textureã€‚</p><h3 id="minimap"><a class="anchor" href="#minimap">#</a> Minimap</h3><p>åœ¨ä½ å–œæ¬¢çš„åœ°æ–¹æ·»åŠ ä¸€ä¸ª  <code>UI &gt; Raw Image</code> ï¼Œå°†å…¶ Texture è®¾ç½®ä¸ºåˆšåˆšåˆ›å»ºçš„ Custom Render Textureã€‚<br />è‡³æ­¤å°åœ°å›¾çš„åŸºæœ¬æ˜¾ç¤ºåŠŸèƒ½å®Œæˆï¼Œåç»­éœ€è¦åœ¨æƒ³è¦æ˜¾ç¤ºåœ¨åœ°å›¾ä¸­çš„ç‰©ä½“å†…å®Œæˆã€‚</p><h3 id="å…¶ä»–å•ä½"><a class="anchor" href="#å…¶ä»–å•ä½">#</a> å…¶ä»–å•ä½</h3><p>åœ¨æƒ³è¦æ˜¾ç¤ºçš„ç‰©ä½“å†…æ·»åŠ ä¸€ä¸ª Spriteï¼ŒæŒ‡å®šå…¶ Layer ä¸º minimapã€‚</p><p><img data-src="https://fastly.jsdelivr.net/gh/hxYuki/im-base@master/20220612143055.png" alt="ç¤ºä¾‹æ•ˆæœ" /></p><p>å¤§åŠŸå‘Šæˆï¼</p><div class="note info"><p>Camera size ä¸ Worldspace å†…çš„åæ ‡å°ºåº¦ä¸€è‡´ï¼Œå¯æŒ‰éœ€è¦è°ƒæ•´åœ°å›¾å¤§å°ã€‚</p></div>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/conquest-of-star/">conquest of star</category>
      
      
      <category domain="https://blog.yukx.io/tags/Unity/">Unity</category>
      
      <category domain="https://blog.yukx.io/tags/HUD/">HUD</category>
      
      <category domain="https://blog.yukx.io/tags/%E5%B0%8F%E5%9C%B0%E5%9B%BE/">å°åœ°å›¾</category>
      
      
      <comments>https://blog.yukx.io/2022/06/game-dev-journal-1-hud-minimap/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Steamè®°ä½å¯†ç å¤±æ•ˆçš„ä¸€ç§åŸå› </title>
      <link>https://blog.yukx.io/2022/06/one-possible-reason-for-steam-not-rememebering-password/</link>
      <guid>https://blog.yukx.io/2022/06/one-possible-reason-for-steam-not-rememebering-password/</guid>
      <pubDate>Thu, 02 Jun 2022 06:14:28 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;ä½ å¯èƒ½æœ‰ç¬¬äºŒä¸ªè®¾å¤‡åœ¨ç™»å½•æ—¶è®°ä½äº†å¯†ç ï¼Œç¬¬ä¸€ä¸ªè®¾å¤‡å°±æ— æ³•è®°ä½å¯†ç äº†ã€‚&lt;/p&gt;
&lt;p&gt;å–æ¶ˆæ‰€æœ‰å…¶ä»–è®¾å¤‡æˆæƒä¹Ÿæ²¡æœ‰ç”¨ï¼Œ&lt;br /&gt;
å®åœ¨æ˜¯è®©æˆ‘æ¼ç«äº†å¥½ä¹…ï¼Œç›´åˆ°ä»Šå¤©æ‰“å¼€äº†å¾ˆä¹…æ²¡ç”¨çš„å¦ä¸€ä¸ªç”µè„‘ï¼Œé€€å‡ºäº†ä¸Šé¢çš„ Steamã€‚&lt;/p&gt;
</description>
        
      
      
      
      <content:encoded><![CDATA[<p>ä½ å¯èƒ½æœ‰ç¬¬äºŒä¸ªè®¾å¤‡åœ¨ç™»å½•æ—¶è®°ä½äº†å¯†ç ï¼Œç¬¬ä¸€ä¸ªè®¾å¤‡å°±æ— æ³•è®°ä½å¯†ç äº†ã€‚</p><p>å–æ¶ˆæ‰€æœ‰å…¶ä»–è®¾å¤‡æˆæƒä¹Ÿæ²¡æœ‰ç”¨ï¼Œ<br />å®åœ¨æ˜¯è®©æˆ‘æ¼ç«äº†å¥½ä¹…ï¼Œç›´åˆ°ä»Šå¤©æ‰“å¼€äº†å¾ˆä¹…æ²¡ç”¨çš„å¦ä¸€ä¸ªç”µè„‘ï¼Œé€€å‡ºäº†ä¸Šé¢çš„ Steamã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E9%97%B2%E8%AF%9D/">é—²è¯</category>
      
      
      <category domain="https://blog.yukx.io/tags/Steam%E6%97%A0%E6%B3%95%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81/">Steamæ— æ³•è®°ä½å¯†ç </category>
      
      <category domain="https://blog.yukx.io/tags/Steam/">Steam</category>
      
      
      <comments>https://blog.yukx.io/2022/06/one-possible-reason-for-steam-not-rememebering-password/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Ruståˆä½“éªŒ</title>
      <link>https://blog.yukx.io/2022/03/rust-try/</link>
      <guid>https://blog.yukx.io/2022/03/rust-try/</guid>
      <pubDate>Sat, 26 Mar 2022 06:10:56 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;è¿‘æ—¥æ¥å¿ƒæœ‰æˆšæˆšç»ˆæ—¥æƒ¶æƒ¶ï¼Œæ¸¸æˆäº¦è§‰æ— è¶£ï¼Œä¾¿æƒ³ç€å°è¯•ä¸‹ä¸€ç›´ä»¥æ¥æƒ³å­¦ä¸‹çš„ Rust&lt;/p&gt;
&lt;p&gt;ç›´æ¥è¿›è¡Œä¸€ä¸ª&lt;a href=&quot;https://kaisery.github.io/trpl-zh-cn/title-page.html&quot;&gt; The Book&lt;/a&gt; çš„æœç´¢ï¼ &lt;sp</description>
        
      
      
      
      <content:encoded><![CDATA[<p>è¿‘æ—¥æ¥å¿ƒæœ‰æˆšæˆšç»ˆæ—¥æƒ¶æƒ¶ï¼Œæ¸¸æˆäº¦è§‰æ— è¶£ï¼Œä¾¿æƒ³ç€å°è¯•ä¸‹ä¸€ç›´ä»¥æ¥æƒ³å­¦ä¸‹çš„ Rust</p><p>ç›´æ¥è¿›è¡Œä¸€ä¸ª<a href="https://kaisery.github.io/trpl-zh-cn/title-page.html"> The Book</a> çš„æœç´¢ï¼ <span class="rainbow">æ±‰åŒ–èµ›é«˜ï¼</span> <span class="spoiler" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">è¯è¯´è¿™ä¸ªä¸­æ–‡ç‰ˆçš„ Rust ç«Ÿç„¶æ¯”å®˜ç½‘è¿˜é«˜</span></p><p>ç›´æ¥è¿›è¡Œä¸€ä¸ªå°ç»ƒï¼</p><p>çœ‹å®Œäº†å‰ä¸‰ç« ï¼Œç®—æ˜¯å¯¹è¯­æ³•æ–¹é¢åšäº†ä¸ªåŸºæœ¬çš„äº†è§£ï¼Œä½“éªŒä¸‹æ¥æœ‰ç§å¥‡å¦™çš„èˆ’é€‚æ„Ÿï¼Œæ¯”å¦‚å˜é‡éšè—ã€ <code>.expect()</code>  æˆ– <code>match</code>  è¿›è¡Œçš„é”™è¯¯å¤„ç†ã€æˆ–æ˜¯ <code>break</code>  è¿”å›å€¼è¿™ç§ä¸œè¥¿åœ¨æœ‰éœ€è¦çš„æ—¶å€™çœŸçš„æ˜¯èƒ½æå¤§çš„æå‡å¹¸ç¦æ„Ÿï¼Œè®©äººå¯¹åé¢çš„å†…å®¹äº§ç”Ÿäº†æ›´æµ“åšçš„æœŸå¾…ã€‚</p><p>æµ…å°è‡³æ­¤ï¼Œæš‚ä¸”æç¬”ã€‚å¦è¯·å…è®¸æˆ‘é™„ä¸Šè‡ªå·±æ¸£çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚</p><figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">stdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read_line</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"failed to open input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">let</span> n<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"failed to parse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> a<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> b<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">match</span> n <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token number">1</span> <span class="token operator">=></span> a<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token number">2</span> <span class="token operator">=></span> b<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            _ <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token keyword">let</span> <span class="token keyword">mut</span> r<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">3</span><span class="token punctuation">..=</span>n <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                        a <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                        r <span class="token operator">=</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                        b <span class="token operator">=</span> b <span class="token operator">+</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                        r <span class="token operator">=</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                r</pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E4%BF%97%E4%B8%96%E4%BB%A5%E5%A4%96%E7%9A%84%E6%B6%88%E9%81%A3/">ä¿—ä¸–ä»¥å¤–çš„æ¶ˆé£</category>
      
      
      <category domain="https://blog.yukx.io/tags/Rust/">Rust</category>
      
      <category domain="https://blog.yukx.io/tags/%E5%AD%A6%E4%B9%A0%E9%9A%8F%E8%AE%B0/">å­¦ä¹ éšè®°</category>
      
      
      <comments>https://blog.yukx.io/2022/03/rust-try/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>è®©é™æ€çš„åšå®¢é£èµ·æ¥</title>
      <link>https://blog.yukx.io/2021/11/%E8%AE%A9%E9%9D%99%E6%80%81%E7%9A%84%E5%8D%9A%E5%AE%A2%E9%A3%9E%E8%B5%B7%E6%9D%A5/</link>
      <guid>https://blog.yukx.io/2021/11/%E8%AE%A9%E9%9D%99%E6%80%81%E7%9A%84%E5%8D%9A%E5%AE%A2%E9%A3%9E%E8%B5%B7%E6%9D%A5/</guid>
      <pubDate>Tue, 16 Nov 2021 05:54:43 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;æœ€è¿‘ç»ˆäºç®—æ˜¯æŠ˜è…¾å®Œäº†åšå®¢ã€ä¸»é¢˜è¿™äº›&lt;s&gt;è¦å‘½&lt;/s&gt;çš„ä¸œè¥¿ï¼Œä¸­é€”è¿˜ç»™å’±é€‰æ‹©çš„ä¸»é¢˜ä¿®äº† BUG &lt;span class=&quot;spoiler&quot; title=&quot;ä½ çŸ¥é“å¾—å¤ªå¤šäº†&quot;&gt;ä¸€åº¦è¿˜å› ä¸º BUG æƒ³è‡ªå·±å†™ä¸»é¢˜æ¥ç€çš„è¯´&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œç»ˆäºï¼Œç°åœ¨ä¸€åˆ‡éƒ½å·²ç»å¦¥å½“ï¼Œ</description>
        
      
      
      
      <content:encoded><![CDATA[<p>æœ€è¿‘ç»ˆäºç®—æ˜¯æŠ˜è…¾å®Œäº†åšå®¢ã€ä¸»é¢˜è¿™äº›<s>è¦å‘½</s>çš„ä¸œè¥¿ï¼Œä¸­é€”è¿˜ç»™å’±é€‰æ‹©çš„ä¸»é¢˜ä¿®äº† BUG <span class="spoiler" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">ä¸€åº¦è¿˜å› ä¸º BUG æƒ³è‡ªå·±å†™ä¸»é¢˜æ¥ç€çš„è¯´</span>ã€‚</p><p>ä¸è¿‡ï¼Œç»ˆäºï¼Œç°åœ¨ä¸€åˆ‡éƒ½å·²ç»å¦¥å½“ï¼Œè®© CDN ä»€ä¹ˆçš„å…ˆåœ¨ä¸€è¾¹æ”¾ç€å§ï¼æˆ‘è¦å¼€å§‹è¾“å‡ºäº†ï¼æˆ‘çœ‹ç€æ‰˜ç®¡åšå®¢çš„ä»“åº“ï¼Œçªç„¶é‚ªå¿µå¤§èµ·ï¼š</p><p>ã€Œç”¨ Github Actions è‡ªåŠ¨éƒ¨ç½²åšå®¢å·²ç»æ˜¯åŸºæ“äº†ï¼Œå†åŠ ä¸Š Github Codespaces å²‚ä¸æ˜¯å°±å†ä¹Ÿä¸ç”¨è¢«ä»“åº“çš„ä½ç½®é™åˆ¶äº†ï¼Ÿã€</p><p>ä¸è¿‡è¿™å¥—æµç¨‹çš„éš¾ç‚¹è¿˜æ˜¯åœ¨äºè¦é…ç½®å¥½ Github Actions çš„è‡ªåŠ¨éƒ¨ç½²ï¼Œå¤§ä½“æµç¨‹è€Œè¨€éƒ½å·®ä¸å¤šï¼Œç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥æ”¾  <code>[username].github.io</code>  ï¼Œç§é’¥æ”¾åˆ°åšå®¢æºä»“åº“çš„  <code>secret</code>  ä¸­ï¼Œåœ¨å¸‚åœºé‡Œæ‰¾ä¸€å¥—éƒ¨ç½² Hexo çš„ Action å°±å¤§åŠŸå‘Šæˆ â€”â€”</p><p>Star æœ€å¤šçš„ hexo-action åªæœ‰ç®€å•çš„éƒ¨ç½²æ“ä½œï¼Œè€Œæœ¬åšå®¢å¯ç”¨äº†åŸºäº algolia çš„æœç´¢åŠŸèƒ½ï¼Œéœ€è¦åœ¨éƒ¨ç½²å‰å°†æ”¹åŠ¨åŒæ­¥è‡³ Algolia ï¼Œåˆä¸æƒ³èŠ±æ—¶é—´å†ç²¾æŒ‘ç»†é€‰äº†ï¼Œäºæ˜¯åŠ¨äº†ä¸‹è„‘å­ï¼ŒåŸºäº hexo-action æ·»åŠ äº†ä¸€ä»½æ‰§è¡Œ  <code>hexo a</code>  çš„é€‰é¡¹<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>ï¼Œè¿™ä¸‹å°±å®Œç¾è§£å†³äº†ä¸ªäººçš„éœ€æ±‚ï¼Œå¯ä»¥æ„‰å¿«çš„éšå¤„<ruby>å†™<rp> (</rp><rt>guan</rt><rp>)</rp> æ–‡ç« <rp> (</rp><rt>shui</rt><rp>)</rp></ruby> äº†ï¼</p><hr class="footnotes-sep" /><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>ä¸ªäººé­”æ”¹çš„ hexo action ä¸º  <code>hxYuki/hexo-action@master</code>  æ¬¢è¿å–ç”¨ã€‚ <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E7%94%9F%E5%91%BD%E5%9C%A8%E4%BA%8E%E6%8A%98%E8%85%BE/">ç”Ÿå‘½åœ¨äºæŠ˜è…¾</category>
      
      <category domain="https://blog.yukx.io/categories/%E7%94%9F%E5%91%BD%E5%9C%A8%E4%BA%8E%E6%8A%98%E8%85%BE/MyBlog/">MyBlog</category>
      
      
      <category domain="https://blog.yukx.io/tags/%E8%A8%80%E5%B0%BD%E4%BA%8E%E8%A1%8C/">è¨€å°½äºè¡Œ</category>
      
      <category domain="https://blog.yukx.io/tags/%E5%BC%80%E5%8F%91%E4%B9%8B%E5%A4%96%E7%9A%84%E4%BA%8B/">å¼€å‘ä¹‹å¤–çš„äº‹</category>
      
      <category domain="https://blog.yukx.io/tags/Github-Codespaces/">Github Codespaces</category>
      
      <category domain="https://blog.yukx.io/tags/Github-Actions/">Github Actions</category>
      
      <category domain="https://blog.yukx.io/tags/Algolia/">Algolia</category>
      
      
      <comments>https://blog.yukx.io/2021/11/%E8%AE%A9%E9%9D%99%E6%80%81%E7%9A%84%E5%8D%9A%E5%AE%A2%E9%A3%9E%E8%B5%B7%E6%9D%A5/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>C# çš„ä¸€äº›é—®é¢˜æ“ä½œ</title>
      <link>https://blog.yukx.io/2021/10/CSharp%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%93%8D%E4%BD%9C/</link>
      <guid>https://blog.yukx.io/2021/10/CSharp%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%93%8D%E4%BD%9C/</guid>
      <pubDate>Wed, 27 Oct 2021 16:45:24 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;å‰æƒ…æè¦&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#å‰æƒ…æè¦&quot;&gt;#&lt;/a&gt; å‰æƒ…æè¦&lt;/h2&gt;
&lt;p&gt;ä½œä¸º &lt;code&gt;async&lt;/code&gt;   &lt;code&gt;await&lt;/code&gt;  å…³é”®å­—æºå¤´çš„ C#ï¼Œæäº›å¼‚æ­¥æ“ä½œå·²ç»æ˜¯å¾ˆèˆ’å¿ƒçš„äº†ï¼Œä¸è¿‡è¿‘æ¥ &lt;c</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="å‰æƒ…æè¦"><a class="anchor" href="#å‰æƒ…æè¦">#</a> å‰æƒ…æè¦</h2><p>ä½œä¸º <code>async</code>   <code>await</code>  å…³é”®å­—æºå¤´çš„ C#ï¼Œæäº›å¼‚æ­¥æ“ä½œå·²ç»æ˜¯å¾ˆèˆ’å¿ƒçš„äº†ï¼Œä¸è¿‡è¿‘æ¥ <code>.Net 6</code>  å°±è¦å‡ºäº†ï¼Œæ–°ç‰ˆæœ¬é‡Œé»˜è®¤å¯ç”¨äº† <code>nullable</code>  ç‰¹æ€§ï¼Œå½“äº«å—ç€å…¨å±€çš„ç©ºå®‰å…¨çš„æ—¶å€™ï¼Œå¯èƒ½è«åå…¶å¦™çš„å‘ç°æœ‰äº›åœ°æ–¹å‡ºç°äº†ç¢çœ¼çš„<ins class="wavy success">ç»¿è‰²ä¸‹åˆ’æ³¢æµªçº¿</ins>ã€‚ ğŸ’¢</p><h2 id="é—®é¢˜"><a class="anchor" href="#é—®é¢˜">#</a> é—®é¢˜</h2><p>é—®é¢˜ä»£ç å¤šåŠæ˜¯è¿™æ ·:</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">await</span> something<span class="token punctuation">?.</span><span class="token function">BalaBala</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ç„¶åè­¦å‘Šä½ <ruby>è§£å¼•ç”¨äº†ä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„å¼•ç”¨<rp> (</rp><rt>Dereference  of  a possibly null reference</rt><rp>)</rp></ruby>ã€‚<br />è¿™æ˜¯å› ä¸º <code>?.</code>  æ“ä½œç¬¦åœ¨å˜é‡ä¸º <code>null</code>  çš„æ—¶å€™ä¼šæŠŠè‡ªå·±æ•´æ®µéƒ½å˜ä¸º <code>null</code> ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ª <code>await</code>  ç­‰å¾…äº†ä¸€ä¸ª <code>Task&lt;ReturnType&gt;?</code> ï¼Œè€Œç›®å‰çš„ <code>await</code>  å¹¶ä¸æƒ³ç­‰å¾…ä¸€ä¸ªå¯‚å¯ã€‚<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><h2 id="workaround"><a class="anchor" href="#workaround">#</a> Workaround</h2><p>ä½œä¸ºæœ‰äº›è®¸è¿½æ±‚çš„äººï¼Œä¸€å®šè¦æ‰¾ä¸ªæ¯”è¾ƒä¼˜é›…çš„å†™æ³•ï¼Œç»“åˆäº†ä¸€äº›è§‚å¯Ÿå­¦ä¹ ï¼Œæˆ‘çš„ç­”æ¡ˆæ˜¯ï¼š</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">FunExt</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Task</span> <span class="token function">SafeExecute</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">Task<span class="token punctuation">?</span></span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>task<span class="token operator">??</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°å¯èƒ½çš„æ‰§è¡Œå¤±è´¥æ—¶éœ€è¦é»˜è®¤å€¼çš„æƒ…å†µï¼Œå¯ä»¥åŠ ä¸€ä¸ªè¿™ä¸ª: <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> <span class="spoiler" title="ä½ çŸ¥é“å¾—å¤ªå¤šäº†">ï¼Ÿå¼ºçƒˆæ€€ç–‘ï¼ŒçœŸçš„ä¼šæœ‰è¿™ç§éœ€æ±‚å—</span></p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>T<span class="token punctuation">?</span><span class="token punctuation">></span></span> <span class="token generic-method"><span class="token function">SafeExecute</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">Task<span class="token punctuation">&lt;</span>T<span class="token punctuation">?</span><span class="token punctuation">></span><span class="token punctuation">?</span></span> task<span class="token punctuation">)</span> <span class="token operator">=></span> task <span class="token operator">??</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼ä¸ºï¼š</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">await</span> <span class="token punctuation">(</span>something<span class="token punctuation">?.</span><span class="token function">BalaBalaA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SafeExcute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>è™½ç„¶è¿˜æ˜¯æ²¡èƒ½é¿å…å¤šåŠ ä¸€å¯¹æ‹¬å·ï¼Œä¸è¿‡æ€»æ¯”å»è¿›è¡Œéº»çƒ¦çš„åˆ¤æ–­è¦å¥½äº†é‚£ä¹ˆä¸€ç‚¹ã€‚</p><hr class="footnotes-sep" /><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>ç¡®å®æœ‰è¿™ä¹ˆä¸€ä¸ªæ–°ç‰¹æ€§çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvdG5ldC9jc2hhcnBsYW5nL2Jsb2IvbWFpbi9wcm9wb3NhbHMvbnVsbC1jb25kaXRpb25hbC1hd2FpdC5tZA==" title="null conditional await">æè®®</span>ï¼Œæˆ‘å¼€å§‹çœ‹äº†è§‰å¾—ä¸æ˜æ‰€ä»¥ï¼Œç›´åˆ°è‡ªå·±è¢«è­¦å‘Šç§€äº†ä¸€è„¸ <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li><li id="fn2" class="footnote-item"><p>åŸå†™æ³•æ¥è‡ª <span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjc1NTEwOTAvYmVzdC13YXktdG8taGFuZGxlLW51bGwtdGFzay1pbnNpZGUtYXN5bmMtbWV0aG9k" title="By BrainSlugs83">StackOverflow</span> ä¸è¿‡å…¶å¹¶æœªè€ƒè™‘åˆ° <code>default(T)</code>  çš„ç±»å‹ä¸º <code>T?</code> <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content:encoded>
      
      
      <category domain="https://blog.yukx.io/categories/%E5%BC%80%E5%8F%91%E9%9A%8F%E8%AE%B0/">å¼€å‘éšè®°</category>
      
      
      <category domain="https://blog.yukx.io/tags/%E8%A8%80%E5%B0%BD%E4%BA%8E%E8%A1%8C/">è¨€å°½äºè¡Œ</category>
      
      <category domain="https://blog.yukx.io/tags/C/">C#</category>
      
      <category domain="https://blog.yukx.io/tags/await/">await</category>
      
      <category domain="https://blog.yukx.io/tags/nullable/">nullable</category>
      
      
      <comments>https://blog.yukx.io/2021/10/CSharp%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%93%8D%E4%BD%9C/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
